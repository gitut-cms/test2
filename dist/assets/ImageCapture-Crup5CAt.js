import{r as n,j as e,G as y,aO as v,aP as w}from"./index-DgmZNK3x.js";const N=({onClose:i,onCapture:d})=>{const s=n.useRef(null),u=n.useRef(null),r=n.useRef(null),[l,m]=n.useState(null),[a,o]=n.useState(null),g=async()=>{o(null),m(null);try{const t=await navigator.mediaDevices.getUserMedia({video:{width:480,height:480}});r.current=t,s.current&&(s.current.srcObject=t)}catch(t){console.error("Error accessing camera:",t),t instanceof DOMException&&(t.name==="NotAllowedError"||t.name==="PermissionDeniedError")?o("تم رفض الوصول إلى الكاميرا. يرجى تمكين الإذن في إعدادات المتصفح."):o("لا يمكن الوصول إلى الكاميرا. يرجى التحقق من أنها غير مستخدمة من قبل تطبيق آخر.")}};n.useEffect(()=>(g(),()=>{r.current&&r.current.getTracks().forEach(t=>t.stop())}),[]);const h=()=>{if(s.current&&u.current){const t=s.current,c=u.current;c.width=t.videoWidth,c.height=t.videoHeight;const x=c.getContext("2d");x==null||x.drawImage(t,0,0,c.width,c.height);const b=c.toDataURL("image/jpeg");m(b),r.current&&(r.current.getTracks().forEach(j=>j.stop()),r.current=null)}},f=()=>{g()},p=()=>{l&&(d(l),i())};return e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-75 z-50 flex justify-center items-center",children:e.jsxs("div",{className:"bg-white rounded-lg p-4 max-w-lg w-full",children:[e.jsx("h3",{className:"text-xl font-bold mb-4 text-center",children:"التقاط صورة"}),e.jsxs("div",{className:"relative aspect-square bg-gray-900 rounded-md overflow-hidden flex items-center justify-center",children:[a?e.jsxs("div",{className:"p-4 text-center text-white",children:[e.jsx("p",{className:"font-semibold text-red-400",children:"خطأ في الكاميرا"}),e.jsx("p",{className:"text-sm mt-2",children:a})]}):l?e.jsx("img",{src:l,alt:"Captured",className:"w-full h-full object-contain"}):e.jsx("video",{ref:s,autoPlay:!0,playsInline:!0,className:"w-full h-full object-cover"}),e.jsx("canvas",{ref:u,className:"hidden"})]}),e.jsxs("div",{className:"mt-4 flex justify-center gap-4",children:[l?e.jsxs(e.Fragment,{children:[e.jsx("button",{type:"button",onClick:f,className:"bg-gray-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-gray-600",children:"إعادة الالتقاط"}),e.jsx("button",{type:"button",onClick:p,className:"bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700",children:"استخدام الصورة"})]}):e.jsx("button",{type:"button",onClick:h,disabled:!!a,className:"bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 disabled:bg-gray-400",children:"التقاط"}),e.jsx("button",{type:"button",onClick:i,className:"bg-red-500 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-600",children:"إغلاق"})]})]})})},R=({value:i,onChange:d})=>{const s=n.useRef(null),[u,r]=n.useState(!1),l=a=>{var g;const o=(g=a.target.files)==null?void 0:g[0];if(o){const h=new FileReader;h.onloadend=()=>{d(h.result)},h.readAsDataURL(o)}},m=()=>{d("")};return e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"w-48 h-48 rounded-lg border-2 border-dashed border-gray-300 flex justify-center items-center bg-gray-50 overflow-hidden relative group",children:i?e.jsxs(e.Fragment,{children:[e.jsx("img",{src:i,alt:"Preview",className:"w-full h-full object-cover"}),e.jsx("button",{type:"button",onClick:m,className:"absolute top-1 right-1 bg-red-600 text-white p-2 rounded-full opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"Remove image",children:e.jsx(y,{})})]}):e.jsx("span",{className:"text-gray-400 text-sm",children:"معاينة الصورة"})}),e.jsxs("div",{className:"mt-2 flex gap-2",children:[e.jsxs("button",{type:"button",onClick:()=>{var a;return(a=s.current)==null?void 0:a.click()},className:"flex-1 flex items-center justify-center gap-2 bg-white border border-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx(v,{}),e.jsx("span",{children:"تحميل صورة"})]}),e.jsx("input",{type:"file",ref:s,onChange:l,accept:"image/*",className:"hidden"}),e.jsxs("button",{type:"button",onClick:()=>r(!0),className:"flex-1 flex items-center justify-center gap-2 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors",children:[e.jsx(w,{}),e.jsx("span",{children:"التقاط صورة"})]})]}),u&&e.jsx(N,{onClose:()=>r(!1),onCapture:d})]})};export{R as I};
