import{b as Z,n as ee,u as se,o as te,c as ae,r as l,p as re,j as e,F as ne,L as N,q as oe,s as ie,t as le,v as ce,w as de,x as me,y as ge}from"./index-DgmZNK3x.js";import{A as ue}from"./AdBanner-BHXyFlzY.js";import{c as $}from"./fileUtils-Cb1IM2ig.js";import{C as he}from"./ChatWindow-BB8eBxdG.js";import{S as fe}from"./SocialShareButtons-BKLyRpAE.js";const n=(i,g,f=!0)=>{const d=f?`meta[property='${i}']`:`meta[name='${i}']`;let m=document.querySelector(d);m||(m=document.createElement("meta"),m.setAttribute(f?"property":"name",i),document.head.appendChild(m)),m.setAttribute("content",g)},v=i=>i?i.replace(/[أإآ]/g,"ا").replace(/ة/g,"ه"):"",xe=i=>{const g=new Map;i.forEach(d=>{g.has(d.groupId)||g.set(d.groupId,[]),g.get(d.groupId).push(d)});const f=[];for(const d of g.values())d.sort((m,b)=>m.id.localeCompare(b.id)),f.push(d[0]);return f},ve=()=>{var O,q,Q;const{countryCode:i,numericId:g}=Z(),f=ee(),{documents:d,cafes:m,siteSettings:b,loading:k}=se(),{user:pe}=te(),{language:I}=ae(),[t,C]=l.useState(void 0),[W,w]=l.useState(!0),[D,_]=l.useState(()=>{var s;return!!((s=f.state)!=null&&s.openChat)}),{usePresence:G,useVisitorChat:H,visitorId:F}=re(),{isOnline:j}=G(t==null?void 0:t.id),{messages:J,sendMessage:V}=H(t==null?void 0:t.id),[u,K]=l.useState([]),[x,M]=l.useState(""),[E,L]=l.useState(!1);l.useEffect(()=>{var s,a;if(t&&b){const c=((s=b.seo)==null?void 0:s[i||"dz"])||((a=b.seo)==null?void 0:a.default)||{siteName:"Gitut",titleSeparator:"|",metaDescription:""},h=t.address.commune&&t.address.wilaya?`بولاية ${t.address.wilaya} بلدية ${t.address.commune}`:"",o=`${t.name} ${h} ${c.titleSeparator} ${c.siteName}`,r=t.description?t.description.substring(0,155)+(t.description.length>155?"...":""):c.metaDescription,S=$(t.coverImageUrl)||"https://datas.gitut.com/data/image/gitut-og-main.png";let p="en_US";switch(I){case"ar":p="ar_AR";break;case"fr":p="fr_FR";break;case"de":p="de_DE";break;case"es":p="es_ES";break;case"tr":p="tr_TR";break;case"ja":p="ja_JP";break}document.title=o,n("description",r,!1),n("og:title",o),n("og:description",r),n("og:image",S),n("og:image:secure_url",S),n("og:image:width","1200"),n("og:image:height","630"),n("og:url",window.location.href),n("og:type","profile"),n("og:site_name",c.siteName),n("og:locale",p),n("twitter:card","summary_large_image",!1),n("twitter:url",window.location.href,!1),n("twitter:title",o,!1),n("twitter:description",r,!1),n("twitter:image",S,!1)}},[t,b,i,I]),l.useEffect(()=>{(async()=>{if(!g){w(!1);return}if(k)return;w(!0);const a=parseInt(g,10),c=m.find(h=>h.numericId===a);if(c)C(c),w(!1);else try{const h=await ge(a);C(h||void 0)}catch(h){console.error("Failed to fetch cafe by numericId:",h),C(void 0)}finally{w(!1)}})()},[g,m,k]);const z=l.useMemo(()=>{if(!t)return[];const s=[],a=new Set([t.id]),c=m.filter(o=>o.id!==t.id&&o.isProfilePublished);return c.filter(o=>o.address.commune===t.address.commune&&o.address.wilaya===t.address.wilaya).forEach(o=>{s.length<5&&!a.has(o.id)&&(s.push(o),a.add(o.id))}),s.length<5&&t.address.daira&&c.filter(r=>r.address.daira===t.address.daira&&r.address.wilaya===t.address.wilaya).forEach(r=>{s.length<5&&!a.has(r.id)&&(s.push(r),a.add(r.id))}),s.length<5&&c.filter(r=>r.address.wilaya===t.address.wilaya).forEach(r=>{s.length<5&&!a.has(r.id)&&(s.push(r),a.add(r.id))}),s},[t,m]),A=l.useMemo(()=>xe(d),[d]),y=l.useMemo(()=>t?A.filter(s=>t.services.includes(s.groupId)):[],[t,A]),U=l.useMemo(()=>{if(!x)return y;const s=v(x.toLowerCase());return y.filter(a=>v(a.name.toLowerCase()).includes(s))},[y,x]),P=l.useMemo(()=>{if(!x||!E)return[];const s=v(x.toLowerCase());return y.filter(a=>v(a.name.toLowerCase()).includes(s))},[y,x,E]),R=s=>{K(a=>a.includes(s)?a.filter(c=>c!==s):[...a,s])},X=s=>{R(s),M("")},Y=l.useMemo(()=>{if(!(t!=null&&t.address))return"";const{address:s}=t;return t.countryCode==="dz"?`${s.street||""}, ${s.commune||""}, ${s.daira||""}, ${s.wilaya||""}`.replace(/^,|,$/g,"").trim():`${s.street||""}, ${s.city||""}, ${s.state||""}`.replace(/^,|,$/g,"").trim()},[t]);if(W)return e.jsx("div",{className:"text-center py-20 flex justify-center items-center",children:e.jsx(ne,{className:"animate-spin text-4xl text-green-600"})});if(!t)return e.jsxs("div",{className:"text-center py-20",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"لم يتم العثور على المقهى"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"عذراً، لم نتمكن من العثور على الصفحة التي تبحث عنها."}),e.jsx(N,{to:`/${i}`,className:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors",children:"العودة إلى صفحة البحث"})]});const T="https://images.unsplash.com/photo-1554118811-1e0d58224f24?auto=format&fit=crop&w=800&q=80",B="https://images.unsplash.com/photo-1517245386807-bb43f82c33c4?auto=format&fit=crop&w=1200&q=80";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-xl max-w-6xl mx-auto overflow-hidden",children:[e.jsx("img",{src:$(t.coverImageUrl)||B,alt:`${t.name} cover`,className:"w-full h-48 object-cover",onError:s=>{s.currentTarget.src=B}}),e.jsxs("div",{className:"p-6 md:p-8 grid md:grid-cols-4 gap-8",children:[e.jsxs("main",{className:"md:col-span-3 space-y-8",children:[e.jsx(N,{to:`/${i}`,className:"text-green-600 hover:underline mb-6 inline-block",children:"← العودة إلى البحث"}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-8 items-start",children:[e.jsx("div",{className:"md:col-span-1",children:e.jsx("img",{src:$(t.imageUrl)||T,alt:t.name,className:"w-full h-auto rounded-lg shadow-md aspect-square object-cover",onError:s=>{s.currentTarget.src=T}})}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-2",children:t.name}),e.jsxs("p",{className:"text-gray-500 text-lg mb-4",children:["بإدارة: ",t.owner]}),e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("span",{className:`w-3 h-3 rounded-full transition-colors duration-500 ${j===null?"bg-gray-300 animate-pulse":j?"bg-green-500":"bg-gray-400"}`}),e.jsx("span",{className:"text-sm text-gray-600",children:j===null?"جاري التحقق...":j?"متصل الآن":"غير متصل"})]}),e.jsxs("div",{className:"space-y-3 text-gray-700",children:[e.jsxs("p",{children:[e.jsx("strong",{className:"font-semibold",children:"العنوان:"})," ",Y]}),e.jsxs("p",{children:[e.jsx("strong",{className:"font-semibold",children:"الوصف:"})," ",t.description]}),t.phone&&e.jsxs("p",{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"text-gray-500"})," ",e.jsx("strong",{children:t.phone})]})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[t.googleMapsUrl&&e.jsxs("a",{href:t.googleMapsUrl,target:"_blank",rel:"noopener noreferrer",className:"inline-flex items-center gap-2 bg-white border border-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-lg hover:bg-gray-100 transition-colors",children:[e.jsx(ie,{})," ",e.jsx("span",{children:"عرض على الخريطة"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[((O=t.socials)==null?void 0:O.facebook)&&e.jsx("a",{href:t.socials.facebook,target:"_blank",rel:"noopener noreferrer",className:"text-gray-500 hover:text-blue-600",children:e.jsx(le,{size:24})}),((q=t.socials)==null?void 0:q.instagram)&&e.jsx("a",{href:t.socials.instagram,target:"_blank",rel:"noopener noreferrer",className:"text-gray-500 hover:text-pink-600",children:e.jsx(ce,{size:24})}),((Q=t.socials)==null?void 0:Q.twitter)&&e.jsx("a",{href:t.socials.twitter,target:"_blank",rel:"noopener noreferrer",className:"text-gray-500 hover:text-sky-500",children:e.jsx(de,{size:24})})]})]})]})]}),e.jsxs("div",{className:"border-t pt-8",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"1. اختر المستندات المطلوبة"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"حدد المستندات التي تريدها. يمكنك البحث عن مستند وإضافته للقائمة، أو الاختيار مباشرة من القائمة أدناه."}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx("input",{type:"text",placeholder:"ابحث عن مستند لإضافته...",value:x,onChange:s=>M(s.target.value),onFocus:()=>L(!0),onBlur:()=>setTimeout(()=>L(!1),150),className:"w-full p-3 bg-white border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500","aria-label":"ابحث عن مستند لإضافته إلى قائمتك",autoComplete:"off"}),P.length>0&&e.jsx("ul",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-gray-300 rounded-md shadow-lg z-10 max-h-60 overflow-y-auto",children:P.map(s=>e.jsxs("li",{className:`px-4 py-2 cursor-pointer flex justify-between items-center ${u.includes(s.id)?"bg-green-100 font-semibold text-green-800":"hover:bg-green-50"}`,onMouseDown:a=>{a.preventDefault(),X(s.id)},children:[e.jsx("span",{children:s.name}),u.includes(s.id)&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-green-600",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})]},s.id))})]}),e.jsx("div",{className:"space-y-3 mb-6",role:"group","aria-labelledby":"documents-heading",children:U.length>0?U.map(s=>e.jsxs("button",{type:"button",onClick:()=>R(s.id),className:`w-full text-right p-4 border rounded-lg transition-all duration-200 ${u.includes(s.id)?"bg-green-100 border-green-500 ring-2 ring-green-400":"bg-gray-50 hover:bg-gray-100"}`,"aria-pressed":u.includes(s.id),children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800",children:s.name}),e.jsx("div",{className:"text-gray-600 prose prose-sm max-w-none line-clamp-2",dangerouslySetInnerHTML:{__html:s.description}})]},s.id)):e.jsx("div",{className:"text-center py-6 bg-gray-50 rounded-lg",children:e.jsx("p",{className:"text-gray-600",children:"لا توجد مستندات تطابق بحثك."})})}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"2. أرسل طلبك"}),e.jsxs(N,{to:u.length>0?`/${i}/form`:"#",state:{cafeId:t.id,selectedDocIds:u},className:`w-full md:w-auto inline-block text-center bg-green-600 text-white font-bold py-3 px-8 rounded-lg transition-colors focus:outline-none focus:ring-4 focus:ring-green-300 ${u.length===0?"opacity-50 cursor-not-allowed":"hover:bg-green-700"}`,"aria-disabled":u.length===0,onClick:s=>u.length===0&&s.preventDefault(),children:["متابعة لملء النموذج (",u.length,")"]})]})]}),e.jsxs("aside",{className:"md:col-span-1 space-y-6 pt-12",children:[e.jsx(ue,{placement:"PROFILE_SIDEBAR"}),z.length>0&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg border",children:[e.jsx("h3",{className:"font-bold text-lg mb-3 text-gray-800",children:"مقاهي مشابهة"}),e.jsx("div",{className:"space-y-3",children:z.map(s=>e.jsxs(N,{to:`/${s.countryCode}/profile/${s.numericId}`,className:"block p-3 bg-white rounded-md border hover:border-green-400 hover:bg-green-50 transition-all",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:s.name}),e.jsx("p",{className:"text-sm text-gray-500",children:s.address.commune})]},s.id))})]})]})]})]}),e.jsx(fe,{url:window.location.href,title:t.name,description:t.description}),t&&!D&&e.jsx("button",{onClick:()=>_(!0),className:"fixed bottom-8 right-8 bg-blue-600 text-white p-4 rounded-full shadow-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-transform hover:scale-110 z-40","aria-label":"بدء محادثة",title:"بدء محادثة",children:e.jsx(me,{size:24})}),D&&t&&F&&e.jsx("div",{className:"fixed bottom-8 right-8 w-full max-w-sm h-[70vh] max-h-[500px] z-50 shadow-2xl rounded-lg fade-in-text",children:e.jsx(he,{title:`محادثة مع ${t.name}`,messages:J,onSendMessage:V,currentUserId:F,isOnline:j,onClose:()=>_(!1)})})]})};export{ve as default};
