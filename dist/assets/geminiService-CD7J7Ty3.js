import{bb as u}from"./index-DgmZNK3x.js";const h="https://gitut.com/api/",f="@@??YOUYOU@@??YOUYOU1936",m="Could not initialize Firebase Admin SDK";function p(){return new Promise((t,n)=>{if(u.currentUser)return t(u.currentUser);const o=u.onAuthStateChanged(r=>{o(),r?t(r):n(new Error("User not authenticated."))})})}async function s(t,n){var o;try{const a=await(await p()).getIdToken(),e=await fetch(h,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`,"x-api-proxy-key":f},body:JSON.stringify({action:t,payload:n})});if((o=e.headers.get("Content-Type"))!=null&&o.includes("application/json")){const c=await e.json();if(!e.ok)throw new Error(c.error||`Request failed with status ${e.status}`);return c}const i=await e.text();if(!e.ok)throw new Error(i||`Request failed with status ${e.status}`);return{text:i}}catch(r){throw console.error(`Gemini Service Error (${t}):`,r),r instanceof Error&&r.message.includes(m)?new Error("خطأ فادح في إعدادات الخادم. يرجى الاتصال بمدير المنصة لحل المشكلة."):r}}async function*w(t){const n="generateContentStream",o={modelRequest:t},a=await(await p()).getIdToken(),e=await fetch(h,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${a}`,"x-api-proxy-key":f},body:JSON.stringify({action:n,payload:o})});if(!e.ok||!e.body){const d=(await e.json().catch(()=>({error:`Request failed with status ${e.status}`}))).error||`Request failed with status ${e.status}`;throw d.includes(m)?new Error("خطأ فادح في إعدادات الخادم. يرجى الاتصال بمدير المنصة لحل المشكلة."):new Error(d)}const i=e.body.getReader(),c=new TextDecoder;for(;;){const{done:l,value:d}=await i.read();if(l)break;yield c.decode(d,{stream:!0})}}async function*g(t,n){const o=`Analyze the following HTML content. Your task is to identify specific pieces of personal information (like names, dates, addresses, job titles) and replace them with the most relevant placeholder from the provided list. Return ONLY the modified HTML body content, without any markdown formatting, explanations, or the <body> tags themselves.

    Available placeholders: ${n.join(", ")}
    
    Original HTML Body:
    \`\`\`html
    ${t}
    \`\`\`
    `,r=w({model:"gemini-2.5-flash",contents:o});for await(const a of r)yield a}const S=async t=>s("extractJsonFromHtml",{html:t}),T=async t=>s("generateContent",{modelRequest:t}),x=async t=>s("generateImages",{prompt:t}),A=async(t,n,o,r)=>{const a=await s("extractStructuredData",{transcript:t,formFields:n,schema:o,prompt:r});if(a&&a.text)try{return JSON.parse(a.text)}catch(e){throw console.error("Could not parse JSON from structured data extraction:",e),new Error("The AI model returned an invalid format.")}return a},I=async(t,n,o)=>s("processSpreadsheet",{prompt:t,selectedData:n,selectionContext:o}),b=async t=>s("convertPdfToHtml",{pdfBase64:t});export{S as a,x as b,g as c,T as d,A as e,b as f,w as g,I as p};
