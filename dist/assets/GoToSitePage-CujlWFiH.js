import{b as G,n as R,a as $,S as _,u as M,c as B,r,C as O,j as e,F as q,L as z,E as S,B as J}from"./index-DgmZNK3x.js";import{A as v}from"./AdBanner-BHXyFlzY.js";import{c as K}from"./fileUtils-Cb1IM2ig.js";import{T as Q}from"./TemplateEditor-CMJkMKZv.js";import"https://esm.sh/html-docx-js-typescript@0.1.5";import"https://esm.sh/file-saver@2.0.5";const se=()=>{const{countryCode:i,siteId:l}=G(),m=R(),E=$(),[h]=_(),{sites:p,staticDocuments:b,fullDocuments:w,siteSettings:j,loading:N}=M(),{t}=B(),[A,I]=r.useState(!1),[T,D]=r.useState(!1),[F,H]=r.useState(""),a=r.useMemo(()=>{var k;let s=h.get("redirect");const x=h.get("name");if(s)return i&&s.startsWith("/")&&!s.startsWith(`/${i}/`)&&(s=`/${i}${s}`),{name:x||t("adPage.internalPage"),url:s,isInternal:!0};if((k=m.state)!=null&&k.targetUrl)return{name:m.state.siteName||t("adPage.internalPage"),url:m.state.targetUrl,isInternal:!0};const o=Array.isArray(p)?p.find(n=>n.id===l||n.slug===l):null;if(o)return{...o,isInternal:!1};const c=Array.isArray(b)?b.find(n=>n.id===l||n.slug===l):null;if(c){const n=c.slug||c.id;let P="";return c.countryCode&&c.countryCode!=="global"?P=`https://datas.gitut.com/documents/${c.countryCode}/${n}.pdf`:P=`https://datas.gitut.com/documents/${n}.pdf`,{name:c.name,url:P,isInternal:!1}}return null},[p,b,l,m.state,h,i,t]),d=r.useMemo(()=>l&&w.find(s=>s.id===l||s.slug===l)||null,[w,l]),C=r.useMemo(()=>i?O.ar.some(s=>s.code===i):!0,[i]),u=(j==null?void 0:j.ads.pdfInterstitialTimer)??5,[f,y]=r.useState(u),[g,U]=r.useState(null);r.useEffect(()=>{!N&&a&&a.url!==g&&(y(u),U(a.url))},[N,a,u,g]),r.useEffect(()=>{if(g&&f>0){const s=setTimeout(()=>y(x=>x-1),1e3);return()=>clearTimeout(s)}},[f,g]);const L=()=>{a!=null&&a.url&&(a.isInternal?E(a.url,{replace:!0}):window.location.href=a.url)},W=async()=>{var x;if(!d)return;let s=((x=m.state)==null?void 0:x.processedHtml)||"";if(!s&&d.finalTemplateHtml)s=d.finalTemplateHtml;else if(!s&&d.finalTemplateUrl)try{const o=await fetch(K(d.finalTemplateUrl));o.ok&&(s=await o.text())}catch(o){console.error(o)}s?(H(s),y(u),D(!0)):alert("لا يمكن تعديل هذا النوع من الروابط.")};return N?e.jsxs("div",{className:"flex flex-col items-center justify-center p-10 text-center",children:[e.jsx(q,{className:"animate-spin text-4xl text-green-600 mb-4"}),e.jsx("p",{className:"text-gray-600",children:t("signup.loading")})]}):A?e.jsx(Q,{initialHtml:F,docName:(a==null?void 0:a.name)||"document",onClose:()=>I(!1)}):a?e.jsxs("div",{className:"min-h-[80vh] flex flex-col xl:flex-row items-start justify-center p-4 gap-6 lg:gap-8",children:[e.jsxs("aside",{className:"flex flex-col w-full xl:w-80 gap-6 xl:sticky xl:top-24 order-1 xl:order-none",children:[e.jsx(v,{placement:"WAITING_PAGE_RIGHT"}),C&&e.jsx("div",{className:"p-6 bg-green-50 border border-green-200 rounded-xl shadow-sm text-center",children:e.jsxs("div",{className:"text-green-800 font-amiri leading-loose",children:[e.jsx("h3",{className:"font-bold text-lg mb-4 border-b border-green-200 pb-2",children:t("adPage.hadithTitle")}),e.jsxs("p",{className:"text-xl font-medium",children:['"',t("adPage.istighfarContent"),'"']})]})})]}),e.jsx("div",{className:"max-w-3xl w-full text-center flex-grow order-2 xl:order-none",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-lg border space-y-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:t(T?"documentStudioPage.aiCreator.generating":"adPage.preparingLink")}),f>0?e.jsxs("div",{className:"py-8",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:t("adPage.pleaseWait")}),e.jsxs("div",{className:"inline-block relative",children:[e.jsxs("svg",{className:"w-32 h-32 transform -rotate-90",children:[e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"currentColor",strokeWidth:"8",fill:"transparent",className:"text-gray-200"}),e.jsx("circle",{cx:"64",cy:"64",r:"56",stroke:"currentColor",strokeWidth:"8",fill:"transparent",strokeDasharray:351.86,strokeDashoffset:351.86-351.86*f/u,className:"text-green-600 transition-all duration-1000 ease-linear"})]}),e.jsx("div",{className:"absolute top-0 left-0 w-full h-full flex items-center justify-center",children:e.jsx("span",{className:"text-4xl font-bold text-green-600 font-mono",children:f})})]})]}):e.jsxs("div",{className:"my-6 animate-fadeIn",children:[e.jsx("p",{className:"text-green-700 font-semibold mb-4",children:t("adPage.linkReady")}),e.jsx("div",{className:"flex flex-col sm:flex-row justify-center gap-4",children:T?e.jsxs("button",{onClick:()=>I(!0),className:"inline-flex items-center justify-center gap-2 bg-blue-600 text-white text-xl font-bold py-4 px-10 rounded-lg hover:bg-blue-700 transition-colors shadow-lg transform hover:scale-105",children:[e.jsx("span",{children:t("documentStudioPage.aiCreator.editStudio")}),e.jsx(S,{})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:L,className:"inline-flex items-center justify-center gap-2 bg-green-600 text-white text-xl font-bold py-4 px-10 rounded-lg hover:bg-green-700 transition-colors shadow-lg transform hover:scale-105",children:[e.jsx("span",{children:t("adPage.downloadNow")}),e.jsx(J,{})]}),d&&e.jsxs("button",{onClick:W,className:"inline-flex items-center justify-center gap-2 bg-blue-600 text-white text-xl font-bold py-4 px-10 rounded-lg hover:bg-blue-700 transition-colors shadow-lg transform hover:scale-105",children:[e.jsx("span",{children:t("documentStudioPage.table.edit")}),e.jsx(S,{})]})]})})]}),e.jsxs("div",{className:"pt-6 border-t",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:t("adPage.adLabel")}),e.jsx(v,{placement:"PDF_INTERSTITIAL"})]})]})}),e.jsxs("aside",{className:"flex flex-col w-full xl:w-80 gap-6 xl:sticky xl:top-24 order-3 xl:order-none",children:[e.jsx(v,{placement:"WAITING_PAGE_LEFT"}),C&&e.jsx("div",{className:"p-6 bg-blue-50 border border-blue-200 rounded-xl shadow-sm text-center",children:e.jsxs("div",{className:"text-blue-900 font-amiri leading-loose",children:[e.jsx("h3",{className:"font-bold text-lg mb-4 border-b border-green-200 pb-2",children:t("adPage.prayerReminderTitle")}),e.jsx("p",{className:"text-lg mb-2",children:t("adPage.hadithIntro")}),e.jsxs("p",{className:"text-xl font-bold mb-4",children:['"',t("adPage.prayerHadithContent"),'"']}),e.jsx("p",{className:"text-xs text-blue-700",children:t("adPage.prayerHadithSource")})]})})]})]}):e.jsxs("div",{className:"text-center py-20",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:t("serviceDetailPage.serviceNotFound")}),e.jsx("p",{className:"text-gray-600 mb-6",children:t("profilePage.cafeNotFoundMessage")}),e.jsx(z,{to:"/",className:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors",children:t("confirmationPage.backToHome")})]})};export{se as default};
