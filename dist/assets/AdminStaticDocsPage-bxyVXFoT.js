import{u as z,r,j as e,F as D,aY as I,aO as A,bW as w,bX as G,bo as R,bu as $,C as H}from"./index-DgmZNK3x.js";import{R as b}from"./index-ChkOn_r6.js";import{d as q}from"./geminiService-CD7J7Ty3.js";if(b.Quill){const n=b.Quill.import("attributors/style/size");n.whitelist=["8px","9px","10px","11px","12px","14px","16px","18px","20px","22px","24px","28px","36px","48px","72px"],b.Quill.register("attributors/style/size",n,!0)}const Q=n=>n.toLowerCase().trim().replace(/\s+/g,"-").replace(/[^a-z0-9\u0600-\u06FF-]/g,""),B=()=>{const{staticDocuments:n}=z(),[U,g]=r.useState(n),[i,f]=r.useState({isOpen:!1,mode:"create",doc:null}),[a,o]=r.useState({name:"",description:"",fileUrl:"",countryCode:"",tags:""}),[x,y]=r.useState(null),[j,N]=r.useState(!1),[v,C]=r.useState(!1),[S,d]=r.useState("");r.useEffect(()=>g(n),[n]);const k=()=>{o({name:"",description:"",fileUrl:"",countryCode:"",tags:""}),y(null),d(""),f({isOpen:!0,mode:"create",doc:null})},O=t=>{o({name:t.name,description:t.description,fileUrl:t.fileUrl,countryCode:t.countryCode||"",tags:t.tags||""}),y(null),d(""),f({isOpen:!0,mode:"edit",doc:t})},F=()=>{f({isOpen:!1,mode:"create",doc:null})},T=t=>{t.target.files&&t.target.files[0]&&y(t.target.files[0])},M=async()=>{var t,s;if(!a.name.trim()){alert("يرجى إدخال اسم المستند أولاً.");return}C(!0);try{const l=a.countryCode||"dz",c=R(l),m=((t=$.find(u=>u.code===c))==null?void 0:t.name)||"Arabic",p=((s=H.en.find(u=>u.code===l))==null?void 0:s.name)||l,h=`
            Act as a professional technical writer and SEO specialist.
            Write a comprehensive and high-quality description for an official document named "${a.name}".
            
            Context:
            - This is a static PDF document available for download.
            - It is used in: ${p}.
            - The audience is general citizens or employees.
            
            IMPORTANT RULES:
            1. Language: The content MUST be written in ${m} language.
            2. Length: The description MUST be concise and strictly NOT exceed 20 lines.
            3. Structure: 
               - Start IMMEDIATELY with a paragraph (<p>) defining the document. **Do NOT start with a Heading (<h1>, <h2>, etc.).**
               - Use <h3> tags for subsequent sections (e.g., \\"Purpose\\", \\"How to Fill\\", \\"Requirements\\").
               - Use <ul> or <ol> lists where appropriate.
            4. Format: Return HTML content only.
            `,L=await q({model:"gemini-2.5-flash",contents:h});o(u=>({...u,description:L.text||""}))}catch(l){console.error("AI Error:",l),alert("فشل توليد الوصف. يرجى المحاولة مرة أخرى.")}finally{C(!1)}},P=async t=>{if(t.preventDefault(),!x&&!a.fileUrl){alert("يرجى اختيار ملف أولاً.");return}const s=Q(a.name),l=a.countryCode||"global";N(!0),d("Starting process...");try{let c=a.fileUrl;if(x){if(x.type!=="application/pdf"){alert("يرجى اختيار ملف PDF."),N(!1),d("");return}d("Uploading PDF to GitHub..."),c=await G(x,l,s)}const m={...a,slug:s,fileUrl:c,countryCode:l};d("Saving metadata..."),i.mode==="create"?(await w.create(m),g(p=>[...p,{...m,id:"new-"+Date.now(),slug:m.slug||""}])):i.doc&&(await w.update(i.doc.id,m),g(p=>p.map(h=>h.id===i.doc.id?{...m,id:i.doc.id}:h))),alert("تم رفع ملف PDF بنجاح!"),F()}catch(c){console.error("Failed to save static doc:",c),alert(`فشل الحفظ: ${c.message}`)}finally{N(!1),d("")}},E=async t=>{if(window.confirm("هل أنت متأكد من أنك تريد حذف هذا المستند؟"))try{await w.delete(t),g(s=>s.filter(l=>l.id!==t)),alert("تم الحذف بنجاح!")}catch(s){console.error("Failed to delete static doc:",s),alert("فشل الحذف.")}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"إدارة المستندات الثابتة (PDF)"}),e.jsx("button",{onClick:k,className:"bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 transition-colors",children:"+ إضافة مستند جديد"})]}),e.jsx("div",{className:"bg-white p-2 rounded-lg border shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-right",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 font-semibold text-sm text-gray-600",children:"اسم المستند"}),e.jsx("th",{className:"p-3 font-semibold text-sm text-gray-600",children:"الوصف"}),e.jsx("th",{className:"p-3 font-semibold text-sm text-gray-600",children:"البلد"}),e.jsx("th",{className:"p-3 font-semibold text-sm text-gray-600",children:"إجراءات"})]})}),e.jsx("tbody",{children:U.map(t=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 text-gray-800 font-semibold",children:t.name}),e.jsx("td",{className:"p-3 text-gray-600 text-sm max-w-md",title:t.description.replace(/<[^>]*>?/gm,""),children:e.jsx("div",{className:"prose prose-sm max-w-none line-clamp-2 compact-prose",dangerouslySetInnerHTML:{__html:t.description}})}),e.jsx("td",{className:"p-3 text-gray-600",children:t.countryCode||"الكل"}),e.jsxs("td",{className:"p-3 space-x-4 space-x-reverse",children:[t.slug&&e.jsx("a",{href:`/${t.countryCode||"dz"}/doc/${t.slug}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline text-sm font-semibold",children:"معاينة"}),e.jsx("button",{onClick:()=>O(t),className:"text-green-600 hover:underline text-sm font-semibold",children:"تعديل"}),e.jsx("button",{onClick:()=>E(t.id),className:"text-red-600 hover:underline text-sm font-semibold",children:"حذف"})]})]},t.id))})]})})}),i.isOpen&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl",children:e.jsxs("form",{onSubmit:P,children:[e.jsx("div",{className:"p-6 border-b",children:e.jsx("h2",{className:"text-2xl font-bold",children:i.mode==="create"?"إضافة مستند جديد":"تعديل المستند"})}),e.jsxs("div",{className:"p-6 space-y-4 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"اسم المستند"}),e.jsx("input",{type:"text",id:"name",value:a.name,onChange:t=>o(s=>({...s,name:t.target.value})),required:!0,className:"block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"الوصف"}),e.jsxs("button",{type:"button",onClick:M,disabled:v,className:"flex items-center gap-1 text-xs bg-purple-100 text-purple-700 font-semibold py-1 px-2 rounded-md hover:bg-purple-200 disabled:opacity-50",title:"إنشاء وصف ذكي بالذكاء الاصطناعي (بحد أقصى 20 سطراً)",children:[v?e.jsx(D,{className:"animate-spin"}):e.jsx(I,{}),e.jsx("span",{children:"توليد وصف بالذكاء الاصطناعي"})]})]}),e.jsx(b,{theme:"snow",value:a.description,onChange:t=>o(s=>({...s,description:t})),modules:{toolbar:[[{size:["8px","9px","10px","11px","12px","14px","16px","18px","20px","22px","24px","28px","36px","48px","72px",!1]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],[{direction:"rtl"},{align:[]}],["link","image","video"],["clean"]]}})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags",className:"block text-sm font-medium text-gray-700 mb-1",children:"الوسوم (مفصولة بفاصلة)"}),e.jsx("input",{type:"text",id:"tags",value:a.tags||"",onChange:t=>o(s=>({...s,tags:t.target.value})),placeholder:"مثال: سيرة ذاتية, طلب, عمل",className:"block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"countryCode",className:"block text-sm font-medium text-gray-700 mb-1",children:"البلد (رمز، مثال: dz)"}),e.jsx("input",{type:"text",id:"countryCode",value:a.countryCode||"",onChange:t=>o(s=>({...s,countryCode:t.target.value.toLowerCase()})),placeholder:"اتركه فارغًا للكل",className:"block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500"})]}),e.jsxs("div",{className:"space-y-3 border-t pt-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"رفع ملف PDF (سيتم رفعه كما هو)"}),e.jsx("div",{children:e.jsxs("label",{className:"w-full flex items-center justify-center gap-2 bg-blue-100 text-blue-800 font-semibold py-3 px-4 rounded-lg hover:bg-blue-200 transition-colors cursor-pointer",children:[e.jsx(A,{}),e.jsx("span",{children:x?`تم اختيار: ${x.name}`:"اختر ملف PDF"}),e.jsx("input",{type:"file",accept:".pdf",onChange:T,className:"hidden"})]})}),S&&e.jsx("p",{className:"text-blue-600 text-xs animate-pulse text-center",children:S}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"fileUrl",className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط الملف (PDF)"}),e.jsx("input",{type:"url",id:"fileUrl",value:a.fileUrl,readOnly:!0,className:"block w-full px-3 py-2 bg-gray-100 border border-gray-300 rounded-md shadow-sm"})]})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:F,className:"bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-300",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:j,className:"bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 flex items-center gap-2",children:[j?e.jsx(D,{className:"animate-spin"}):null,e.jsx("span",{children:j?"جاري الرفع...":"حفظ"})]})]})]})})})]})};export{B as default};
