import{b as T,a as B,u as P,c as R,o as k,r as u,C as G,j as e,F as M,L as Y,d as A,m as U,J as V}from"./index-hpjxKmld.js";import{B as Q}from"./BlogPostCard-D6DNRi5z.js";import{S as X}from"./SocialShareButtons-BzmR53dp.js";import{A as E}from"./AdBanner-Asof6Iy0.js";const a=(n,d,g=!0)=>{const f=g?`meta[property='${n}']`:`meta[name='${n}']`;let i=document.querySelector(f);i||(i=document.createElement("meta"),i.setAttribute(g?"property":"name",n),document.head.appendChild(i)),i.setAttribute("content",d)},y=n=>n?n.replace(/[أإآ]/g,"ا").replace(/ة/g,"ه").toLowerCase():"",q=()=>{const{countryCode:n,slug:d}=T(),g=B(),{sites:f,blogPosts:i,siteSettings:x,loading:S}=P(),{language:c,t:I}=R(),{user:_}=k(),[t,v]=u.useState(null),[L,p]=u.useState(!0);u.useEffect(()=>{var o,s,r,l;if(t&&x){const m=((o=x.seo)==null?void 0:o[n||"dz"])||((s=x.seo)==null?void 0:s.default),h=((l=(r=G[c])==null?void 0:r.find(F=>F.code===n))==null?void 0:l.name)||n,b=`استخراج ${t.name} في ${h} ${m.titleSeparator} ${m.siteName}`,j=t.description?t.description.replace(/<[^>]*>/g,""):"",w=j?j.substring(0,160)+(j.length>160?"...":""):m.metaDescription,N="https://blogger.googleusercontent.com/img/a/AVvXsEjIwicMdgBHGgVbeX1gPl9n9PhWFzZvLJ5hiGy923-34GGSM59Q5EwGmpmUibE3dexwLH6tk_Y_3QYLIUZC2YA9L3xhY4XVNVW1HCi1UoZhNv-RYbnOjtxMIXo014Yg4Eqv9bCQ5d6z4j4NnKoE7fpQvW7Dla3Y5QFk0N0I28kNCfnDBGWXq0Rx5VC7f58=s16000",D=c==="ar"?"ar_AR":c==="fr"?"fr_FR":"en_US";document.title=b,a("description",w,!1),a("og:title",b),a("og:description",w),a("og:image",N),a("og:image:secure_url",N),a("og:image:width","1200"),a("og:image:height","630"),a("og:url",window.location.href),a("og:type","website"),a("og:site_name",m.siteName),a("og:locale",D),a("twitter:card","summary_large_image",!1),a("twitter:url",window.location.href,!1),a("twitter:title",b,!1),a("twitter:description",w,!1),a("twitter:image",N,!1)}},[t,x,n,c]),u.useEffect(()=>{(async()=>{if(!d){p(!1);return}if(S)return;p(!0);let s=null;const r=f.find(l=>l.slug===d);if(r)s=r;else try{s=await V(d)}catch(l){console.error("Failed to fetch site by slug:",l)}s&&s.countryCode&&s.countryCode!==n?v(null):v(s),p(!1)})()},[d,f,S,n,_]);const C=u.useMemo(()=>{if(!(t!=null&&t.tags)||!i)return[];const o=t.tags.split(",").map(s=>y(s.trim())).filter(Boolean);return o.length===0?[]:i.filter(s=>{if(!s.enabled)return!1;const r=s.content[c]||Object.values(s.content)[0];if(!r)return!1;const l=y(s.title),m=y(r.replace(/<[^>]*>/g,""));return o.some(h=>l.includes(h)||m.includes(h))}).sort((s,r)=>(r.publishedAt||r.createdAt).toDate().getTime()-(s.publishedAt||s.createdAt).toDate().getTime()).slice(0,4)},[t,i,n,c]);if(L)return e.jsx("div",{className:"flex justify-center items-center p-10",children:e.jsx(M,{className:"animate-spin text-4xl text-green-600"})});if(!t)return e.jsxs("div",{className:"text-center py-20",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"لم يتم العثور على الموقع"}),e.jsx(Y,{to:`/${n}/services`,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700",children:"العودة إلى قائمة الخدمات"})]});const $=t.type==="static";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8 flex-grow",children:[e.jsxs("main",{className:"md:col-span-3 bg-white rounded-lg shadow-xl p-6 md:p-8 flex flex-col",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("header",{className:"mb-6 border-b pb-4",children:e.jsx("h1",{className:"text-4xl font-bold text-gray-900",children:t.name})}),e.jsx("div",{className:"prose prose-lg max-w-none text-gray-800",dangerouslySetInnerHTML:{__html:t.description||"<p>لا يوجد وصف متاح لهذا الموقع.</p>"}}),e.jsxs("div",{className:"my-6 p-4 bg-blue-50 border-l-4 border-blue-400 text-blue-800 rounded-md",role:"alert",children:[e.jsx("p",{className:"font-bold",children:"ملاحظة هامة"}),e.jsxs("p",{children:["أزرار التعبئة أو الذهاب الى هذا الموقع موجودة في ",e.jsx("strong",{children:"أسفل هذه الصفحة"}),"."]})]}),e.jsx("div",{className:"my-6",children:e.jsx(E,{placement:"SERVICE_DETAIL_MAIN_TOP"})})]}),e.jsx("div",{className:"mt-8 pt-6 border-t",children:e.jsx("div",{className:"flex flex-col sm:flex-row gap-4",children:$?e.jsxs("button",{onClick:()=>g(`/${n}/go-to-site/${t.id}`),className:"flex items-center justify-center gap-3 w-full md:w-auto bg-green-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(A,{}),e.jsx("span",{children:"زيارة الموقع"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>g(`/${n}/find-cafe`,{state:{documentIds:[t.id]}}),className:"flex items-center justify-center gap-3 w-full md:w-auto bg-green-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(U,{}),e.jsx("span",{children:"تعبئة هذا المستند"})]}),e.jsxs("button",{onClick:()=>g(`/${n}/go-to-site/${t.id}`),className:"flex items-center justify-center gap-3 w-full md:w-auto bg-gray-200 text-gray-800 font-bold py-3 px-8 rounded-lg hover:bg-gray-300 transition-colors",children:[e.jsx(A,{}),e.jsx("span",{children:"زيارة الموقع"})]})]})})})]}),e.jsxs("aside",{className:"md:col-span-1 space-y-6",children:[C.length>0&&e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-lg border",children:[e.jsx("h3",{className:"font-bold text-lg mb-3 text-gray-800",children:I("relatedPosts.title")}),e.jsx("div",{className:"space-y-4",children:C.map(o=>e.jsx(Q,{post:o,lang:c},o.id))})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-lg border",children:e.jsx(E,{placement:"SITE_DETAIL_SIDEBAR"})})]})]}),e.jsx(X,{url:window.location.href,title:t.name,description:t.description||""})]})};export{q as default};
