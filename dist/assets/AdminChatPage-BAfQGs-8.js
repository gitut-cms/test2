import{c as b,p,r as c,j as e,Z as o,be as j}from"./index-hpjxKmld.js";import{C as N}from"./ChatWindow-CzFxpN2o.js";const v=()=>{var x;b();const{useAdminChatManager:m}=p(),{conversations:n,messages:g,currentConversationId:a,selectConversation:h,sendMessage:f,onlineCafeIds:l}=m(),[r,u]=c.useState(!1),i=c.useMemo(()=>{let t=Array.from(n.entries());return r&&(t=t.filter(([s])=>l.has(s))),t.sort(([,s],[,d])=>d.lastMessage.timestamp-s.lastMessage.timestamp)},[n,r,l]);return e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-6",children:"دردشة الدعم الفني"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 items-start h-[75vh]",children:[e.jsxs("aside",{className:"lg:col-span-1 bg-gray-50 rounded-lg p-4 border max-h-full overflow-y-auto flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 pb-2 border-b",children:[e.jsxs("h2",{className:"font-bold text-lg flex items-center gap-2",children:[e.jsx(o,{className:"text-blue-500"}),e.jsxs("span",{children:["المحادثات (",i.length,")"]})]}),e.jsxs("button",{onClick:()=>u(!r),className:`flex items-center gap-1 text-xs px-3 py-1 rounded-full border transition-all ${r?"bg-green-600 text-white border-green-700 shadow-md":"bg-white text-gray-600 hover:bg-gray-100"}`,children:[e.jsx(j,{size:10}),e.jsx("span",{children:"المتصلين"})]})]}),i.length>0?e.jsx("div",{className:"space-y-2 flex-grow overflow-y-auto pr-1",children:i.map(([t,s])=>{const d=l.has(t);return e.jsxs("button",{onClick:()=>h(t),className:`w-full text-right p-4 rounded-xl border-2 transition-all flex justify-between items-start group ${a===t?"bg-blue-50 border-blue-500 ring-1 ring-blue-500":"bg-white hover:border-gray-300 border-transparent shadow-sm"}`,children:[e.jsxs("div",{className:"flex-grow overflow-hidden",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"font-bold text-gray-800 truncate",children:s.cafeName}),d&&e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500 animate-pulse"})]}),e.jsxs("p",{className:"text-xs text-gray-500 truncate leading-relaxed",children:[e.jsx("span",{className:"font-medium text-gray-400",children:s.lastMessage.senderId==="admin"?"أنت: ":""}),s.lastMessage.text]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2 ml-2",children:[e.jsx("span",{className:"text-[10px] text-gray-400 font-mono",children:new Date(s.lastMessage.timestamp).toLocaleTimeString("ar-DZ",{hour:"2-digit",minute:"2-digit"})}),s.unread&&e.jsx("div",{className:"w-3 h-3 bg-blue-600 rounded-full shadow-sm"})]})]},t)})}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-10 opacity-40",children:[e.jsx(o,{size:40,className:"mb-2"}),e.jsx("p",{className:"text-sm",children:"لا توجد محادثات نشطة"})]})]}),e.jsx("main",{className:"lg:col-span-2 bg-white rounded-lg border shadow-sm h-full flex flex-col overflow-hidden",children:a?e.jsx(N,{messages:g,onSendMessage:f,currentUserId:"admin",title:((x=n.get(a))==null?void 0:x.cafeName)||"محادثة دعم",isOnline:l.has(a)}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-8 bg-gray-50",children:[e.jsx("div",{className:"bg-white p-6 rounded-full shadow-inner mb-4",children:e.jsx(o,{className:"text-6xl text-gray-200"})}),e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:"مركز دعم المقاهي"}),e.jsx("p",{className:"text-gray-500 mt-2 max-w-sm",children:"اختر أحد المقاهي من القائمة الجانبية للبدء في تقديم الدعم الفني وحل المشكلات بشكل فوري."})]})})]})]})};export{v as default};
