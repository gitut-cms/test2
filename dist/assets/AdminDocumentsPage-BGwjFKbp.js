import{u as pt,r as d,c as Yt,a as Bt,j as e,F as q,aY as ue,bs as mt,I as we,bM as Wt,C as Pe,by as Kt,l as ut,a0 as Xt,bd as Zt,bN as es,$ as ts,Q as Ge,a7 as ss,z as ls,A as ns,b0 as as,bO as rs,b4 as ee,bm as Fe,bp as fe,b1 as _e,bP as is,H as Ve,bo as gt,bu as xt}from"./index-hpjxKmld.js";import{f as os}from"./constants-DfStgaks.js";import{R as Ee}from"./index-ClBT1-8W.js";import{d as Me}from"./geminiService-DifXNJPz.js";import{e as He,d as De,c as A,f as ht}from"./staticHtmlGenerator-D8IoKVrH.js";if(Ee.Quill){const f=Ee.Quill.import("attributors/style/size");f.whitelist=["8px","9px","10px","11px","12px","14px","16px","18px","20px","22px","24px","28px","36px","48px","72px"],Ee.Quill.register("attributors/style/size",f,!0)}const ge=f=>f.toLowerCase().trim().replace(/\s+/g,"-").replace(/[^a-z0-9\u0600-\u06FF-]/g,""),ds=f=>{let z=`<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
`;return f.forEach(R=>{z+=`  <url><loc>${R}</loc></url>
`}),z+="</urlset>",z},Q=f=>{if(!f)return f;const R=f.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim().split(" ").length;let F="12pt",H="1.5";R>300?(F="11pt",H="1.1"):R>200?(F="12pt",H="1.3"):(F="14pt",H="1.6");const D=`
        .content, body { font-size: ${F} !important; line-height: ${H} !important; }
        ${R>300?"ul, ol { margin-top: 5px; margin-bottom: 5px; } li { margin-bottom: 2px; }":""}
    `;return f.includes("</style>")?f.replace("</style>",`${D}</style>`):f.includes("</head>")?f.replace("</head>",`<style>${D}</style></head>`):`<style>${D}</style>`+f},cs=({isOpen:f,fieldId:z,onClose:R,onSave:F})=>{const[H,D]=d.useState("text"),[E,M]=d.useState(""),[J,O]=d.useState(""),[$,te]=d.useState("simple"),[j,se]=d.useState([]),[P,V]=d.useState(""),[T,L]=d.useState([]),[N,le]=d.useState(""),[Y,G]=d.useState("");d.useEffect(()=>{f&&(D("text"),se([]),V(""),L([]),M(""),O(""),te("simple"),le(""),G(""))},[f,z]);const ne=()=>{P.trim()&&(se([...j,P.trim()]),V(""))},Ae=n=>{se(j.filter((i,m)=>m!==n))},de=()=>{L([...T,{label:"",value:""}])},xe=(n,i,m)=>{const y=[...T];y[n]={...y[n],[i]:m},i==="label"&&!y[n].value&&(y[n].value=ge(m)),L(y)},k=n=>{const i=[...T];i[n].subField?(delete i[n].subField,delete i[n].outputTemplate):(i[n].subField={type:"text",customQuestion:""},i[n].outputTemplate=`${i[n].label} {subValue}`),L(i)},be=(n,i,m)=>{const y=[...T];y[n].subField&&(y[n].subField={...y[n].subField,[i]:m}),L(y)},ce=n=>{const i=[...T];i[n].mappedValues={...i[n].mappedValues,"":""},L(i)},B=(n,i,m,y)=>{const re=[...T],_={...re[n].mappedValues};i!==m&&delete _[i],_[m]=y,re[n].mappedValues=_,L(re)},W=(n,i)=>{const m=[...T],y={...m[n].mappedValues};delete y[i],m[n].mappedValues=y,L(m)},ae=n=>{L(T.filter((i,m)=>m!==n))},ye=()=>{const n={type:H};if(E.trim()&&(n.customQuestion=E),J.trim()&&(n.placeholder=J),H==="select")if($==="simple")n.options=j;else if($==="builder"){const i=T.filter(m=>m.label.trim()!=="");n.options=i}else try{const i=JSON.parse(N);if(!Array.isArray(i))throw new Error("JSON must be an array.");n.options=i}catch(i){G(i.message);return}F(n)};return f?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-[100] flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl animate-fadeIn max-h-[90vh] overflow-y-auto",onClick:n=>n.stopPropagation(),children:[e.jsx("div",{className:"p-4 border-b bg-gray-50 rounded-t-lg",children:e.jsxs("h3",{className:"text-lg font-bold text-gray-800",children:["إعداد الحقل: ",e.jsx("span",{className:"text-blue-600 font-mono",dir:"ltr",children:z})]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"نوع الحقل"}),e.jsxs("select",{value:H,onChange:n=>D(n.target.value),className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 outline-none",children:[e.jsx("option",{value:"text",children:"نص عادي (Text)"}),e.jsx("option",{value:"select",children:"قائمة اختيار (Select)"}),e.jsx("option",{value:"date",children:"تاريخ (Date)"}),e.jsx("option",{value:"number",children:"رقم (Number)"})]})]}),H==="select"&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-md border shadow-inner",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 border-b pb-2",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700",children:"خيارات القائمة"}),e.jsxs("div",{className:"flex gap-1 text-xs",children:[e.jsx("button",{type:"button",onClick:()=>te("simple"),className:`px-3 py-1 rounded-full transition-colors ${$==="simple"?"bg-blue-600 text-white shadow":"bg-white text-gray-600 border"}`,children:"بسيط (نصوص)"}),e.jsxs("button",{type:"button",onClick:()=>te("builder"),className:`px-3 py-1 rounded-full transition-colors flex items-center gap-1 ${$==="builder"?"bg-purple-600 text-white shadow":"bg-white text-gray-600 border"}`,children:[e.jsx(is,{})," منشئ شرطي"]}),e.jsx("button",{type:"button",onClick:()=>te("json"),className:`px-3 py-1 rounded-full transition-colors ${$==="json"?"bg-gray-800 text-white shadow":"bg-white text-gray-600 border"}`,children:"كود JSON"})]})]}),$==="simple"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",value:P,onChange:n=>V(n.target.value),className:"flex-grow p-2 border rounded-md text-sm",placeholder:"أضف خيار...",onKeyDown:n=>n.key==="Enter"&&ne()}),e.jsx("button",{onClick:ne,className:"bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700",children:e.jsx(we,{})})]}),e.jsxs("ul",{className:"space-y-1 max-h-48 overflow-y-auto",children:[j.map((n,i)=>e.jsxs("li",{className:"flex justify-between items-center bg-white p-2 rounded text-sm border shadow-sm",children:[e.jsx("span",{children:n}),e.jsx("button",{onClick:()=>Ae(i),className:"text-red-500 hover:text-red-700",children:e.jsx(Ve,{size:12})})]},i)),j.length===0&&e.jsx("p",{className:"text-xs text-gray-400 text-center py-2",children:"لا توجد خيارات مضافة."})]})]}),$==="builder"&&e.jsxs("div",{className:"space-y-3 max-h-[50vh] overflow-y-auto pr-1",children:[T.map((n,i)=>e.jsxs("div",{className:"bg-white border rounded-lg p-3 shadow-sm relative group",children:[e.jsx("button",{onClick:()=>ae(i),className:"absolute top-2 left-2 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Ve,{})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-500 uppercase font-bold",children:"اسم الخيار (يظهر للزبون)"}),e.jsx("input",{className:"w-full p-1 border rounded text-sm bg-gray-50 focus:bg-white focus:ring-1 focus:ring-purple-500",value:n.label,onChange:m=>xe(i,"label",m.target.value),placeholder:"مثال: متزوج"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-500 uppercase font-bold",children:"القيمة (Value)"}),e.jsx("input",{className:"w-full p-1 border rounded text-sm font-mono text-gray-600",value:n.value,onChange:m=>xe(i,"value",m.target.value),placeholder:"auto-generated"})]})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-blue-700",children:"قيم متغيرة (Mapped Values)"}),e.jsxs("button",{type:"button",onClick:()=>ce(i),className:"text-[10px] bg-blue-100 text-blue-700 px-2 py-0.5 rounded hover:bg-blue-200",children:[e.jsx(we,{className:"inline"})," إضافة"]})]}),n.mappedValues&&Object.entries(n.mappedValues).map(([m,y],re)=>e.jsxs("div",{className:"flex gap-1 mb-1 items-center",children:[e.jsx("input",{className:"w-1/3 p-1 text-xs border rounded bg-gray-50 font-mono",placeholder:"المفتاح (Key)",value:m,onChange:_=>B(i,m,_.target.value,y)}),e.jsx("span",{className:"text-gray-400",children:"="}),e.jsx("input",{className:"flex-grow p-1 text-xs border rounded",placeholder:"القيمة (Value)",value:y,onChange:_=>B(i,m,m,_.target.value)}),e.jsx("button",{type:"button",onClick:()=>W(i,m),className:"text-red-400 hover:text-red-600 px-1",children:e.jsx(Ve,{size:10})})]},re)),(!n.mappedValues||Object.keys(n.mappedValues).length===0)&&e.jsx("p",{className:"text-[10px] text-gray-400 italic",children:"لا توجد قيم مرتبطة."})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 mt-2 pt-2 border-t",children:[e.jsx("input",{type:"checkbox",id:`toggle-sub-${i}`,checked:!!n.subField,onChange:()=>k(i),className:"rounded text-purple-600 focus:ring-purple-500"}),e.jsx("label",{htmlFor:`toggle-sub-${i}`,className:"text-xs font-semibold text-gray-700 cursor-pointer select-none",children:"تفعيل سؤال فرعي لهذا الخيار؟ (مثال: عدد الأولاد)"})]}),n.subField&&e.jsxs("div",{className:"bg-purple-50 p-3 rounded border border-purple-100 mt-2 animate-fadeIn",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-2",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"text-[10px] text-purple-800 font-bold block",children:"نوع السؤال الفرعي"}),e.jsxs("select",{className:"w-full p-1 border rounded text-xs bg-white",value:n.subField.type,onChange:m=>be(i,"type",m.target.value),children:[e.jsx("option",{value:"text",children:"نص"}),e.jsx("option",{value:"number",children:"رقم"}),e.jsx("option",{value:"date",children:"تاريخ"}),e.jsx("option",{value:"select",children:"قائمة فرعية"})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-[10px] text-purple-800 font-bold block",children:"نص السؤال الفرعي"}),e.jsx("input",{className:"w-full p-1 border rounded text-xs",value:n.subField.customQuestion||"",onChange:m=>be(i,"customQuestion",m.target.value),placeholder:"مثال: كم عدد الأولاد؟"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-purple-800 font-bold block mb-1",children:"صيغة الإخراج النهائية (Template)"}),e.jsx("div",{className:"flex gap-2",children:e.jsx("input",{className:"flex-grow p-1 border rounded text-xs",value:n.outputTemplate||"",onChange:m=>xe(i,"outputTemplate",m.target.value),placeholder:"مثال: متزوج وله {subValue} أولاد"})}),e.jsxs("p",{className:"text-[10px] text-gray-500 mt-1",children:["استخدم ",e.jsx("code",{children:"{subValue}"})," لدمج إجابة الزائر في الجملة. استخدم ",e.jsx("code",{children:"{self}"})," لاسم الخيار."]})]})]})]},i)),e.jsxs("button",{onClick:de,className:"w-full py-2 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-purple-500 hover:text-purple-600 hover:bg-purple-50 transition-colors flex items-center justify-center gap-2 font-semibold",children:[e.jsx(we,{})," إضافة خيار جديد"]})]}),$==="json"&&e.jsxs(e.Fragment,{children:[e.jsx("textarea",{value:N,onChange:n=>le(n.target.value),className:"w-full h-48 p-2 border rounded-md text-xs font-mono bg-gray-900 text-green-400",placeholder:`[
  { "value": "male", "label": "رجل", "mappedValues": { "opponent_role": "المحامي" } },
  { "value": "female", "label": "امرأة", "mappedValues": { "opponent_role": "المحامية" } }
]`,dir:"ltr"}),Y&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-bold",children:Y})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"سؤال مخصص (يظهر للزبون)"}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("input",{type:"text",value:E,onChange:n=>M(n.target.value),className:"flex-grow p-2 border rounded-md",placeholder:"مثال: ما هو الاسم الكامل؟"})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"نص توضيحي (Placeholder)"}),e.jsx("input",{type:"text",value:J,onChange:n=>O(n.target.value),className:"w-full p-2 border rounded-md",placeholder:"مثال: اكتب الاسم هنا..."})]})]}),e.jsxs("div",{className:"p-4 border-t bg-gray-50 flex justify-end gap-2 rounded-b-lg",children:[e.jsx("button",{onClick:R,className:"px-4 py-2 bg-gray-200 rounded-md hover:bg-gray-300 text-gray-800 font-semibold transition-colors",children:"إلغاء"}),e.jsx("button",{onClick:ye,className:"px-4 py-2 bg-green-600 rounded-md hover:bg-green-700 text-white font-bold transition-colors",children:"حفظ وإدراج"})]})]})}):null},ps=({isOpen:f,onClose:z,onGenerate:R})=>{const[F,H]=d.useState(""),[D,E]=d.useState("dz"),[M,J]=d.useState(!1),[O,$]=d.useState(""),te=async()=>{if(!F.trim())return;J(!0),$("");const j=`
Create a single JSON object representing a document template for the context: "${F}".
Target Country: "${D}".
Language: The content must be in the official language of ${D}.
**IMPORTANT:** Always include "[DateToday]" in the "requiredFields" array and use it in the HTML template for the date. Do NOT include it in "fieldCustomizations" as it is auto-filled.

Structure must match this TypeScript interface:
interface Document {
  id: string; // Unique, English, kebab-case (e.g., "request-form-dz")
  groupId: string; // Same as id
  name: string; // In target language
  description: string; // HTML format (<p>...</p>), detailed, in target language.
  countryCode: string; // "${D}"
  requiredFields: string[]; // Array of field keys (e.g., "fullName", "address", "DateToday", "gender")
  fieldCustomizations: {
    [key: string]: {
      type: "text" | "date" | "number" | "textarea" | "select";
      customQuestion: string; // The label/question in target language
      placeholder?: string; // Optional placeholder
      options?: Array<{ // Use this specific structure for select options
         label: string; 
         value: string;
         subField?: { // If this option needs more info
             type: "text" | "number" | "date";
             customQuestion: string;
         };
         outputTemplate?: string; // Template for final doc if subField is used
         mappedValues?: Record<string, string>; // Maps a selected option to other field values (e.g., titles)
      }>; 
    }
  };
  finalTemplateHtml: string; // THE FULL HTML string
  previewTemplateHtml: string; // A simplified HTML string
}

CRITICAL HTML RULES:
1. The HTML must strictly follow this structure. DO NOT CHANGE THE CSS classes or layout, only the font:
<!DOCTYPE html><html lang="[LANG_CODE]" dir="[DIR]"><head><meta charset="utf-8"><link href="[FONT_URL]" rel="stylesheet"><style>@page{size:A4;margin:0}body{margin:0;padding:0;font-family:'[FONT_NAME]',serif}.page{width:210mm;height:297mm;padding:25mm;margin:0 auto;display:flex;flex-direction:column;box-sizing:border-box;background:white;overflow:hidden}.header{display:flex;justify-content:space-between;margin-bottom:20px;font-size:14pt}.title{text-align:center;font-size:22pt;font-weight:700;text-decoration:underline;margin:30px 0 50px 0}.content{flex-grow:1;font-size:18pt;line-height:2;text-align:justify}.footer{margin-top:40px;display:flex;justify-content:space-between;font-size:16pt}.signature-box{min-width:200px;text-align:center}</style></head><body><div class="page"> ... CONTENT WITH [placeholders] ... </div></body></html>

2. FONT SELECTION:
   - If Arabic (dz, sa, eg, etc): Use 'Scheherazade New', URL: 'https://fonts.googleapis.com/css2?family=Scheherazade+New:wght@400;700&display=swap', dir="rtl"
   - If Japanese: Use 'Noto Serif JP', URL: 'https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&display=swap', dir="ltr"
   - If Latin (en, fr, etc): Use 'Merriweather', URL: 'https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap', dir="ltr"

3. DYNAMIC TYPOGRAPHY & SCALING (CRITICAL):
   - You MUST analyze the length of the generated content text.
   - **MODIFY the CSS inside the <style> tag based on content length:**
     - If content is LONG (> 300 words): Use \`.content { font-size: 11pt; line-height: 1.1; }\`
     - If content is MEDIUM (200-300 words): Use \`.content { font-size: 12pt; line-height: 1.3; }\`
     - If content is SHORT (< 200 words): Use \`.content { font-size: 14pt; line-height: 1.6; }\`
   - **GOAL:** Ensure the text fits perfectly on ONE A4 page without overflowing and without leaving too much empty space. The footer/signature MUST be visible at the bottom.
   - **LINE LIMIT (STRICT):** The total number of lines in the generated document body MUST NOT exceed 20 lines to ensure it fits perfectly on a single A4 page.

4. SPECIAL GENDER FIELDS (CRITICAL - MANDATORY):
   - **MANDATORY**: Distinguish between the Recipient and the Applicant.
   - Applicant/Sender (The person filing the doc): ALL words referring to the applicant that change with gender (e.g., 'I the undersigned', 'Born', 'Resident', 'Signer', 'Declarant') MUST be replaced with placeholders linked to the 'gender' field's mappedValues.
`;try{let P=(await Me({model:"gemini-2.5-flash",contents:j})).text||"";P=P.replace(/```json/g,"").replace(/```/g,"").trim();const V=JSON.parse(P);V.finalTemplateHtml&&(V.finalTemplateHtml=Q(V.finalTemplateHtml)),R(V),z()}catch(se){console.error("AI Generation Error:",se),$("Failed to generate document. Please try again.")}finally{J(!1)}};return f?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-[100] flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md animate-fadeIn",onClick:j=>j.stopPropagation(),children:[e.jsx("div",{className:"p-4 border-b rounded-t-lg bg-purple-50",children:e.jsxs("h3",{className:"text-lg font-bold text-purple-800 flex items-center gap-2",children:[e.jsx(rs,{})," توليد مستند بالذكاء الاصطناعي"]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"موضوع المستند / الاسم"}),e.jsx("input",{type:"text",value:F,onChange:j=>H(j.target.value),placeholder:"مثال: طلب عطلة أمومة، تصريح شرفي...",className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-purple-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"البلد (Country Code)"}),e.jsx("input",{type:"text",value:D,onChange:j=>E(j.target.value),placeholder:"dz, fr, sa...",className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-purple-500 outline-none"})]}),O&&e.jsx("p",{className:"text-red-500 text-sm",children:O})]}),e.jsxs("div",{className:"p-4 border-t bg-gray-50 flex justify-end gap-2 rounded-b-lg",children:[e.jsx("button",{onClick:z,className:"px-4 py-2 bg-gray-200 rounded-md hover:bg-gray-300 text-gray-800 font-semibold transition-colors",children:"إلغاء"}),e.jsxs("button",{onClick:te,disabled:M||!F,className:"px-4 py-2 bg-purple-600 rounded-md hover:bg-purple-700 text-white font-bold transition-colors disabled:bg-gray-400 flex items-center gap-2",children:[M?e.jsx(q,{className:"animate-spin"}):e.jsx(ue,{}),e.jsx("span",{children:"توليد"})]})]})]})}):null},fs=()=>{const{fullDocuments:f,loadingFullDocuments:z,codes:R,staticDocuments:F,sites:H,siteSettings:D,pages:E,blogPosts:M,ads:J}=pt(),[O,$]=d.useState([]);Yt();const{refetchAdminData:te}=pt();Bt();const[j,se]=d.useState(()=>localStorage.getItem("admin_documents_country_filter")||"all"),[P,V]=d.useState(!1),[T,L]=d.useState({isOpen:!1,mode:"create",doc:null}),[N,le]=d.useState({}),[Y,G]=d.useState(!1),[ne,Ae]=d.useState(""),[de,xe]=d.useState({preview:"",final:""}),[k,be]=d.useState({isOpen:!1,doc:null}),[ce,B]=d.useState(""),[W,ae]=d.useState(""),[ye,n]=d.useState(""),i=d.useRef(null),[m,y]=d.useState({isOpen:!1,fieldId:""}),[re,_]=d.useState(!1),[qe,Qe]=d.useState(!1),[ft,Ce]=d.useState(!1),[pe,bt]=d.useState("new"),[je,Ye]=d.useState("dz"),[Te,Be]=d.useState(""),[We,Ke]=d.useState(!1),[$e,Xe]=d.useState({preview:"upload",final:"upload"}),[Le,Ze]=d.useState({preview:"",final:""}),[et,tt]=d.useState(!1),[Se,st]=d.useState(null),[yt,Ue]=d.useState(!1),[ze,Re]=d.useState(""),[ie,ve]=d.useState(null),[lt,nt]=d.useState(!1),[Je,Ie]=d.useState("skip"),[me,Oe]=d.useState(new Set),jt=d.useMemo(()=>{const t=Object.entries(os).map(([u,g])=>({id:`const-${u}`,key:`[${u}]`,description:g})),s=R.map(u=>({...u,key:u.key})),a=new Set(t.map(u=>u.key)),l=s.filter(u=>!a.has(u.key));return[...t,...l].sort((u,g)=>u.key.localeCompare(g.key))},[R]),vt=t=>{const s=t.target.value;se(s),localStorage.setItem("admin_documents_country_filter",s)};d.useEffect(()=>{const s=[...f].sort((a,l)=>a.name.localeCompare(l.name)).filter(a=>{const l=a.description?a.description.replace(/<[^>]*>?/gm,""):"",u=l.split(/\s+/).filter(x=>x!=="").length,g=!l||u<100,r=a.name.toLowerCase().includes(ne.toLowerCase())||a.description.toLowerCase().includes(ne.toLowerCase())||a.id.toLowerCase().includes(ne.toLowerCase()),c=j==="all"||(j==="global"?!a.countryCode||a.countryCode==="global":a.countryCode===j);return r&&c&&(!P||g)});$(s)},[f,ne,j,P]);const Ne=async()=>{await te()},Nt=async t=>{if(window.confirm("هل أنت متأكد من أنك تريد حذف هذا المستند؟ لا يمكن التراجع عن هذا الإجراء."))try{await ee.delete(t),await Ne(),alert("تم حذف المستند بنجاح.")}catch(s){console.error("Failed to delete document:",s),alert("فشل حذف المستند.")}},wt=()=>{le({id:"",name:"",groupId:"",description:"",countryCode:j!=="all"&&j!=="global"?j:"dz",requiredFields:[],complexFields:[],previewTemplateUrl:"",finalTemplateUrl:"",previewTemplateHtml:"",finalTemplateHtml:"",tags:"",slug:""}),Xe({preview:"upload",final:"upload"}),Ze({preview:"",final:""}),xe({preview:"",final:""}),L({isOpen:!0,mode:"create",doc:null})},Ct=async t=>{le({...t});const s={preview:"upload",final:"upload"},a={preview:t.previewTemplateHtml||"",final:t.finalTemplateHtml||""};t.previewTemplateHtml&&(s.preview="code"),t.finalTemplateHtml&&(s.final="code"),Ze(a),Xe(s),xe({preview:"",final:""}),L({isOpen:!0,mode:"edit",doc:t})},at=()=>{L({isOpen:!1,mode:"create",doc:null})},he=t=>{const{name:s,value:a}=t.target;le(l=>({...l,[s]:a}))},rt=async(t,s)=>{var c,b;const a=gt(s),l=((c=xt.find(x=>x.code===a))==null?void 0:c.name)||"Arabic",u=((b=Pe.en.find(x=>x.code===s))==null?void 0:b.name)||s,g=`
        Act as a professional technical writer and SEO specialist.
        Write a comprehensive and high-quality description for a document named "${t}".
        
        Context:
        - This document is used in: ${u}.
        - The audience is general citizens or employees.
        
        IMPORTANT RULES:
        1. Language: The content MUST be written in ${l} language.
        2. Length: The description MUST be comprehensive, high-quality, and contain MORE THAN 400 words. Be detailed, explain the purpose, the legal context (if any), and the benefits of using this template.
        3. Structure: 
            - Start IMMEDIATELY with a paragraph (<p>) defining the document. **Do NOT start with a Heading (<h1>, <h2>, etc.).**
            - Use <h3> tags for subsequent sections.
            - Use <ul> or <ol> lists where appropriate.
        4. Format: Return HTML content only.
        `;return(await Me({model:"gemini-2.5-flash",contents:g})).text||""},Tt=async()=>{var t;if(!((t=N.name)!=null&&t.trim())){alert("يرجى إدخال اسم المستند أولاً.");return}tt(!0);try{const s=await rt(N.name,N.countryCode||"dz");le(a=>({...a,description:s}))}catch(s){console.error("AI Error:",s),alert("فشل توليد الوصف. يرجى المحاولة مرة أخرى.")}finally{tt(!1)}},it=async t=>{st(t.id);try{const s=await rt(t.name,t.countryCode||"dz");await ee.update(t.id,{description:s});const a={...t,description:s},l={...a,serviceType:"doc"},u=[...f.map(p=>p.id===t.id?a:p).map(p=>({...p,serviceType:"doc"})),...F.map(p=>({...p,serviceType:"static-doc"})),...H.map(p=>({...p,serviceType:"site"}))],g=D||Fe,r=J||[],c=t.countryCode||"global",b=c==="global",x=He(l,u,g,E,M,r,c),U=b?`dist/doc/${t.slug||t.id}/index.html`:`dist/${c}/doc/${t.slug||t.id}/index.html`,o=u.filter(p=>p.slug&&(b?!p.countryCode||p.countryCode==="global":p.countryCode===c)),h=De(o,c,g,E,M,r),S=b?"dist/services/index.html":`dist/${c}/services/index.html`;await fe({files:[{path:U,content:A(x)},{path:S,content:A(h)}],commitMessage:`fix: Update static page for ${t.name} with AI description`}),$(p=>p.map(w=>w.id===t.id?{...w,description:s}:w)),Ne(),alert("تم توليد الوصف وتحديث صفحة المستند بنجاح!")}catch(s){console.error("Quick AI Error:",s),alert("فشل توليد الوصف التلقائي أو عملية النشر.")}finally{st(null)}},ot=t=>{const{finalTemplateHtml:s,...a}=t;ae(s||""),B(JSON.stringify(a,null,2)),n(""),be({isOpen:!0,doc:t})},dt=()=>{be({isOpen:!1,doc:null}),B(""),ae(""),n(""),y({isOpen:!1,fieldId:""})},St=async()=>{if(k.doc){Qe(!0),n("");try{const t=JSON.parse(ce),s=t.name||k.doc.name,a=t.countryCode||k.doc.countryCode||"dz",l=k.doc.id,u=`
Create a single JSON object representing a professional document template for the context: "${s}".
Target Country: "${a}".
Language: The content must be in the official language of ${a}.

**STRICT OUTPUT FORMAT RULES:**
1. THE OUTPUT MUST BE A SINGLE JSON OBJECT.
2. Structure must match this TypeScript interface:
interface Document {
  id: string; // MUST BE "${l}"
  groupId: string; // Same as id
  name: string; // In target language
  description: string; // HTML format (<p>...</p>), detailed, in target language.
  countryCode: string; // "${a}"
  requiredFields: string[]; // Array of field keys (e.g., "fullName", "address", "gender", "DateToday", "citizen_title")
  fieldCustomizations: {
    [key: string]: {
      type: "text" | "date" | "number" | "textarea" | "select";
      customQuestion: string; 
      placeholder?: string;
      options?: Array<{ label: string, value: string, mappedValues?: Record<string, string> }>;
    }
  };
  finalTemplateHtml: string; // FULL STANDALONE HTML DOCUMENT
  previewTemplateHtml: string; // SIMPLIFIED PREVIEW
}

3. **HTML TEMPLATE REQUIREMENTS (CRITICAL):**
   - The "finalTemplateHtml" MUST be a full standalone document starting with <!DOCTYPE html>.
   - Use the following CSS structure for layout:
     <style>
       @page { size: A4; margin: 0; }
       body { margin: 0; padding: 0; font-family: 'Scheherazade New', serif; }
       .page { width: 210mm; height: 297mm; padding: 25mm; margin: 0 auto; display: flex; flex-direction: column; box-sizing: border-box; background: white; overflow: hidden; }
       .header { display: flex; justify-content: space-between; margin-bottom: 20px; font-size: 14pt; }
       .title { text-align: center; font-size: 24pt; font-weight: 700; text-decoration: underline; margin: 30px 0 50px 0; }
       .content { flex-grow: 1; font-size: 18pt; line-height: 2.0; text-align: justify; }
       .footer { margin-top: 40px; display: flex; justify-content: flex-end; font-size: 16pt; }
       .signature-box { min-width: 250px; text-align: center; }
     </style>
   - Include the Google Fonts link in <head>: <link href="https://fonts.googleapis.com/css2?family=Scheherazade+New:wght@400;700&display=swap" rel="stylesheet">
   - **PLACEHOLDERS:** Use bracket syntax e.g., [fullName], [address]. NEVER use double braces {{...}}.
   - Always include "[DateToday]" for the date.

4. **GENDER MAPPING (MANDATORY):**
   - Include a "gender" field in requiredFields and fieldCustomizations.
   - For "gender", provide options "male" and "female" with "mappedValues" for titles that change with gender:
     - citizen_title: (السيد / السيدة)
     - born_title: (المولود / المولودة)
     - resident_title: (الساكن / الساكنة)
     - signer_title: (أصرح بشرفي / أصرح بشرفي)
     - declarant_title: (المصرح / المصرحة)
     - holder_title: (حامل / حاملة)
   - USE these mapped placeholders (e.g., [citizen_title]) in the HTML content to ensure professional grammar.

5. **CONTENT LIMIT:** The document body content must be concise and strictly NOT exceed 20 lines to fit on one A4 page.
`;let r=(await Me({model:"gemini-3-flash-preview",contents:u})).text||"";r=r.replace(/```json/g,"").replace(/```/g,"").trim();const c=JSON.parse(r);c.id=l,c.finalTemplateHtml&&(c.finalTemplateHtml=Q(c.finalTemplateHtml));const{finalTemplateHtml:b,...x}=c;ae(b||""),B(JSON.stringify(x,null,2)),alert("تمت إعادة توليد المحتوى بنجاح. يمكنك المعاينة ثم الحفظ.")}catch(t){console.error("AI Regeneration Error in Split View:",t),n(t.message||"Failed to regenerate with AI"),alert(`فشل إعادة التوليد: ${t.message}`)}finally{Qe(!1)}}},It=async()=>{var t;Ke(!0),n("");try{const s=ce,a=W,l=JSON.parse(s);let u=Te,g=je,r=`draft-${ge(Te)}`;if(pe!=="new"){const I=f.find(K=>K.id===pe);I&&(u=I.name,g=I.countryCode||"global",r=I.id)}const c=gt(g),b=((t=xt.find(I=>I.code===c))==null?void 0:t.name)||"Arabic",x=`
Act as a document expert. I will provide you with a JSON metadata and an HTML template of an existing document. 
Your task is to TRANSFORM this document into a NEW one for the following target:
Target Name: "${u}"
Target Country: "${g}" (Language: ${b})

Existing Style/Structure: ${a}

Rules for transformation:
1. You must return a SINGLE JSON object.
2. The output JSON must have these keys:
   - "name": "${u}"
   - "description": A detailed HTML description (> 400 words) in ${b}.
   - "countryCode": "${g}"
   - "requiredFields": Updated array of strings (e.g., ["fullName", "DateToday", ...]).
   - "fieldCustomizations": Updated dictionary for the fields in ${b}.
   - "finalTemplateHtml": THE ENTIRE TRANSFORMED HTML CONTENT (Full document including <style> and <body>).
3. HTML Content Update:
   - Rewrite the content inside <div class="page"> to match a document for "${u}".
   - KEEP the existing CSS styles and layout structure exactly as provided.
   - Use placeholders from your updated "requiredFields".
4. Return ONLY the JSON object.
`;let o=(await Me({model:"gemini-3-flash-preview",contents:x})).text||"";o=o.replace(/```json/g,"").replace(/```/g,"").trim();const h=JSON.parse(o),S=h.finalTemplateHtml||"",p={...h};delete p.finalTemplateHtml,p.id=r,p.slug=ge(u);const w=Q(S);ae(w),B(JSON.stringify(p,null,2)),Ce(!1),Be(""),alert(pe==="new"?"تم إنشاء مسودة المستند الجديد بنجاح.":"تم تحديث بيانات المستند المختار بنجاح. يرجى المراجعة ثم الحفظ.")}catch(s){console.error("AI Transformation Error:",s),alert(`فشل العملية: ${s.message}`)}finally{Ke(!1)}},ct=t=>{if(!k.doc||O.length===0)return;const s=O.findIndex(u=>{var g;return u.id===((g=k.doc)==null?void 0:g.id)});if(s===-1)return;let a;t==="next"?a=(s+1)%O.length:a=(s-1+O.length)%O.length;const l=O[a];ot(l)},Ot=()=>{let t=N.finalTemplateHtml;if(!t&&$e.final==="code"&&(t=Le.final),t||(t=de.final),!t){alert("لا يوجد محتوى HTML للمعاينة. يرجى إدخال الكود أو رفع ملف.");return}const s=window.open("","_blank");s&&(s.document.write(t),s.document.close())},kt=async()=>{if(k.doc){G(!0),n("");try{let t;try{t=JSON.parse(ce)}catch{throw new Error("Invalid JSON format in the left panel.")}const{serviceType:s,...a}=t,l={...a,finalTemplateHtml:W};if(l.groupId||(l.groupId=l.id),l.finalTemplateHtml){const v=_e(l.finalTemplateHtml);l.requiredFields=v,l.finalTemplateHtml=Q(l.finalTemplateHtml)}let u=l.id;const g=l.id.startsWith("draft-")||l.id!==k.doc.id;if(l.id.startsWith("draft-")){const v=l.slug||ge(l.name);u=v;const Qt={...l,id:v,groupId:v};await ee.create(Qt),l.id=v}else if(l.id!==k.doc.id){if(!window.confirm("You changed the Document ID in the JSON. This will create a NEW document instead of updating. Continue?")){G(!1);return}l.groupId===k.doc.groupId&&(l.groupId=l.id),await ee.create(l)}else await ee.update(k.doc.id,l);const r={...l},c=r.countryCode||"global",b=c==="global",x=r.slug||r.id,U=D||Fe,o=J||[],h=[...f.map(v=>v.id===(g?"":r.id)?r:v).map(v=>({...v,serviceType:"doc"})),...F.map(v=>({...v,serviceType:"static-doc"})),...H.map(v=>({...v,serviceType:"site"}))];g&&h.push({...r,serviceType:"doc"});const S=[],p=[],w=`${x}.json`,I=b?`data/json/documents/${w}`:`data/json/documents/${c}/${w}`,K=(r.finalTemplateHtml||"").replace(/\[.*?\]/g,"........"),X={...r,previewTemplateHtml:A(K),finalTemplateHtml:A(r.finalTemplateHtml||"")};S.push({path:I,content:JSON.stringify(X,null,2)});const oe=He(X,h,U,E,M,o,c),Z=b?`dist/doc/${x}/index.html`:`dist/${c}/doc/${x}/index.html`;p.push({path:Z,content:A(oe)});const C=ht(X,h,U,E,M,o,c),Gt=b?`dist/doc/${x}/amp/index.html`:`dist/${c}/doc/${x}/amp/index.html`;p.push({path:Gt,content:A(C)});const _t=h.filter(v=>v.slug&&(b?!v.countryCode||v.countryCode==="global":v.countryCode===c)),Vt=De(_t,c,U,E,M,o),qt=b?"dist/services/index.html":`dist/${c}/services/index.html`;p.push({path:qt,content:A(Vt)}),await fe({files:S,commitMessage:`feat: Update JSON for ${r.name}`,repoConfig:{owner:"gitut-cms",repo:"files"}}),await fe({files:p,commitMessage:`feat: Regenerate static pages for ${r.name} (HTML + AMP)`}),await Ne(),alert("تم الحفظ ونشر الملفات بنجاح!"),dt()}catch(t){console.error("Failed to save customizations:",t),n(t.message||"Failed to save."),alert(`فشل الحفظ: ${t.message}`)}finally{G(!1)}}},Ft=t=>{const s=t.target.value;if(!s)return;const a=s.replace(/^\[|\]$/g,"");let l;i.current&&(l={start:i.current.selectionStart,end:i.current.selectionEnd}),y({isOpen:!0,fieldId:a,insertPoints:l}),t.target.value=""},Ht=t=>{try{const s=JSON.parse(ce);if(s.fieldCustomizations=s.fieldCustomizations||{},s.fieldCustomizations[m.fieldId]=t,s.requiredFields=s.requiredFields||[],s.requiredFields.includes(m.fieldId)||s.requiredFields.push(m.fieldId),B(JSON.stringify(s,null,2)),m.insertPoints&&i.current){const a=`[${m.fieldId}]`,{start:l,end:u}=m.insertPoints,g=W.substring(0,l)+a+W.substring(u);ae(g),setTimeout(()=>{const r=i.current;r&&(r.focus(),r.setSelectionRange(l+a.length,l+a.length))},0)}}catch(s){console.error("Error updating JSON from field config:",s),alert("خطأ في تحديث JSON. يرجى التأكد من صحة تنسيق JSON في اللوحة اليسرى.")}y({isOpen:!1,fieldId:""})},Dt=()=>{if(!W)return;const t=W.replace(/\[.*?\]/g,".........."),s=window.open("","_blank");s&&(s.document.write(t),s.document.close())},Et=()=>{Re(JSON.stringify([{id:"optional-id",name:"اسم المستند",groupId:"group-id",description:"<p>وصف المستند</p>",countryCode:"dz",requiredFields:["fieldName1","fieldName2"],fieldCustomizations:{fieldName1:{type:"text",customQuestion:"Question?"},fieldName2:{type:"select",options:["A","B"]}},finalTemplateHtml:"<!-- HTML content with [fieldName1] -->"}],null,2)),n(""),ve(null),Ie("skip"),Ue(!0)},ke=()=>{Ue(!1),ve(null)},Mt=t=>{if(!t)return;const s=window.open("","_blank");s&&(s.document.write(t),s.document.close())},At=()=>{n(""),nt(!0);try{const t=JSON.parse(ze),a=(Array.isArray(t)?t:[t]).map((l,u)=>{if(!l.name)return{status:"Error",id:`unknown-${u}`,name:"Unknown",slug:"",country:"",files:[],data:l,error:"Missing name"};let g=l.slug||ge(l.name),r=l.id||l.groupId||g;const c=l.countryCode||"global",b=f.find(h=>h.id===r||h.slug===g);let x="New";b&&(Je==="overwrite"?(x="Update",r=b.id,g=b.slug||g):x="Skip");const U=`data/json/documents/${c!=="global"?c+"/":""}${g}.json`,o=`dist/${c!=="global"?c+"/":""}doc/${g}/index.html`;return l.finalTemplateHtml&&(l.finalTemplateHtml=Q(l.finalTemplateHtml)),l.previewTemplateHtml&&(l.previewTemplateHtml=Q(l.previewTemplateHtml)),{status:x,id:r,name:l.name,slug:g,country:c,files:[U,o],data:{...l,id:r,slug:g,countryCode:c}}});ve(a)}catch(t){n(t.message||"Invalid JSON")}finally{nt(!1)}},$t=async()=>{var a;if(!ie)return;const t=ie.filter(l=>l.status==="Update"&&l.data.description);let s=!1;t.length>0&&(s=window.confirm(`لقد تم العثور على ${t.length} مستند موجود مسبقاً يحتوي على وصف جديد في ملف JSON. هل تريد تحديث الأوصاف لهذه المستندات؟`)),G(!0);try{const l=[];let u=0;for(const o of ie){if(o.status==="Error")continue;if(o.status==="Skip"){u++;continue}let h={...o.data};if(o.status==="Update"){const w=f.find(I=>I.id===h.id);w&&(!s||!h.description)&&(h.description=w.description)}h.finalTemplateHtml&&(h.requiredFields=_e(h.finalTemplateHtml),h.finalTemplateHtml=A(h.finalTemplateHtml)),h.previewTemplateHtml&&(h.previewTemplateHtml=A(h.previewTemplateHtml));const{serviceType:S,...p}=h;o.status==="New"?await ee.create(p):o.status==="Update"&&await ee.update(p.id,p),l.push({...h,serviceType:"doc"})}if(l.length===0){alert(`تم الانتهاء. تم تخطي ${u} مستند.`),G(!1),ke();return}const g=[],r=[],c=D||Fe,b=J||[],x=[...f.map(o=>({...o,serviceType:"doc"})),...F.map(o=>({...o,serviceType:"static-doc"})),...H.map(o=>({...o,serviceType:"site"}))];l.forEach(o=>{const h=x.findIndex(S=>S.id===o.id);h>-1?x[h]=o:x.push(o)});const U=new Set;for(const o of ie){if(o.status==="Error"||o.status==="Skip")continue;U.add(o.country);const h=o.files[0],S=JSON.stringify({...o.data,description:((a=l.find(Z=>Z.id===o.id))==null?void 0:a.description)||o.data.description,previewTemplateHtml:(o.data.finalTemplateHtml||"").replace(/\[.*?\]/g,"........")},null,2);g.push({path:h,content:S});const w={...l.find(Z=>Z.id===o.id)||o.data,serviceType:"doc"},I=He(w,x,c,E,M,b,o.country),K=o.files[1];r.push({path:K,content:A(I)});const X=ht(w,x,c,E,M,b,o.country),oe=o.files[1].replace("/index.html","/amp/index.html");r.push({path:oe,content:A(X)})}for(const o of U){const h=o==="global",S=x.filter(p=>p.slug&&(h?!p.countryCode||p.countryCode==="global":p.countryCode===o));if(S.length>0){const p=De(S,o,c,E,M,b),w=h?"dist/services/index.html":`dist/${o}/services/index.html`;r.push({path:w,content:A(p)});const I=new Set;I.add(`https://gitut.com/${h?"":o+"/"}services/`),S.forEach(oe=>{const Z=oe.serviceType==="site"?"site":"doc",C=`https://gitut.com/${h?"":o+"/"}${Z}/${oe.slug}/`;I.add(C)});const K=ds(I),X=h?"dist/sitemap/services.xml":`dist/sitemap/${o}/services.xml`;r.push({path:X,content:K})}}g.length>0&&await fe({files:g,commitMessage:"feat: Batch update docs",repoConfig:{owner:"gitut-cms",repo:"files"}}),r.length>0&&await fe({files:r,commitMessage:"feat: Publish static pages"}),await Ne(),alert(`تم بنجاح! تم معالجة ${l.length} مستند.`),ke()}catch(l){console.error("Bulk Import Failed:",l),n(`فشل التنفيذ: ${l.message}`)}finally{G(!1)}},Lt=t=>{t.target.checked?Oe(new Set(O.map(s=>s.id))):Oe(new Set)},Ut=t=>{const s=new Set(me);s.has(t)?s.delete(t):s.add(t),Oe(s)},zt=()=>{const t=O.filter(a=>me.has(a.id)),s=t.map(a=>({id:a.id,name:a.name,description:a.description,countryCode:a.countryCode}));navigator.clipboard.writeText(JSON.stringify(s,null,2)),alert(`تم نسخ JSON لـ ${t.length} مستند.`)},Rt=async t=>{var s,a,l;t.preventDefault(),G(!0);try{const u={...N},{serviceType:g,...r}=u;let c="";$e.preview==="code"?c=Le.preview:de.preview&&(c=de.preview),c&&(r.previewTemplateHtml=Q(A(c)),r.previewTemplateUrl="");let b="";$e.final==="code"?b=Le.final:de.final&&(b=de.final),b&&(r.finalTemplateHtml=Q(A(b)),r.finalTemplateUrl=""),r.finalTemplateHtml&&(r.requiredFields=_e(r.finalTemplateHtml)),r.slug=(s=N.slug)!=null&&s.trim()?ge(N.slug):ge(N.name||"");let x;if(T.mode==="create"){const C=((a=N.id)==null?void 0:a.trim())||((l=N.groupId)==null?void 0:l.trim())||r.slug;r.id=C,r.groupId||(r.groupId=C),x=await ee.create(r)}else if(T.doc)await ee.update(T.doc.id,r),x={...T.doc,...r};else throw new Error("Invalid modal state");const U={...x,serviceType:"doc"},o=[...f.map(C=>C.id===x.id?x:C).map(C=>({...C,serviceType:"doc"})),...F.map(C=>({...C,serviceType:"static-doc"})),...H.map(C=>({...C,serviceType:"site"}))],h=D||Fe,S=J||[],p=x.countryCode||"global",w=p==="global",I=He(U,o,h,E,M,S,p),K=w?`dist/doc/${x.slug||x.id}/index.html`:`dist/${p}/doc/${x.slug||x.id}/index.html`,X=o.filter(C=>C.slug&&(w?!C.countryCode||C.countryCode==="global":C.countryCode===p)),oe=De(X,p,h,E,M,S),Z=w?"dist/services/index.html":`dist/${p}/services/index.html`;await fe({files:[{path:K,content:A(I)},{path:Z,content:A(oe)}],commitMessage:`fix: Update static page for ${x.name} via Manual Edit`}),await Ne(),alert("تم حفظ المستند ونشر الصفحة بنجاح!"),at()}catch(u){console.error("Failed to save document:",u),alert("فشل حفظ المستند.")}finally{G(!1)}},Jt=t=>{t.finalTemplateHtml&&(t.finalTemplateHtml=Q(t.finalTemplateHtml)),t.previewTemplateHtml&&(t.previewTemplateHtml=Q(t.previewTemplateHtml)),Re(JSON.stringify(t,null,2)),Ue(!0),Ie("skip"),ve(null)},Pt=d.useMemo(()=>f.filter(t=>je==="global"?!t.countryCode||t.countryCode==="global":t.countryCode===je).sort((t,s)=>t.name.localeCompare(s.name)),[f,je]);return z?e.jsx("div",{className:"flex justify-center items-center p-10",children:e.jsx(q,{className:"animate-spin text-4xl text-green-600"})}):e.jsxs("div",{children:[re&&e.jsx(ps,{isOpen:re,onClose:()=>_(!1),onGenerate:Jt}),e.jsxs("div",{className:"flex flex-col gap-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"إدارة المستندات"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>_(!0),className:"bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700 shadow-sm transition-colors flex items-center",children:[e.jsx(ue,{className:"inline-block ml-2 rtl:ml-0 rtl:mr-2"}),"توليد مستند بالذكاء الاصطناعي"]}),e.jsxs("button",{onClick:Et,className:"bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 shadow-sm transition-colors flex items-center",children:[e.jsx(mt,{className:"inline-block ml-2 rtl:ml-0 rtl:mr-2"}),"إضافة/تحديث (JSON)"]}),e.jsxs("button",{onClick:wt,className:"bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 shadow-sm transition-colors flex items-center",children:[e.jsx(we,{className:"inline-block ml-2 rtl:ml-0 rtl:mr-2"}),"إضافة مستند يدويًا"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center bg-gray-50 p-4 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(Wt,{className:"text-gray-500"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700 whitespace-nowrap",children:"تصفية حسب البلد:"}),e.jsxs("select",{value:j,onChange:vt,className:"bg-white border border-gray-300 rounded-md py-2 px-3 text-sm focus:ring-green-500 focus:border-green-500 w-full sm:w-48",children:[e.jsx("option",{value:"all",children:"كل الدول (All)"}),e.jsx("option",{value:"global",children:"عالمي (Global)"}),Pe.en.map(t=>e.jsxs("option",{value:t.code,children:[t.name," (",t.code.toUpperCase(),")"]},t.code))]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto bg-white px-3 py-2 rounded-md border",children:[e.jsx("input",{type:"checkbox",id:"short-desc-filter",checked:P,onChange:t=>V(t.target.checked),className:"h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500"}),e.jsx("label",{htmlFor:"short-desc-filter",className:"text-sm font-semibold text-gray-700 cursor-pointer select-none",children:"المستندات التي تحتوي وصف قصير فقط"})]}),e.jsx("div",{className:"w-full relative",children:e.jsx("input",{type:"text",placeholder:"ابحث بالاسم، المعرف، أو الوصف...",value:ne,onChange:t=>Ae(t.target.value),className:"w-full p-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"})})]})]}),me.size>0&&e.jsxs("div",{className:"sticky top-0 z-10 bg-blue-50 border border-blue-200 p-3 mb-4 rounded-lg flex justify-between items-center shadow-sm animate-fadeIn",children:[e.jsxs("span",{className:"font-bold text-blue-800",children:["تم تحديد ",me.size," مستند"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:zt,className:"flex items-center gap-2 bg-white border border-blue-300 text-blue-700 px-3 py-1 rounded hover:bg-blue-100",children:[e.jsx(Kt,{})," نسخ JSON"]}),e.jsx("button",{onClick:()=>Oe(new Set),className:"text-gray-500 hover:text-gray-700 px-2",children:"إلغاء التحديد"})]})]}),e.jsx("div",{className:"bg-white p-2 rounded-lg border shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-right",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 w-10",children:e.jsx("input",{type:"checkbox",onChange:Lt,checked:O.length>0&&me.size===O.length,className:"w-4 h-4 rounded text-green-600 focus:ring-green-500"})}),e.jsx("th",{className:"p-3 font-semibold text-sm text-gray-600",children:"اسم المستند"}),e.jsx("th",{className:"p-3 font-semibold text-sm text-gray-600",children:"البلد"}),e.jsx("th",{className:"p-3 font-semibold text-sm text-gray-600",children:"ID / Group ID"}),e.jsx("th",{className:"p-3 font-semibold text-sm text-gray-600",children:"الوصف"}),e.jsx("th",{className:"p-3 font-semibold text-sm text-gray-600",children:"إجراءات"})]})}),e.jsx("tbody",{children:O.map(t=>{const s=t.description?t.description.replace(/<[^>]*>?/gm,""):"",a=s.split(/\s+/).filter(g=>g!=="").length,l=!s||s.trim().length===0,u=a<100;return e.jsxs("tr",{className:`border-b hover:bg-gray-50 ${me.has(t.id)?"bg-blue-50":""}`,children:[e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"checkbox",checked:me.has(t.id),onChange:()=>Ut(t.id),className:"w-4 h-4 rounded text-green-600 focus:ring-green-500"})}),e.jsx("td",{className:"p-3 text-gray-800 font-semibold",children:t.name}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${t.countryCode==="dz"?"bg-green-100 text-green-800":t.countryCode==="global"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:t.countryCode?t.countryCode.toUpperCase():"ALL"})}),e.jsxs("td",{className:"p-3 text-gray-500 font-mono text-xs",children:[t.id,e.jsx("br",{}),t.groupId!==t.id&&`(${t.groupId})`]}),e.jsx("td",{className:"p-3 text-gray-600 text-sm",children:e.jsx("div",{className:"flex flex-col gap-2",children:l?e.jsxs("button",{onClick:()=>it(t),disabled:Se===t.id,className:"text-purple-600 hover:text-purple-800 flex self-start items-center gap-1 bg-purple-50 px-2 py-1 rounded-md text-xs font-bold border border-purple-200",title:"توليد وصف تلقائي بالذكاء الاصطناعي",children:[Se===t.id?e.jsx(q,{className:"animate-spin"}):e.jsx(ue,{}),e.jsx("span",{children:"توليد وصف"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"prose prose-sm max-w-none line-clamp-2",dangerouslySetInnerHTML:{__html:t.description}}),e.jsxs("button",{onClick:()=>it(t),disabled:Se===t.id,className:"text-purple-600 hover:text-purple-800 flex self-start items-center gap-1 bg-white px-2 py-1 rounded-md text-[10px] font-bold border border-purple-100 hover:bg-purple-50 transition-colors",title:"إعادة توليد الوصف بالذكاء الاصطناعي (أكثر من 400 كلمة)",children:[Se===t.id?e.jsx(q,{className:"animate-spin"}):e.jsx(ue,{}),e.jsx("span",{children:u?"توليد وصف طويل":"إعادة توليد وصف"})]})]})})}),e.jsxs("td",{className:"p-3 space-x-4 space-x-reverse whitespace-nowrap",children:[t.slug&&e.jsx("a",{href:`/${t.countryCode||"dz"}/doc/${t.slug}/`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline text-sm font-semibold",children:"معاينة"}),e.jsx("button",{onClick:()=>Ct(t),className:"text-green-600 hover:underline text-sm font-semibold",children:"تعديل"}),e.jsx("button",{onClick:()=>ot(t),className:"text-purple-600 hover:underline text-sm font-semibold",children:"تخصيص (Split)"}),e.jsx("button",{onClick:()=>Nt(t.id),className:"text-red-600 hover:underline text-sm font-semibold",children:"حذف"})]})]},t.id)})})]})})}),yt&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-5xl h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"إضافة / تحديث مستندات (مع المعاينة والنشر)"}),e.jsx("button",{onClick:ke,className:"text-gray-500 hover:text-gray-800",children:e.jsx(ut,{size:20})})]}),e.jsx("div",{className:"p-6 flex-grow overflow-y-auto",children:ie?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-bold",children:"تقرير المحاكاة (Simulation Report)"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[ie.length," عنصر"]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-right text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 border-b",children:"الحالة"}),e.jsx("th",{className:"p-3 border-b",children:"المعرف (ID)"}),e.jsx("th",{className:"p-3 border-b",children:"الاسم"}),e.jsx("th",{className:"p-3 border-b",children:"الملفات المتأثرة"}),e.jsx("th",{className:"p-3 border-b",children:"إجراءات"})]})}),e.jsx("tbody",{children:ie.map((t,s)=>e.jsxs("tr",{className:`border-b ${t.status==="New"?"bg-green-50":t.status==="Update"?"bg-yellow-50":t.status==="Skip"?"bg-gray-100 text-gray-500":t.status==="Error"?"bg-red-50":""}`,children:[e.jsxs("td",{className:"p-3 font-bold",children:[t.status==="New"&&e.jsxs("span",{className:"text-green-600 flex items-center gap-1",children:[e.jsx(Xt,{})," جديد"]}),t.status==="Update"&&e.jsxs("span",{className:"text-yellow-600 flex items-center gap-1",children:[e.jsx(Zt,{})," تحديث"]}),t.status==="Skip"&&e.jsxs("span",{className:"text-gray-500 flex items-center gap-1",children:[e.jsx(es,{})," تم التخطي"]}),t.status==="Error"&&e.jsxs("span",{className:"text-red-600 flex items-center gap-1",children:[e.jsx(ts,{})," خطأ"]})]}),e.jsx("td",{className:"p-3 font-mono",children:t.id}),e.jsx("td",{className:"p-3",children:t.name}),e.jsx("td",{className:"p-3 text-xs text-gray-600 dir-ltr text-left",children:t.status!=="Skip"&&t.files.map(a=>e.jsx("div",{children:a},a))}),e.jsx("td",{className:"p-3",children:t.data.finalTemplateHtml&&e.jsxs("button",{onClick:()=>Mt(t.data.finalTemplateHtml),className:"text-blue-600 hover:text-blue-800 flex items-center gap-1 text-xs font-bold bg-blue-50 px-2 py-1 rounded border border-blue-200",children:[e.jsx(Ge,{})," معاينة"]})})]},s))})]})})]}):e.jsxs("div",{className:"space-y-4 h-full flex flex-col",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-md text-sm text-blue-800",children:[e.jsx("p",{className:"font-bold",children:"تعليمات:"}),e.jsxs("ul",{className:"list-disc list-inside",children:[e.jsx("li",{children:"ألصق كود JSON لمصفوفة المستندات."}),e.jsx("li",{children:"بعد التأكيد، سيتم حفظ البيانات ورفع الملفات إلى GitHub تلقائياً."})]})]}),e.jsxs("div",{className:"bg-gray-100 p-3 rounded-md border flex gap-4 items-center mb-2",children:[e.jsx("span",{className:"font-bold text-gray-700 text-sm",children:"في حال وجود مستند بنفس ID أو Slug:"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"conflict",value:"skip",checked:Je==="skip",onChange:()=>Ie("skip")}),e.jsx("span",{children:"تجاهل (Skip)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"conflict",value:"overwrite",checked:Je==="overwrite",onChange:()=>Ie("overwrite")}),e.jsx("span",{children:"تحديث (Overwrite)"})]})]}),e.jsx("textarea",{value:ze,onChange:t=>Re(t.target.value),className:"flex-grow p-4 font-mono text-sm bg-gray-900 text-green-300 rounded-md",placeholder:'[ { \\"id\\": \\"doc-id\\", \\"name\\": \\"Name\\", \\"description\\": \\"...\\" } ]',dir:"ltr"}),ye&&e.jsx("p",{className:"text-red-600 font-bold",children:ye})]})}),e.jsx("div",{className:"p-6 border-t bg-gray-50 flex justify-end gap-3",children:ie?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>ve(null),className:"bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg",children:"عودة للتعديل"}),e.jsxs("button",{onClick:$t,disabled:Y,className:"bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 disabled:bg-gray-400 flex items-center gap-2",children:[Y?e.jsx(q,{className:"animate-spin"}):e.jsx(mt,{}),e.jsx("span",{children:"تأكيد وتنفيذ النشر"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:ke,className:"bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-300",children:"إلغاء"}),e.jsxs("button",{onClick:At,disabled:lt||!ze.trim(),className:"bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 flex items-center gap-2",children:[lt?e.jsx(q,{className:"animate-spin"}):e.jsx(ss,{}),e.jsx("span",{children:"تحليل ومعاينة"})]})]})})]})}),T.isOpen&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-start p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl",children:e.jsxs("form",{onSubmit:Rt,children:[e.jsx("div",{className:"p-6 border-b",children:e.jsx("h2",{className:"text-2xl font-bold",children:T.mode==="create"?"إضافة مستند جديد":"تعديل المستند"})}),e.jsxs("div",{className:"p-6 space-y-4 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"اسم المستند"}),e.jsx("input",{type:"text",name:"name",id:"name",value:N.name||"",onChange:he,required:!0,className:"w-full p-2 border rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"groupId",className:"block text-sm font-medium text-gray-700 mb-1",children:"معرف المجموعة (Group ID)"}),e.jsx("input",{type:"text",name:"groupId",id:"groupId",value:N.groupId||"",onChange:he,required:!0,className:"w-full p-2 border rounded-md"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"id",className:"block text-sm font-medium text-gray-700 mb-1",children:"المعرف الفريد (ID)"}),e.jsx("input",{type:"text",name:"id",id:"id",value:N.id||"",onChange:he,disabled:T.mode==="edit",className:"w-full p-2 border rounded-md bg-gray-100 disabled:cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"slug",className:"block text-sm font-medium text-gray-700 mb-1",children:"الرابط الدائم (Slug)"}),e.jsx("input",{type:"text",name:"slug",id:"slug",value:N.slug||"",onChange:he,className:"w-full p-2 border rounded-md"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"الوصف"}),e.jsxs("button",{type:"button",onClick:Tt,disabled:et,className:"flex items-center gap-1 text-xs bg-purple-100 text-purple-700 font-semibold py-1 px-2 rounded-md hover:bg-purple-200 disabled:opacity-50",children:[et?e.jsx(q,{className:"animate-spin"}):e.jsx(ue,{}),e.jsx("span",{children:"توليد وصف بالذكاء الاصطناعي"})]})]}),e.jsx(Ee,{theme:"snow",value:N.description||"",onChange:t=>le(s=>({...s,description:t}))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"countryCode",className:"block text-sm font-medium text-gray-700 mb-1",children:"رمز البلد"}),e.jsx("input",{type:"text",name:"countryCode",id:"countryCode",value:N.countryCode||"",onChange:he,className:"w-full p-2 border rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags",className:"block text-sm font-medium text-gray-700 mb-1",children:"الوسوم"}),e.jsx("input",{type:"text",name:"tags",id:"tags",value:N.tags||"",onChange:he,className:"w-full p-2 border rounded-md"})]})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsxs("button",{type:"button",onClick:Ot,className:"flex items-center gap-2 bg-orange-100 text-orange-700 font-semibold py-2 px-4 rounded-lg hover:bg-orange-200 border border-orange-300",children:[e.jsx(Ge,{})," معاينة القالب"]})})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:at,className:"bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-300",children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:Y,className:"bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 disabled:bg-gray-400",children:Y?"جاري الحفظ...":"حفظ المستند"})]})]})})}),e.jsx(cs,{isOpen:m.isOpen,fieldId:m.fieldId,onClose:()=>y({isOpen:!1,fieldId:""}),onSave:Ht}),ft&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-[110] flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md animate-fadeIn overflow-visible",children:[e.jsxs("div",{className:"p-6 border-b flex justify-between items-center",children:[e.jsx("h2",{className:"text-xl font-bold",children:"أنشئ من هذا المستند"}),e.jsx("button",{onClick:()=>Ce(!1),className:"text-gray-400 hover:text-gray-600",children:e.jsx(ut,{size:20})})]}),e.jsxs("div",{className:"p-6 space-y-5",children:[e.jsx("p",{className:"text-xs text-gray-500 leading-relaxed",children:"سيقوم النظام باستخدام تصميم المستند الحالي (الذي تراه خلف هذه النافذة) لإنشاء مستند جديد أو تحديث مستند موجود بنفس التنسيق والجمالية."}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"الهدف من العملية"}),e.jsxs("select",{value:pe,onChange:t=>bt(t.target.value),className:"w-full p-3 border-2 border-gray-100 rounded-xl focus:border-blue-500 outline-none transition-all bg-gray-50",children:[e.jsx("option",{value:"new",children:"🆕 إنشاء مستند جديد كلياً"}),e.jsx("optgroup",{label:"تحديث مستند موجود بنفس التصميم",children:Pt.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"دولة المستند"}),e.jsxs("select",{value:je,onChange:t=>Ye(t.target.value),className:"w-full p-3 border-2 border-gray-100 rounded-xl focus:border-blue-500 outline-none transition-all bg-gray-50",children:[e.jsx("option",{value:"global",children:"🌍 عالمي (Global)"}),Pe.en.map(t=>e.jsxs("option",{value:t.code,children:[t.flag," ",t.name]},t.code))]}),e.jsx("p",{className:"text-[10px] text-gray-400 mt-1",children:"تحديد الدولة يساعد الذكاء الاصطناعي في اختيار اللغة والمصطلحات الإدارية الصحيحة."})]}),pe==="new"&&e.jsxs("div",{className:"animate-fadeIn",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700 mb-1",children:"عنوان المستند الجديد"}),e.jsx("input",{type:"text",value:Te,onChange:t=>Be(t.target.value),placeholder:"مثال: طلب عطلة سنوية، سيرة ذاتية لمحاسب...",className:"w-full p-3 border-2 border-blue-100 rounded-xl focus:border-blue-500 outline-none shadow-sm"})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 flex justify-end gap-3 rounded-b-lg border-t",children:[e.jsx("button",{onClick:()=>Ce(!1),className:"px-6 py-2 rounded-lg font-bold text-gray-600 hover:bg-gray-200 transition-colors",children:"إلغاء"}),e.jsxs("button",{onClick:It,disabled:We||pe==="new"&&!Te.trim(),className:"bg-blue-600 text-white px-8 py-2 rounded-lg font-bold hover:bg-blue-700 flex items-center gap-2 disabled:bg-gray-400 shadow-lg shadow-blue-100 transition-all transform hover:-translate-y-0.5",children:[We?e.jsx(q,{className:"animate-spin"}):e.jsx(ue,{}),e.jsx("span",{children:pe==="new"?"إنشاء الآن":"تطبيق التصميم"})]})]})]})}),k.isOpen&&k.doc&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-[95%] h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b bg-gray-50 rounded-t-lg",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:["تخصيص المستند: ",k.doc.name]}),e.jsx("p",{className:"text-sm text-gray-500",children:"قم بتعديل بيانات JSON على اليسار، والقالب النهائي HTML على اليمين."})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("div",{className:"flex gap-1 mr-4",children:[e.jsx("button",{onClick:()=>ct("prev"),className:"p-2 rounded-full hover:bg-gray-200 text-gray-600 transition-colors",title:"المستند السابق",children:e.jsx(ls,{})}),e.jsx("button",{onClick:Dt,className:"text-blue-600 p-2 rounded-full hover:bg-blue-100 transition-colors",title:"معاينة في نافذة جديدة",children:e.jsx(Ge,{})}),e.jsx("button",{onClick:()=>ct("next"),className:"p-2 rounded-full hover:bg-gray-200 text-gray-600 transition-colors",title:"المستند التالي",children:e.jsx(ns,{})})]}),e.jsx("div",{className:"relative",children:e.jsxs("select",{className:"bg-white border border-gray-300 text-gray-700 py-2 px-3 rounded leading-tight focus:outline-none focus:bg-white focus:border-gray-500",onChange:Ft,defaultValue:"",children:[e.jsx("option",{value:"",disabled:!0,children:"إدراج رمز..."}),jt.map(t=>e.jsxs("option",{value:t.key,children:[t.description," (",t.key,")"]},t.id))]})}),e.jsxs("button",{onClick:St,disabled:qe,className:"flex items-center gap-2 bg-purple-100 text-purple-700 border border-purple-300 px-4 py-2 rounded hover:bg-purple-200 transition-colors",children:[qe?e.jsx(q,{className:"animate-spin"}):e.jsx(ue,{}),e.jsx("span",{children:"إعادة توليد ذكي"})]}),e.jsxs("button",{onClick:()=>{var t;Ye(((t=k.doc)==null?void 0:t.countryCode)||"dz"),Ce(!0)},className:"flex items-center gap-2 bg-blue-100 text-blue-700 border border-blue-300 px-4 py-2 rounded hover:bg-blue-200 transition-colors",children:[e.jsx(we,{}),e.jsx("span",{children:"أنشئ من هذا المستند"})]}),e.jsx("button",{onClick:dt,className:"bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300 transition-colors",children:"إلغاء"}),e.jsxs("button",{onClick:kt,disabled:Y,className:"bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 transition-colors flex items-center gap-2",children:[Y?e.jsx(q,{className:"animate-spin"}):e.jsx(as,{}),e.jsx("span",{children:"حفظ التعديلات"})]})]})]}),e.jsxs("div",{className:"flex-grow flex flex-col md:flex-row overflow-hidden",children:[e.jsxs("div",{className:"w-full md:w-1/2 flex flex-col border-b md:border-b-0 md:border-r border-gray-300",children:[e.jsxs("div",{className:"bg-gray-100 p-2 text-xs font-bold text-gray-600 uppercase tracking-wider flex justify-between",children:[e.jsx("span",{children:"JSON Configuration (Metadata & Fields)"}),e.jsx("span",{className:"text-red-500",children:ye})]}),e.jsx("textarea",{value:ce,onChange:t=>B(t.target.value),className:"flex-grow w-full p-4 font-mono text-sm bg-[#1e1e1e] text-[#d4d4d4] resize-none focus:outline-none",spellCheck:!1,dir:"ltr"})]}),e.jsxs("div",{className:"w-full md:w-1/2 flex flex-col",children:[e.jsx("div",{className:"bg-gray-100 p-2 text-xs font-bold text-gray-600 uppercase tracking-wider",children:"Final HTML Template (Right Side)"}),e.jsx("textarea",{ref:i,value:W,onChange:t=>ae(t.target.value),className:"flex-grow w-full p-4 font-mono text-sm bg-white text-gray-800 resize-none focus:outline-none border-l",spellCheck:!1,dir:"ltr",placeholder:"ضع المؤشر هنا ثم اختر رمزاً من القائمة لإدراجه..."})]})]})]})})]})};export{fs as default};
