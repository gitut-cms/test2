import{u as L,r as p,j as o,B as z,F as _,bs as Z,g as J,C as N,bH as q,bo as T,bp as K,bm as B}from"./index-hpjxKmld.js";import{a as R,h as I,b as F,c as E}from"./staticHtmlGenerator-D8IoKVrH.js";import{F as Q}from"./FileSaver.min-Bnm0McdU.js";const Y=()=>{const{blogPosts:c,siteSettings:w,pages:f,ads:P}=L(),[j,H]=p.useState(!1),[$,u]=p.useState(""),[y,D]=p.useState(!1),[k,A]=p.useState(!1),v=p.useRef(null);p.useEffect(()=>{const e=a=>{v.current&&!v.current.contains(a.target)&&A(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const M=async()=>{var e,a;try{const[r,n]=await Promise.all([fetch("https://datas.gitut.com/data/json/site-settings-public.json?t="+Date.now()),fetch("https://datas.gitut.com/data/json/site-seo.json?t="+Date.now())]);if(!r.ok)throw new Error("Failed to fetch public settings");const g=await r.json(),l=n.ok?await n.json():{},d={...B,...w,...g,seo:{...B.seo,...l},ads:{...B.ads,...g.ads||{},items:((e=g.ads)==null?void 0:e.items)||[]}},s=((a=g.ads)==null?void 0:a.items)||[];return{settings:d,ads:s}}catch(r){return console.warn("Could not fetch public settings, falling back to context.",r),{settings:w,ads:P}}},C=async e=>{H(!0),u(e?`بدء إنشاء صفحات المدونة لـ: ${e}`:"بدء إنشاء صفحات المدونة للكل...");try{const{settings:a,ads:r}=await M(),n=[],g=[];e?g.push(e):(g.push("global"),N.en.forEach(l=>g.push(l.code)));for(const l of g){const d=c.filter(t=>t.enabled&&t.slug&&(l==="global"?!t.countryCode||t.countryCode==="global":t.countryCode===l));if(d.length===0)continue;const s=l==="global"?"ar":T(l),b=l==="global"?"":l;for(const t of d)if(t.content&&(t.content[s]||s==="ar"&&Object.values(t.content).length>0)){const m=R(t,c,a,s,r,f,c,b),h=l==="global"?`dist/blog/${t.slug}/index.html`:`dist/${l}/blog/${t.slug}/index.html`;n.push({path:h,content:E(m)});const S=I(t,c,a,s,r,f,c,b),i=l==="global"?`dist/blog/${t.slug}/amp/index.html`:`dist/${l}/blog/${t.slug}/amp/index.html`;n.push({path:i,content:E(S)})}if(d.length>0){const t=F(d,a,s,f,c,b),m=l==="global"?"dist/blog/index.html":`dist/${l}/blog/index.html`;n.push({path:m,content:E(t)})}}n.length===0?u("لا توجد مقالات مفعلة للنشر تطابق الفلتر المحدد."):(u(`رفع ${n.length} ملفًا إلى GitHub (تتضمن نسخ AMP)...`),await K({files:n,commitMessage:`feat: Regenerate static blog pages (Regular + AMP)${e?` for ${e}`:""}`}),u(`تم نشر ${n.length} ملف بنجاح!`))}catch(a){console.error(a);const r=a instanceof Error?a.message:String(a);u(`فشل: ${r}`)}finally{H(!1),setTimeout(()=>u(""),8e3)}},O=async()=>{var e,a,r;D(!0);try{const n=new q,g=n.folder("blog");if(!g)throw new Error("Could not create zip folder");const l=["global",...N.en.map(s=>s.code)];for(const s of l){const b=c.filter(i=>i.enabled&&i.slug&&(s==="global"?!i.countryCode||i.countryCode==="global":i.countryCode===s));if(b.length===0)continue;const t=s==="global"?"ar":T(s),m=s==="global"?"":s;let h=s==="global"?g:(e=n.folder(s))==null?void 0:e.folder("blog");if(!h&&s!=="global"&&(h=(a=n.folder(s))==null?void 0:a.folder("blog")),!h)continue;for(const i of b)if(i.content&&(i.content[t]||t==="ar"&&Object.values(i.content).length>0)){const U=R(i,c,w,t,P,f,c,m),x=h.folder(i.slug);x==null||x.file("index.html",U);const G=I(i,c,w,t,P,f,c,m);(r=x==null?void 0:x.folder("amp"))==null||r.file("index.html",G)}const S=F(b,w,t,f,c,m);h.file("index.html",S)}const d=await n.generateAsync({type:"blob"});Q.saveAs(d,"gitut-blog-pages.zip")}catch(n){console.error(n)}finally{D(!1)}};return o.jsxs("section",{className:"bg-white p-6 rounded-lg shadow-md border",children:[o.jsx("h2",{className:"text-xl font-bold mb-4",children:"إدارة صفحات المدونة (Static)"}),o.jsxs("div",{className:"flex gap-2 p-3 bg-gray-50 rounded-md items-center",children:[o.jsx("span",{className:"font-semibold text-gray-700 flex-1",children:"صفحات المدونة (Regular + AMP)"}),o.jsx("button",{onClick:O,disabled:j||y,title:"تنزيل ZIP",className:"bg-gray-600 text-white font-bold p-3 rounded-lg hover:bg-gray-700 disabled:bg-gray-400",children:o.jsx(z,{})}),o.jsxs("div",{className:"relative",ref:v,children:[o.jsxs("div",{className:"flex",children:[o.jsxs("button",{onClick:()=>C(),disabled:j||y,className:"bg-green-600 text-white font-bold p-3 rounded-r-lg hover:bg-green-700 disabled:bg-gray-400 flex items-center gap-2",children:[j?o.jsx(_,{className:"animate-spin"}):o.jsx(Z,{}),o.jsx("span",{children:"نشر الكل"})]}),o.jsx("button",{onClick:()=>A(!k),disabled:j||y,className:"bg-green-700 text-white font-bold p-3 rounded-l-lg hover:bg-green-800 disabled:bg-gray-500 border-r border-green-500",children:o.jsx(J,{})})]}),k&&o.jsxs("div",{className:"absolute left-0 mt-1 w-48 bg-white rounded-md shadow-lg border z-10 max-h-60 overflow-y-auto",children:[o.jsx("button",{onClick:()=>C("global"),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 font-bold border-b",children:"Global (الكل)"}),N.en.map(e=>o.jsxs("button",{onClick:()=>C(e.code),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[o.jsx("span",{children:e.flag})," ",e.name]},e.code))]})]})]}),$&&o.jsx("p",{className:"text-blue-600 text-sm mt-2 text-center",children:$})]})};export{Y as default};
