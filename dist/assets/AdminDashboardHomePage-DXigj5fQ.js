import{r as s,u as L,p as M,j as e,bd as U,L as x,be as k,bf as f,bg as p,bh as j}from"./index-hpjxKmld.js";const C=()=>{const[y,m]=s.useState(0),[N,h]=s.useState(0),[n,g]=s.useState({DZD:0,USD:0}),[r,b]=s.useState(!0),[o,u]=s.useState(!1),[d,a]=s.useState(""),{refetchAdminData:v}=L(),{useAdminChatManager:w}=M(),{onlineCafeIds:D}=w();s.useEffect(()=>{(async()=>{b(!0);try{const[t,i,c]=await Promise.all([f(),p(),j()]),R=t.filter(P=>P.status==="Pending").length;h(R),m(i.length),g(c)}catch(t){console.error("Failed to fetch dashboard data:",t)}finally{b(!1)}})()},[]);const S=async()=>{u(!0),a("جاري مزامنة أحدث البيانات من الخادم...");try{await v();const[l,t,i]=await Promise.all([f(),p(),j()]);h(l.filter(c=>c.status==="Pending").length),m(t.length),g(i),a("اكتمل التحديث بنجاح!")}catch(l){console.error("Manual refresh failed:",l),a("فشل التحديث. يرجى التحقق من وحدة التحكم.")}finally{u(!1),setTimeout(()=>a(""),5e3)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4 mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"نظرة عامة على المنصة"}),e.jsxs("button",{onClick:S,disabled:o,className:"flex items-center gap-2 bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-400 disabled:cursor-wait",children:[e.jsx(U,{className:o?"animate-spin":""}),e.jsx("span",{children:o?"جاري التحديث...":"تحديث البيانات"})]})]}),d&&e.jsx("div",{className:`p-3 mb-4 rounded-md text-center ${d.includes("فشل")?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`,children:d}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border-b-4 border-blue-500",children:[e.jsx("h2",{className:"text-sm font-bold text-gray-500 mb-2 uppercase",children:"إجمالي المقاهي"}),r?e.jsx("p",{className:"text-4xl font-bold text-gray-900",children:"..."}):e.jsx("p",{className:"text-4xl font-bold text-gray-900",children:y}),e.jsx(x,{to:"/admin/app/users",className:"text-blue-600 text-sm hover:underline mt-4 inline-block font-semibold",children:"إدارة المستخدمين →"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border-b-4 border-green-500",children:[e.jsx("h2",{className:"text-sm font-bold text-gray-500 mb-2 uppercase",children:"المقاهي المتصلة"}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("p",{className:"text-4xl font-bold text-green-600",children:D.size}),e.jsx(k,{className:"text-green-500 animate-pulse"})]}),e.jsx(x,{to:"/admin/app/chat",className:"text-green-600 text-sm hover:underline mt-4 inline-block font-semibold",children:"التواصل الفوري →"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border-b-4 border-yellow-500",children:[e.jsx("h2",{className:"text-sm font-bold text-gray-500 mb-2 uppercase",children:"طلبات دفع معلقة"}),r?e.jsx("p",{className:"text-4xl font-bold text-gray-900",children:"..."}):e.jsx("p",{className:"text-4xl font-bold text-gray-900",children:N}),e.jsx(x,{to:"/admin/app/billing",className:"text-yellow-700 text-sm hover:underline mt-4 inline-block font-semibold",children:"مراجعة الطلبات →"})]}),e.jsxs("div",{className:"bg-white p-6 rounded-lg shadow border-b-4 border-indigo-500",children:[e.jsx("h2",{className:"text-sm font-bold text-gray-500 mb-2 uppercase",children:"إيرادات الشهر"}),r?e.jsx("p",{className:"text-2xl font-bold text-gray-900",children:"..."}):e.jsxs("div",{className:"space-y-1",children:[e.jsxs("p",{className:"text-2xl font-bold text-gray-900 font-mono",children:[n.DZD.toLocaleString("ar-DZ")," ",e.jsx("span",{className:"text-sm",children:"دج"})]}),n.USD>0&&e.jsxs("p",{className:"text-lg font-bold text-indigo-600 font-mono",children:["+ $",n.USD.toLocaleString()]})]})]})]})]})};export{C as default};
