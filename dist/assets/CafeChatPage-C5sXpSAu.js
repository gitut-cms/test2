import{o as N,c as w,p as v,r as d,j as e,b5 as C,b6 as M,b7 as u,b8 as A,aj as k,b9 as F}from"./index-DgmZNK3x.js";import{C as p}from"./ChatWindow-BB8eBxdG.js";const E=()=>{const{user:a}=N();w();const{useCafeChatManager:j}=v(),{adminConversation:i,visitorConversations:l,sendMessageToAdmin:f,sendMessageToVisitor:y,markAdminAsRead:c,markVisitorAsRead:o,isAdminOnline:x}=j(),[s,m]=d.useState({type:"admin",id:"admin"});d.useEffect(()=>{s.type==="admin"?c():o(s.id)},[s,c,o]);const h=d.useMemo(()=>Array.from(l.entries()).sort(([,t],[,n])=>{var r,b;return(((r=n.lastMessage)==null?void 0:r.timestamp)||0)-(((b=t.lastMessage)==null?void 0:b.timestamp)||0)}),[l]),g=d.useMemo(()=>s.type==="admin"?i:l.get(s.id),[s,i,l]);return e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800 mb-6",children:"مركز التواصل"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 items-start h-[75vh]",children:[e.jsx("aside",{className:"lg:col-span-1 bg-gray-50 rounded-xl p-4 border h-full overflow-y-auto",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest mb-3 flex items-center gap-2",children:[e.jsx(C,{})," ",e.jsx("span",{children:"الدعم الفني"})]}),e.jsxs("button",{onClick:()=>m({type:"admin",id:"admin"}),className:`w-full text-right p-4 rounded-xl border-2 transition-all flex justify-between items-center ${s.id==="admin"?"bg-blue-600 border-blue-700 text-white shadow-lg":"bg-white hover:bg-gray-100 border-transparent shadow-sm"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative",children:[e.jsx(M,{size:24,className:s.id==="admin"?"text-blue-100":"text-blue-600"}),e.jsx("span",{className:`absolute -bottom-1 -right-1 w-3 h-3 rounded-full border-2 border-white ${x?"bg-green-500":"bg-gray-400"}`})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:"إدارة المنصة"}),e.jsx("p",{className:`text-xs truncate max-w-[120px] ${s.id==="admin"?"text-blue-100":"text-gray-500"}`,children:x?"متصل الآن":"أوفلاين"})]})]}),i.unread&&e.jsx(u,{className:"text-red-400 text-[10px] animate-pulse"})]})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xs font-bold text-gray-400 uppercase tracking-widest mb-3 flex items-center gap-2",children:[e.jsx(A,{})," ",e.jsx("span",{children:"دردشة الزبائن"})]}),e.jsx("div",{className:"space-y-2",children:h.length>0?h.map(([t,n])=>{var r;return e.jsxs("button",{onClick:()=>m({type:"visitor",id:t}),className:`w-full text-right p-3 rounded-lg border-2 transition-all flex justify-between items-center ${s.id===t?"bg-green-600 border-green-700 text-white":"bg-white hover:bg-gray-100 border-transparent shadow-sm"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(k,{className:s.id===t?"text-green-100":"text-gray-400"}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-sm",children:["زبون #",t.substring(8,12)]}),e.jsx("p",{className:`text-xs truncate max-w-[150px] ${s.id===t?"text-green-100":"text-gray-500"}`,children:(r=n.lastMessage)==null?void 0:r.text})]})]}),n.unread&&e.jsx(u,{className:"text-blue-500 text-[8px]"})]},t)}):e.jsx("div",{className:"text-center py-6 border-2 border-dashed rounded-lg opacity-40",children:e.jsx("p",{className:"text-xs",children:"لا توجد محادثات زبائن"})})})]})]})}),e.jsx("main",{className:"lg:col-span-2 bg-white rounded-xl border shadow-md h-full flex flex-col overflow-hidden",children:s.type==="admin"?x?e.jsx(p,{messages:i.messages,onSendMessage:f,currentUserId:(a==null?void 0:a.cafeId)||"",title:"الدعم الفني المباشر",isOnline:!0}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-10 text-center bg-gray-50",children:[e.jsx("div",{className:"bg-white p-8 rounded-full shadow-sm mb-6",children:e.jsx(F,{className:"text-6xl text-blue-100"})}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"الإدارة غير متصلة حالياً"}),e.jsx("p",{className:"text-gray-500 mb-8 max-w-sm",children:"لا يتواجد أي مسؤول حالياً للرد الفوري. يمكنك إرسال بريد إلكتروني أو المحاولة لاحقاً."}),e.jsx("a",{href:"mailto:mgkrol99@gmail.com",className:"bg-blue-600 text-white font-bold py-3 px-10 rounded-full hover:bg-blue-700 shadow-lg transition-all",children:"مراسلة عبر البريد"})]}):g?e.jsx(p,{messages:g.messages,onSendMessage:t=>y(s.id,t),currentUserId:(a==null?void 0:a.cafeId)||"",title:`دردشة مع زبون #${s.id.substring(8,12)}`,isOnline:!0}):e.jsx("div",{className:"flex items-center justify-center h-full text-gray-400",children:e.jsx("p",{children:"يرجى اختيار محادثة من القائمة"})})})]})]})};export{E as default};
