import{a as Ct,r as i,p as Tt,m as St,j as e,i as Q,aP as ie,bp as We,a3 as xe,bB as It,bk as Xe,bC as Ot,h as kt,f as Ft,b9 as Dt,bD as Ht,e as Mt,H as Oe,x as At,an as Et,ao as Lt,aV as zt,bE as Ut,b3 as Y,aY as ke,bi as Rt,bm as Ke,bF as $t,a2 as Fe,bG as Jt,b2 as De,br as _t,bl as Pt}from"./index-DrB1YgVl.js";import{R as fe}from"./index-jCUXYg4f.js";import{c as he,d as Gt,e as Vt}from"./staticHtmlGenerator-Ba5j3Tzo.js";import"https://esm.sh/html-docx-js-typescript@0.1.5";import"https://esm.sh/file-saver@2.0.5";if(fe.Quill){const m=fe.Quill.import("attributors/style/size");m.whitelist=["8px","9px","10px","11px","12px","14px","16px","18px","20px","22px","24px","28px","36px","48px","72px"],fe.Quill.register("attributors/style/size",m,!0)}const be=m=>m.toLowerCase().trim().replace(/\s+/g,"-").replace(/[^a-z0-9\u0600-\u06FF-]/g,""),qt=m=>{let D=`<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
`;return m.forEach(I=>{D+=`  <url><loc>${I}</loc></url>
`}),D+="</urlset>",D},z=m=>{if(!m)return m;const I=m.replace(/<[^>]*>/g," ").replace(/\s+/g," ").trim().split(" ").length;let O="12pt",H="1.5";I>300?(O="11pt",H="1.1",console.log(`Dynamic Scaling: High density (${I} words). Using 11pt/1.1`)):I>200?(O="12pt",H="1.3",console.log(`Dynamic Scaling: Medium density (${I} words). Using 12pt/1.3`)):(O="14pt",H="1.6",console.log(`Dynamic Scaling: Low density (${I} words). Using 14pt/1.6`));const k=`
        .content, body { font-size: ${O} !important; line-height: ${H} !important; }
        /* Ensure lists are compact if text is long */
        ${I>300?"ul, ol { margin-top: 5px; margin-bottom: 5px; } li { margin-bottom: 2px; }":""}
    `;return m.includes("</style>")?m.replace("</style>",`${k}</style>`):m.includes("</head>")?m.replace("</head>",`<style>${k}</style></head>`):`<style>${k}</style>`+m},Yt=({isOpen:m,fieldId:D,onClose:I,onSave:O})=>{const[H,k]=i.useState("text"),[B,W]=i.useState(""),[U,P]=i.useState(""),[F,b]=i.useState("simple"),[w,C]=i.useState([]),[R,T]=i.useState(""),[M,v]=i.useState([]),[Z,f]=i.useState(""),[G,$]=i.useState("");i.useEffect(()=>{m&&(k("text"),C([]),T(""),v([]),W(""),P(""),b("simple"),f(""),$(""))},[m,D]);const E=()=>{R.trim()&&(C([...w,R.trim()]),T(""))},He=l=>{C(w.filter((r,d)=>d!==l))},oe=()=>{v([...M,{label:"",value:""}])},J=(l,r,d)=>{const p=[...M];p[l]={...p[l],[r]:d},r==="label"&&!p[l].value&&(p[l].value=be(d)),v(p)},ye=l=>{const r=[...M];r[l].subField?(delete r[l].subField,delete r[l].outputTemplate):(r[l].subField={type:"text",customQuestion:""},r[l].outputTemplate=`${r[l].label} {subValue}`),v(r)},V=(l,r,d)=>{const p=[...M];p[l].subField&&(p[l].subField={...p[l].subField,[r]:d}),v(p)},de=l=>{const r=[...M];r[l].mappedValues={...r[l].mappedValues,"":""},v(r)},S=(l,r,d,p)=>{const A=[...M],y={...A[l].mappedValues};r!==d&&delete y[r],y[d]=p,A[l].mappedValues=y,v(A)},ee=(l,r)=>{const d=[...M],p={...d[l].mappedValues};delete p[r],d[l].mappedValues=p,v(d)},te=l=>{v(M.filter((r,d)=>d!==l))},X=()=>{const l={type:H};if(B.trim()&&(l.customQuestion=B),U.trim()&&(l.placeholder=U),H==="select")if(F==="simple")l.options=w;else if(F==="builder"){const r=M.filter(d=>d.label.trim()!=="");l.options=r}else try{const r=JSON.parse(Z);if(!Array.isArray(r))throw new Error("JSON must be an array.");l.options=r}catch(r){$(r.message);return}O(l)};return m?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-[100] flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl animate-fadeIn max-h-[90vh] overflow-y-auto",onClick:l=>l.stopPropagation(),children:[e.jsx("div",{className:"p-4 border-b bg-gray-50 rounded-t-lg",children:e.jsxs("h3",{className:"text-lg font-bold text-gray-800",children:["إعداد الحقل: ",e.jsx("span",{className:"text-blue-600 font-mono",dir:"ltr",children:D})]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"نوع الحقل"}),e.jsxs("select",{value:H,onChange:l=>k(l.target.value),className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-blue-500 outline-none",children:[e.jsx("option",{value:"text",children:"نص عادي (Text)"}),e.jsx("option",{value:"select",children:"قائمة اختيار (Select)"}),e.jsx("option",{value:"date",children:"تاريخ (Date)"}),e.jsx("option",{value:"number",children:"رقم (Number)"})]})]}),H==="select"&&e.jsxs("div",{className:"bg-gray-50 p-4 rounded-md border shadow-inner",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4 border-b pb-2",children:[e.jsx("label",{className:"block text-sm font-bold text-gray-700",children:"خيارات القائمة"}),e.jsxs("div",{className:"flex gap-1 text-xs",children:[e.jsx("button",{type:"button",onClick:()=>b("simple"),className:`px-3 py-1 rounded-full transition-colors ${F==="simple"?"bg-blue-600 text-white shadow":"bg-white text-gray-600 border"}`,children:"بسيط (نصوص) Capitalization"}),e.jsxs("button",{type:"button",onClick:()=>b("builder"),className:`px-3 py-1 rounded-full transition-colors flex items-center gap-1 ${F==="builder"?"bg-purple-600 text-white shadow":"bg-white text-gray-600 border"}`,children:[e.jsx($t,{})," منشئ شرطي"]}),e.jsx("button",{type:"button",onClick:()=>b("json"),className:`px-3 py-1 rounded-full transition-colors ${F==="json"?"bg-gray-800 text-white shadow":"bg-white text-gray-600 border"}`,children:"كود JSON"})]})]}),F==="simple"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2 mb-2",children:[e.jsx("input",{type:"text",value:R,onChange:l=>T(l.target.value),className:"flex-grow p-2 border rounded-md text-sm",placeholder:"أضف خيار...",onKeyDown:l=>l.key==="Enter"&&E()}),e.jsx("button",{onClick:E,className:"bg-blue-600 text-white p-2 rounded-md hover:bg-blue-700",children:e.jsx(xe,{})})]}),e.jsxs("ul",{className:"space-y-1 max-h-48 overflow-y-auto",children:[w.map((l,r)=>e.jsxs("li",{className:"flex justify-between items-center bg-white p-2 rounded text-sm border shadow-sm",children:[e.jsx("span",{children:l}),e.jsx("button",{onClick:()=>He(r),className:"text-red-500 hover:text-red-700",children:e.jsx(Fe,{size:12})})]},r)),w.length===0&&e.jsx("p",{className:"text-xs text-gray-400 text-center py-2",children:"لا توجد خيارات مضافة."})]})]}),F==="builder"&&e.jsxs("div",{className:"space-y-3 max-h-[50vh] overflow-y-auto pr-1",children:[M.map((l,r)=>e.jsxs("div",{className:"bg-white border rounded-lg p-3 shadow-sm relative group",children:[e.jsx("button",{onClick:()=>te(r),className:"absolute top-2 left-2 text-gray-400 hover:text-red-500 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(Fe,{})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-500 uppercase font-bold",children:"اسم الخيار (يظهر للزائر)"}),e.jsx("input",{className:"w-full p-1 border rounded text-sm bg-gray-50 focus:bg-white focus:ring-1 focus:ring-purple-500",value:l.label,onChange:d=>J(r,"label",d.target.value),placeholder:"مثال: متزوج"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-gray-500 uppercase font-bold",children:"القيمة (Value)"}),e.jsx("input",{className:"w-full p-1 border rounded text-sm font-mono text-gray-600",value:l.value,onChange:d=>J(r,"value",d.target.value),placeholder:"auto-generated"})]})]}),e.jsxs("div",{className:"mt-2 pt-2 border-t",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{className:"text-[10px] font-bold text-blue-700",children:"قيم متغيرة (Mapped Values)"}),e.jsxs("button",{type:"button",onClick:()=>de(r),className:"text-[10px] bg-blue-100 text-blue-700 px-2 py-0.5 rounded hover:bg-blue-200",children:[e.jsx(xe,{className:"inline"})," إضافة"]})]}),l.mappedValues&&Object.entries(l.mappedValues).map(([d,p],A)=>e.jsxs("div",{className:"flex gap-1 mb-1 items-center",children:[e.jsx("input",{className:"w-1/3 p-1 text-xs border rounded bg-gray-50 font-mono",placeholder:"المفتاح (Key)",value:d,onChange:y=>S(r,d,y.target.value,p)}),e.jsx("span",{className:"text-gray-400",children:"="}),e.jsx("input",{className:"flex-grow p-1 text-xs border rounded",placeholder:"القيمة (Value)",value:p,onChange:y=>S(r,d,d,y.target.value)}),e.jsx("button",{type:"button",onClick:()=>ee(r,d),className:"text-red-400 hover:text-red-600 px-1",children:e.jsx(Fe,{size:10})})]},A)),(!l.mappedValues||Object.keys(l.mappedValues).length===0)&&e.jsx("p",{className:"text-[10px] text-gray-400 italic",children:"لا توجد قيم مرتبطة."})]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2 mt-2 pt-2 border-t",children:[e.jsx("input",{type:"checkbox",id:`toggle-sub-${r}`,checked:!!l.subField,onChange:()=>ye(r),className:"rounded text-purple-600 focus:ring-purple-500"}),e.jsx("label",{htmlFor:`toggle-sub-${r}`,className:"text-xs font-semibold text-gray-700 cursor-pointer select-none",children:"تفعيل سؤال فرعي لهذا الخيار؟ (مثال: عدد الأولاد)"})]}),l.subField&&e.jsxs("div",{className:"bg-purple-50 p-3 rounded border border-purple-100 mt-2 animate-fadeIn",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-2",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"text-[10px] text-purple-800 font-bold block",children:"نوع السؤال الفرعي"}),e.jsxs("select",{className:"w-full p-1 border rounded text-xs bg-white",value:l.subField.type,onChange:d=>V(r,"type",d.target.value),children:[e.jsx("option",{value:"text",children:"نص"}),e.jsx("option",{value:"number",children:"رقم"}),e.jsx("option",{value:"date",children:"تاريخ"}),e.jsx("option",{value:"select",children:"قائمة فرعية"})]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-[10px] text-purple-800 font-bold block",children:"نص السؤال الفرعي"}),e.jsx("input",{className:"w-full p-1 border rounded text-xs",value:l.subField.customQuestion||"",onChange:d=>V(r,"customQuestion",d.target.value),placeholder:"مثال: كم عدد الأولاد؟"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-[10px] text-purple-800 font-bold block mb-1",children:"صيغة الإخراج النهائية (Template)"}),e.jsx("div",{className:"flex gap-2",children:e.jsx("input",{className:"flex-grow p-1 border rounded text-xs",value:l.outputTemplate||"",onChange:d=>J(r,"outputTemplate",d.target.value),placeholder:"مثال: متزوج وله {subValue} أولاد"})}),e.jsxs("p",{className:"text-[10px] text-gray-500 mt-1",children:["استخدم ",e.jsx("code",{children:"{subValue}"})," لدمج إجابة الزائر في الجملة. استخدم ",e.jsx("code",{children:"{self}"})," لاسم الخيار."]})]})]})]},r)),e.jsxs("button",{onClick:oe,className:"w-full py-2 border-2 border-dashed border-gray-300 rounded-lg text-gray-500 hover:border-purple-500 hover:text-purple-600 hover:bg-purple-50 transition-colors flex items-center justify-center gap-2 font-semibold",children:[e.jsx(xe,{})," إضافة خيار جديد"]})]}),F==="json"&&e.jsxs(e.Fragment,{children:[e.jsx("textarea",{value:Z,onChange:l=>f(l.target.value),className:"w-full h-48 p-2 border rounded-md text-xs font-mono bg-gray-900 text-green-400",placeholder:`[
  { "value": "male", "label": "رجل", "mappedValues": { "opponent_role": "المحامي" } },
  { "value": "female", "label": "امرأة", "mappedValues": { "opponent_role": "المحامية" } }
]`,dir:"ltr"}),G&&e.jsx("p",{className:"text-red-600 text-xs mt-1 font-bold",children:G}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"استخدم هذا الوضع للمطورين لنسخ/لصق الهياكل المعقدة."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"سؤال مخصص (يظهر للزبون)"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:B,onChange:l=>W(l.target.value),className:"flex-grow p-2 border rounded-md",placeholder:"مثال: ما هو الاسم الكامل؟"}),e.jsx(Jt,{className:"text-gray-400",title:"هذا السؤال سيحل محل الاسم الافتراضي للحقل في واجهة النموذج."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"نص توضيحي (Placeholder)"}),e.jsx("input",{type:"text",value:U,onChange:l=>P(l.target.value),className:"w-full p-2 border rounded-md",placeholder:"مثال: اكتب الاسم هنا..."})]})]}),e.jsxs("div",{className:"p-4 border-t bg-gray-50 flex justify-end gap-2 rounded-b-lg",children:[e.jsx("button",{onClick:I,className:"px-4 py-2 bg-gray-200 rounded-md hover:bg-gray-300 text-gray-800 font-semibold transition-colors",children:"إلغاء"}),e.jsx("button",{onClick:X,className:"px-4 py-2 bg-green-600 rounded-md hover:bg-green-700 text-white font-bold transition-colors",children:"حفظ وإدراج"})]})]})}):null},Qt=({isOpen:m,onClose:D,onGenerate:I})=>{const[O,H]=i.useState(""),[k,B]=i.useState("dz"),[W,U]=i.useState(!1),[P,F]=i.useState(""),b=async()=>{if(!O.trim())return;U(!0),F("");const w=`
Create a single JSON object representing a document template for the context: "${O}".
Target Country: "${k}".
Language: The content must be in the official language of ${k}.
**IMPORTANT:** Always include "[DateToday]" in the "requiredFields" array and use it in the HTML template for the date. Do NOT include it in "fieldCustomizations" as it is auto-filled.

Structure must match this TypeScript interface:
interface Document {
  id: string; // Unique, English, kebab-case (e.g., "request-form-dz")
  groupId: string; // Same as id
  name: string; // In target language
  description: string; // HTML format (<p>...</p>), detailed, in target language.
  countryCode: string; // "${k}"
  requiredFields: string[]; // Array of field keys (e.g., "fullName", "address", "DateToday", "gender")
  fieldCustomizations: {
    [key: string]: {
      type: "text" | "date" | "number" | "textarea" | "select";
      customQuestion: string; // The label/question in target language
      placeholder?: string; // Optional placeholder
      options?: Array<{ // Use this specific structure for select options
         label: string; 
         value: string;
         subField?: { // If this option needs more info
             type: "text" | "number" | "date";
             customQuestion: string;
         };
         outputTemplate?: string; // Template for final doc if subField is used
         mappedValues?: Record<string, string>; // Maps a selected option to other field values (e.g., titles)
      }>; 
    }
  };
  finalTemplateHtml: string; // The full HTML string
  previewTemplateHtml: string; // A simplified HTML string
}

CRITICAL HTML RULES:
1. The HTML must strictly follow this structure. DO NOT CHANGE THE CSS classes or layout, only the font:
<!DOCTYPE html><html lang="[LANG_CODE]" dir="[DIR]"><head><meta charset="utf-8"><link href="[FONT_URL]" rel="stylesheet"><style>@page{size:A4;margin:0}body{margin:0;padding:0;font-family:'[FONT_NAME]',serif}.page{width:210mm;height:297mm;padding:25mm;margin:0 auto;display:flex;flex-direction:column;box-sizing:border-box;background:white;overflow:hidden}.header{display:flex;justify-content:space-between;margin-bottom:20px;font-size:14pt}.title{text-align:center;font-size:22pt;font-weight:700;text-decoration:underline;margin:30px 0 50px 0}.content{flex-grow:1;font-size:18pt;line-height:2;text-align:justify}.footer{margin-top:40px;display:flex;justify-content:space-between;font-size:16pt}.signature-box{min-width:200px;text-align:center}</style></head><body><div class="page"> ... CONTENT WITH [placeholders] ... </div></body></html>

2. FONT SELECTION:
   - If Arabic (dz, sa, eg, etc): Use 'Scheherazade New', URL: 'https://fonts.googleapis.com/css2?family=Scheherazade+New:wght@400;700&display=swap', dir="rtl"
   - If Japanese: Use 'Noto Serif JP', URL: 'https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&display=swap', dir="ltr"
   - If Latin (en, fr, etc): Use 'Merriweather', URL: 'https://fonts.googleapis.com/css2?family=Merriweather:wght@400;700&display=swap', dir="ltr"

3. CONTENT & PLACEHOLDERS:
   - Use [DateToday] for the current date in the header or footer.
   - Use placeholders like [fullName], [address] inside the HTML.
   - For 'select' fields with 'subField', ensure the HTML logic matches. 
     *Example:* If user selects 'Mayor' for a field named 'recipient', and 'Mayor' has a subfield for 'City Name', the HTML should just use [recipient] because the app will inject the final formatted string (e.g. "To the Mayor of Algiers") into [recipient] based on the 'outputTemplate' you define in JSON.

4. DYNAMIC TYPOGRAPHY & SCALING (CRITICAL):
   - You MUST analyze the length of the generated content text.
   - **MODIFY the CSS inside the <style> tag based on content length:**
     - If content is LONG (> 300 words): Use \`.content { font-size: 11pt; line-height: 1.1; }\`
     - If content is MEDIUM (200-300 words): Use \`.content { font-size: 12pt; line-height: 1.3; }\`
     - If content is SHORT (< 200 words): Use \`.content { font-size: 14pt; line-height: 1.6; }\`
   - **GOAL:** Ensure the text fits perfectly on ONE A4 page without overflowing and without leaving too much empty space. The footer/signature MUST be visible at the bottom.
   - **LINE LIMIT (STRICT):** The total number of lines in the generated document body MUST NOT exceed 20 lines to ensure it fits perfectly on a single A4 page.

5. SMART LISTS:
   - If a list (<ul> or <ol>) has **more than 4 items**, add \`style="column-count: 2; column-gap: 2rem;"\` to the list tag to save vertical space.

6. SPECIAL GENDER FIELDS (CRITICAL - MANDATORY):
   - **MANDATORY**: Distinguish between the **Recipient** and the **Applicant**.
   - **Recipient** (e.g., 'To the Mayor'): DO NOT use dynamic placeholders for their gender. Use a standard neutral or fixed title-based address as per official customs (e.g., السيد رئيس البلدية).
   - **Applicant/Sender** (The person filing the doc): ALL words referring to the applicant that change with gender (e.g., 'I the undersigned', 'Born', 'Resident', 'Signer', 'Declarant') MUST be replaced with placeholders linked to the 'gender' field's \`mappedValues\`.
   - **Gender/Sex Selection Structure**:
     [
       { 
         "label": "Male (translated)", 
         "value": "male", 
         "mappedValues": { 
            "citizen_title": "Honorific for Male (e.g., السيد)",
            "born_title": "Born (Masculine, e.g. المولود)",
            "resident_title": "Resident (Masculine, e.g. الساكن)",
            "signer_title": "Signer (Masculine, e.g. الموقع)",
            "declarant_title": "Declarant (Masculine, e.g. المصرح)"
         } 
       },
       { 
         "label": "Female (translated)", 
         "value": "female", 
         "mappedValues": { 
            "citizen_title": "Honorific for Female (e.g., السيدة)",
            "born_title": "Born (Feminine, e.g. المولودة)",
            "resident_title": "Resident (Feminine, e.g. الساكنة)",
            "signer_title": "Signer (Feminine, e.g. الموقعة)",
            "declarant_title": "Declarant (Feminine, e.g. المصرحة)"
         } 
       }
     ]
   - **CRITICAL**: In the HTML template, YOU MUST REPLACE EVERY word referring to the applicant that changes with gender with its corresponding placeholder (e.g., replace "المولود" with "[born_title]", replace "السيد" with "[citizen_title]").
`;try{let R=(await De({model:"gemini-2.5-flash",contents:w})).text||"";R=R.replace(/```json/g,"").replace(/```/g,"").trim();const T=JSON.parse(R);T.finalTemplateHtml&&(T.finalTemplateHtml=z(T.finalTemplateHtml)),T.previewTemplateHtml&&(T.previewTemplateHtml=z(T.previewTemplateHtml)),I(T),D()}catch(C){console.error("AI Generation Error:",C),F("Failed to generate document. Please try again.")}finally{U(!1)}};return m?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-[100] flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-md animate-fadeIn",onClick:w=>w.stopPropagation(),children:[e.jsx("div",{className:"p-4 border-b rounded-t-lg bg-purple-50",children:e.jsxs("h3",{className:"text-lg font-bold text-purple-800 flex items-center gap-2",children:[e.jsx(Ut,{})," توليد مستند بالذكاء الاصطناعي"]})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"موضوع المستند / الاسم"}),e.jsx("input",{type:"text",value:O,onChange:w=>H(w.target.value),placeholder:"مثال: طلب عطلة أمومة، تصريح شرفي...",className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-purple-500 outline-none"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"رمز الدولة (Country Code)"}),e.jsx("input",{type:"text",value:k,onChange:w=>B(w.target.value),placeholder:"dz, fr, sa...",className:"w-full p-2 border rounded-md focus:ring-2 focus:ring-purple-500 outline-none"})]}),P&&e.jsx("p",{className:"text-red-500 text-sm",children:P})]}),e.jsxs("div",{className:"p-4 border-t bg-gray-50 flex justify-end gap-2 rounded-b-lg",children:[e.jsx("button",{onClick:D,className:"px-4 py-2 bg-gray-200 rounded-md hover:bg-gray-300 text-gray-800 font-semibold transition-colors",children:"إلغاء"}),e.jsxs("button",{onClick:b,disabled:W||!O,className:"px-4 py-2 bg-purple-600 rounded-md hover:bg-purple-700 text-white font-bold transition-colors disabled:bg-gray-400 flex items-center gap-2",children:[W?e.jsx(Q,{className:"animate-spin"}):e.jsx(ie,{}),e.jsx("span",{children:"توليد"})]})]})]})}):null},es=()=>{const{fullDocuments:m,loadingFullDocuments:D,codes:I,refetchAdminData:O,services:H,sites:k,staticDocuments:B,siteSettings:W,pages:U,blogPosts:P,ads:F}=Ct(),[b,w]=i.useState([]);Tt(),St();const[C,R]=i.useState(()=>localStorage.getItem("admin_documents_country_filter")||"all"),[T,M]=i.useState(!1),[v,Z]=i.useState({isOpen:!1,mode:"create",doc:null}),[f,G]=i.useState({}),[$,E]=i.useState(!1),[He,oe]=i.useState(""),[J,ye]=i.useState(""),[V,de]=i.useState({preview:"",final:""}),[S,ee]=i.useState({isOpen:!1,doc:null}),[te,X]=i.useState(""),[l,r]=i.useState(""),[d,p]=i.useState(""),A=i.useRef(null),[y,ce]=i.useState({isOpen:!1,fieldId:""}),[Me,Ae]=i.useState(!1),[Ee,Le]=i.useState(!1),[je,ze]=i.useState({preview:"upload",final:"upload"}),[Ne,Ue]=i.useState({preview:"",final:""}),[Re,$e]=i.useState(!1),[Je,_e]=i.useState(null);i.useRef(null),i.useRef(null);const[Ze,we]=i.useState(!1),[ve,Ce]=i.useState(""),[q,le]=i.useState(null),[Pe,Ge]=i.useState(!1),[Te,pe]=i.useState("skip"),[K,ue]=i.useState(new Set),et=t=>{const s=t.target.value;R(s),localStorage.setItem("admin_documents_country_filter",s)};i.useEffect(()=>{const s=[...m].sort((n,a)=>n.name.localeCompare(a.name)).filter(n=>{const a=n.description?n.description.replace(/<[^>]*>?/gm,""):"",c=a.split(/\s+/).filter(N=>N!=="").length,g=!a||c<100,h=n.name.toLowerCase().includes(J.toLowerCase())||n.description.toLowerCase().includes(J.toLowerCase())||n.id.toLowerCase().includes(J.toLowerCase()),x=C==="all"||(C==="global"?!n.countryCode||n.countryCode==="global":n.countryCode===C);return h&&x&&(!T||g)});w(s)},[m,J,C,T]);const ne=async()=>{await O()},tt=async t=>{if(window.confirm("هل أنت متأكد من أنك تريد حذف هذا المستند؟ لا يمكن التراجع عن هذا الإجراء."))try{await Y.delete(t),await ne(),alert("تم حذف المستند بنجاح.")}catch(s){console.error("Failed to delete document:",s),alert("فشل حذف المستند.")}},st=()=>{G({id:"",name:"",groupId:"",description:"",countryCode:C!=="all"&&C!=="global"?C:"dz",requiredFields:[],complexFields:[],previewTemplateUrl:"",finalTemplateUrl:"",previewTemplateHtml:"",finalTemplateHtml:"",tags:"",slug:""}),ze({preview:"upload",final:"upload"}),Ue({preview:"",final:""}),de({preview:"",final:""}),Z({isOpen:!0,mode:"create",doc:null}),oe("")},lt=async t=>{G({...t});const s={preview:"upload",final:"upload"},n={preview:t.previewTemplateHtml||"",final:t.finalTemplateHtml||""};t.previewTemplateHtml&&(s.preview="code"),t.finalTemplateHtml&&(s.final="code"),Ue(n),ze(s),de({preview:"",final:""}),Z({isOpen:!0,mode:"edit",doc:t}),oe("")},Ve=()=>{Z({isOpen:!1,mode:"create",doc:null})},se=t=>{const{name:s,value:n}=t.target;G(a=>({...a,[s]:n}))},qe=async(t,s)=>{var x,j;const n=Pt(s),a=((x=_t.find(N=>N.code===n))==null?void 0:x.name)||"Arabic",c=((j=Xe.en.find(N=>N.code===s))==null?void 0:j.name)||s,g=`
        Act as a professional technical writer and SEO specialist.
        Write a comprehensive and high-quality description for a document named "${t}".
        
        Context:
        - This document is used in: ${c}.
        - The audience is general citizens or employees.
        
        IMPORTANT RULES:
        1. Language: The content MUST be written in ${a} language.
        2. Length: The description MUST be concise and strictly NOT exceed 20 lines. Be detailed, explain the purpose, the legal context (if any), and the benefits of using this template.
        3. Structure: 
            - Start IMMEDIATELY with a paragraph (<p>) defining the document. **Do NOT start with a Heading (<h1>, <h2>, etc.).**
            - Use <h3> tags for subsequent sections (e.g., "Requirements", "How to use", "Importance").
            - Use <ul> or <ol> lists where appropriate.
        4. Format: Return HTML content only.
        `;return(await De({model:"gemini-2.5-flash",contents:g})).text||""},nt=async()=>{var t;if(!((t=f.name)!=null&&t.trim())){alert("يرجى إدخال اسم المستند أولاً.");return}$e(!0);try{const s=await qe(f.name,f.countryCode||"dz");G(n=>({...n,description:s}))}catch(s){console.error("AI Error:",s),alert("فشل توليد الوصف. يرجى المحاولة مرة أخرى.")}finally{$e(!1)}},at=async t=>{_e(t.id);try{const s=await qe(t.name,t.countryCode||"dz");await Y.update(t.id,{description:s}),w(n=>n.map(a=>a.id===t.id?{...a,description:s}:a)),ne()}catch(s){console.error("Quick AI Error:",s),alert("فشل توليد الوصف التلقائي.")}finally{_e(null)}},Ye=t=>{const{finalTemplateHtml:s,...n}=t;r(s||""),X(JSON.stringify(n,null,2)),p(""),ee({isOpen:!0,doc:t})},rt=()=>{ee({isOpen:!1,doc:null}),X(""),r(""),p(""),ce({isOpen:!1,fieldId:""})},it=async()=>{if(S.doc){Le(!0),p("");try{const t=JSON.parse(te),s=t.name||S.doc.name,n=t.countryCode||S.doc.countryCode||"dz",a=S.doc.id,c=`
Create a single JSON object representing a document template for the context: "${s}".
Target Country: "${n}".
Language: The content must be in the official language of ${n}.
**IMPORTANT:** Always include "[DateToday]" in the "requiredFields" array and use it in the HTML template for the date. Do NOT include it in "fieldCustomizations" as it is auto-filled.

Structure must match this TypeScript interface:
interface Document {
  id: string; // MUST BE "${a}"
  groupId: string; // Same as id
  name: string; // In target language
  description: string; // HTML format (<p>...</p>), detailed, in target language.
  countryCode: string; // "${n}"
  requiredFields: string[]; // Array of field keys (e.g., "fullName", "address", "DateToday", "gender")
  fieldCustomizations: {
    [key: string]: {
      type: "text" | "date" | "number" | "textarea" | "select";
      customQuestion: string; // The label/question in target language
      placeholder?: string; // Optional placeholder
      options?: Array<{ // Use this specific structure for select options
         label: string; 
         value: string;
         subField?: { // If this option needs more info
             type: "text" | "number" | "date";
             customQuestion: string;
         };
         outputTemplate?: string; // Template for final doc if subField is used
         mappedValues?: Record<string, string>; // Maps a selected option to other field values (e.g., titles)
      }>; 
    }
  };
  finalTemplateHtml: string; // The full HTML string
  previewTemplateHtml: string; // A simplified HTML string
}

CRITICAL HTML RULES:
1. The HTML must strictly follow this structure. DO NOT CHANGE THE CSS classes or layout, only the font:
<!DOCTYPE html><html lang="[LANG_CODE]" dir="[DIR]"><head><meta charset="utf-8"><link href="[FONT_URL]" rel="stylesheet"><style>@page{size:A4;margin:0}body{margin:0;padding:0;font-family:'[FONT_NAME]',serif}.page{width:210mm;height:297mm;padding:25mm;margin:0 auto;display:flex;flex-direction:column;box-sizing:border-box;background:white;overflow:hidden}.header{display:flex;justify-content:space-between;margin-bottom:20px;font-size:14pt}.title{text-align:center;font-size:22pt;font-weight:700;text-decoration:underline;margin:30px 0 50px 0}.content{flex-grow:1;font-size:18pt;line-height:2;text-align:justify}.footer{margin-top:40px;display:flex;justify-content:space-between;font-size:16pt}.signature-box{min-width:200px;text-align:center}</style></head><body><div class="page"> ... CONTENT WITH [placeholders] ... </div></body></html>

2. DYNAMIC TYPOGRAPHY & SCALING (CRITICAL):
   - You MUST analyze the length of the generated content text.
   - **MODIFY the CSS inside the <style> tag based on content length:**
     - If content is LONG (> 300 words): Use \`.content { font-size: 11pt; line-height: 1.1; }\`
     - If content is MEDIUM (200-300 words): Use \`.content { font-size: 12pt; line-height: 1.3; }\`
     - If content is SHORT (< 200 words): Use \`.content { font-size: 14pt; line-height: 1.6; }\`
   - **LINE LIMIT (STRICT):** The total number of lines in the generated document body MUST NOT exceed 20 lines to ensure it fits perfectly on a single A4 page.

3. SPECIAL GENDER FIELDS (CRITICAL - MANDATORY):
   - **MANDATORY**: Distinguish between the Recipient and the Applicant.
   - Applicant/Sender (The person filing the doc): ALL words referring to the applicant that change with gender (e.g., 'I the undersigned', 'Born', 'Resident', 'Signer', 'Declarant') MUST be replaced with placeholders linked to the 'gender' field's mappedValues (citizen_title, born_title, resident_title, signer_title, declarant_title, holder_title).
`;let h=(await De({model:"gemini-2.5-flash",contents:c})).text||"";h=h.replace(/```json/g,"").replace(/```/g,"").trim();const x=JSON.parse(h);x.id=a,x.finalTemplateHtml&&(x.finalTemplateHtml=z(x.finalTemplateHtml));const{finalTemplateHtml:j,...N}=x;r(j||""),X(JSON.stringify(N,null,2)),alert("تمت إعادة توليد المحتوى بنجاح. يمكنك المعاينة ثم الحفظ.")}catch(t){console.error("AI Regeneration Error in Split View:",t),p(t.message||"Failed to regenerate with AI"),alert(`فشل إعادة التوليد: ${t.message}`)}finally{Le(!1)}}},Qe=t=>{if(!S.doc||b.length===0)return;const s=b.findIndex(c=>{var g;return c.id===((g=S.doc)==null?void 0:g.id)});if(s===-1)return;let n;t==="next"?n=(s+1)%b.length:n=(s-1+b.length)%b.length;const a=b[n];Ye(a)},ot=()=>{let t=f.finalTemplateHtml;if(!t&&je.final==="code"&&(t=Ne.final),t||(t=V.final),!t){alert("لا يوجد محتوى HTML للمعاينة. يرجى إدخال الكود أو رفع ملف.");return}const s=window.open("","_blank");s&&(s.document.write(t),s.document.close())},dt=async()=>{if(S.doc){E(!0),p("");try{let t;try{t=JSON.parse(te)}catch{throw new Error("Invalid JSON format in the left panel.")}const s={...t,finalTemplateHtml:l};if(s.finalTemplateHtml){const n=ke(s.finalTemplateHtml);s.requiredFields=n,s.finalTemplateHtml=z(s.finalTemplateHtml)}if(s.id!==S.doc.id){if(!window.confirm("You changed the Document ID in the JSON. This will create a NEW document instead of updating. Continue?")){E(!1);return}await Y.create(s),ee(a=>({...a,doc:s}))}else await Y.update(S.doc.id,s),ee(n=>({...n,doc:s}));await ne(),alert("تم حفظ التغييرات بنجاح!")}catch(t){console.error("Failed to save customizations:",t),p(t.message||"Failed to save."),alert(`فشل الحفظ: ${t.message}`)}finally{E(!1)}}},ct=t=>{const s=t.target.value;if(!s)return;const n=s.replace(/^\[|\]$/g,"");let a;A.current&&(a={start:A.current.selectionStart,end:A.current.selectionEnd}),ce({isOpen:!0,fieldId:n,insertPoints:a}),t.target.value=""},pt=t=>{try{const s=JSON.parse(te);if(s.fieldCustomizations=s.fieldCustomizations||{},s.fieldCustomizations[y.fieldId]=t,s.requiredFields=s.requiredFields||[],s.requiredFields.includes(y.fieldId)||s.requiredFields.push(y.fieldId),X(JSON.stringify(s,null,2)),y.insertPoints&&A.current){const n=`[${y.fieldId}]`,{start:a,end:c}=y.insertPoints,g=l.substring(0,a)+n+l.substring(c);r(g),setTimeout(()=>{const h=A.current;h&&(h.focus(),h.setSelectionRange(a+n.length,a+n.length))},0)}}catch(s){console.error("Error updating JSON from field config:",s),alert("خطأ في تحديث JSON. يرجى التأكد من صحة تنسيق JSON في اللوحة اليسرى.")}ce({isOpen:!1,fieldId:""})},ut=()=>{if(!l)return;const t=l.replace(/\[.*?\]/g,".........."),s=window.open("","_blank");s&&(s.document.write(t),s.document.close())},mt=()=>{Ce(JSON.stringify([{id:"optional-id",name:"اسم المستند",groupId:"group-id",description:"<p>وصف المستند</p>",countryCode:"dz",requiredFields:["fieldName1","fieldName2"],fieldCustomizations:{fieldName1:{type:"text",customQuestion:"Question?"},fieldName2:{type:"select",options:["A","B"]}},finalTemplateHtml:"<!-- HTML content with [fieldName1] -->"}],null,2)),p(""),le(null),pe("skip"),we(!0)},me=()=>{we(!1),le(null)},gt=t=>{if(!t)return;const s=window.open("","_blank");s&&(s.document.write(t),s.document.close())},ht=()=>{p(""),Ge(!0);try{const t=JSON.parse(ve),n=(Array.isArray(t)?t:[t]).map((a,c)=>{if(!a.name)return{status:"Error",id:`unknown-${c}`,name:"Unknown",slug:"",country:"",files:[],data:a,error:"Missing name"};let g=a.slug||be(a.name),h=a.id||a.groupId||g;const x=a.countryCode||"global",j=m.find(u=>u.id===h||u.slug===g);let N="New";j&&(Te==="overwrite"?(N="Update",h=j.id,g=j.slug||g):N="Skip");const ge=`data/json/documents/${x!=="global"?x+"/":""}${g}.json`,o=`dist/${x!=="global"?x+"/":""}doc/${g}/index.html`;return a.finalTemplateHtml&&(a.finalTemplateHtml=z(a.finalTemplateHtml)),a.previewTemplateHtml&&(a.previewTemplateHtml=z(a.previewTemplateHtml)),{status:N,id:h,name:a.name,slug:g,country:x,files:[ge,o],data:{...a,id:h,slug:g,countryCode:x}}});le(n)}catch(t){p(t.message||"Invalid JSON")}finally{Ge(!1)}},xt=async()=>{var n;if(!q)return;const t=q.filter(a=>a.status==="Update"&&a.data.description);let s=!1;t.length>0&&(s=window.confirm(`لقد تم العثور على ${t.length} مستند موجود مسبقاً يحتوي على وصف جديد في ملف JSON. هل تريد تحديث الأوصاف لهذه المستندات؟`)),E(!0);try{const a=[];let c=0;for(const o of q){if(o.status==="Error")continue;if(o.status==="Skip"){c++;continue}let u={...o.data};if(o.status==="Update"){const L=m.find(_=>_.id===u.id);L&&(!s||!u.description)&&(u.description=L.description)}u.finalTemplateHtml&&(u.requiredFields=ke(u.finalTemplateHtml),u.finalTemplateHtml=he(u.finalTemplateHtml)),u.previewTemplateHtml&&(u.previewTemplateHtml=he(u.previewTemplateHtml)),o.status==="New"?await Y.create(u):o.status==="Update"&&await Y.update(u.id,u),a.push({...u,serviceType:"doc"})}if(a.length===0){alert(`تم الانتهاء. تم تخطي ${c} مستند.`),E(!1),me();return}const g=[],h=[],x=W||Rt,j=F||[],N=[...m.map(o=>({...o,serviceType:"doc"})),...B.map(o=>({...o,serviceType:"static-doc"})),...k.map(o=>({...o,serviceType:"site"}))];a.forEach(o=>{const u=N.findIndex(L=>L.id===o.id);u>-1?N[u]=o:N.push(o)});const ge=new Set;for(const o of q){if(o.status==="Error"||o.status==="Skip")continue;ge.add(o.country);const u=o.files[0],L=JSON.stringify({...o.data,description:((n=a.find(re=>re.id===o.id))==null?void 0:n.description)||o.data.description,previewTemplateHtml:(o.data.finalTemplateHtml||"").replace(/\[.*?\]/g,"........")},null,2);g.push({path:u,content:L});const Se={...a.find(re=>re.id===o.id)||o.data,serviceType:"doc"},ae=Gt(Se,N,x,U,P,j,o.country),Ie=o.files[1];h.push({path:Ie,content:he(ae)})}for(const o of ge){const u=o==="global",L=N.filter(_=>_.slug&&(u?!_.countryCode||_.countryCode==="global":_.countryCode===o));if(L.length>0){const _=Vt(L,o,x,U,P,j),Se=u?"dist/services/index.html":`dist/${o}/services/index.html`;h.push({path:Se,content:he(_)});const ae=new Set;ae.add(`https://gitut.com/${u?"":o+"/"}services/`),L.forEach(Be=>{const wt=Be.serviceType==="site"?"site":"doc",vt=`https://gitut.com/${u?"":o+"/"}${wt}/${Be.slug}/`;ae.add(vt)});const Ie=qt(ae),re=u?"dist/sitemap/services.xml":`dist/sitemap/${o}/services.xml`;h.push({path:re,content:Ie})}}g.length>0&&await Ke({files:g,commitMessage:"feat: Batch update docs",repoConfig:{owner:"gitut-cms",repo:"files"}}),h.length>0&&await Ke({files:h,commitMessage:"feat: Publish static pages"}),await ne(),alert(`تم بنجاح! تم معالجة ${a.length} مستند.`),me()}catch(a){console.error("Bulk Import Failed:",a),p(`فشل التنفيذ: ${a.message}`)}finally{E(!1)}},ft=t=>{t.target.checked?ue(new Set(b.map(s=>s.id))):ue(new Set)},bt=t=>{const s=new Set(K);s.has(t)?s.delete(t):s.add(t),ue(s)},yt=()=>{const t=b.filter(n=>K.has(n.id)),s=t.map(n=>({id:n.id,name:n.name,description:n.description,countryCode:n.countryCode}));navigator.clipboard.writeText(JSON.stringify(s,null,2)),alert(`تم نسخ JSON لـ ${t.length} مستند (المعرف، الاسم، الوصف، وكود البلد).`)},jt=async t=>{var s,n,a;t.preventDefault(),E(!0);try{const c={...f},g=j=>j.replace(/\s{2,}/g," ").replace(/\n/g,"").trim();let h="";je.preview==="code"?h=Ne.preview:V.preview&&(h=V.preview),h&&(c.previewTemplateHtml=z(g(h)),c.previewTemplateUrl="");let x="";if(je.final==="code"?x=Ne.final:V.final&&(x=V.final),x&&(c.finalTemplateHtml=z(g(x)),c.finalTemplateUrl=""),c.finalTemplateHtml&&(c.requiredFields=ke(c.finalTemplateHtml)),c.slug=(s=f.slug)!=null&&s.trim()?be(f.slug):be(f.name||""),v.mode==="create"){const j=((n=f.id)==null?void 0:n.trim())||((a=f.groupId)==null?void 0:a.trim())||c.slug;c.id=j,c.groupId||(c.groupId=j),await Y.create(c)}else v.doc&&await Y.update(v.doc.id,c);await ne(),alert("تم حفظ المستند بنجاح!"),Ve()}catch(c){console.error("Failed to save document:",c),alert("فشل حفظ المستند.")}finally{E(!1)}},Nt=t=>{t.finalTemplateHtml&&(t.finalTemplateHtml=z(t.finalTemplateHtml)),t.previewTemplateHtml&&(t.previewTemplateHtml=z(t.previewTemplateHtml)),Ce(JSON.stringify(t,null,2)),we(!0),pe("skip"),le(null)};return D?e.jsx("div",{className:"flex justify-center items-center p-10",children:e.jsx(Q,{className:"animate-spin text-4xl text-green-600"})}):e.jsxs("div",{children:[Me&&e.jsx(Qt,{isOpen:Me,onClose:()=>Ae(!1),onGenerate:Nt}),e.jsxs("div",{className:"flex flex-col gap-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"إدارة المستندات"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsxs("button",{onClick:()=>Ae(!0),className:"bg-purple-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-purple-700 shadow-sm transition-colors flex items-center",children:[e.jsx(ie,{className:"inline-block ml-2 rtl:ml-0 rtl:mr-2"}),"توليد مستند بالذكاء الاصطناعي"]}),e.jsxs("button",{onClick:mt,className:"bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 shadow-sm transition-colors flex items-center",children:[e.jsx(We,{className:"inline-block ml-2 rtl:ml-0 rtl:mr-2"}),"إضافة/تحديث (JSON)"]}),e.jsxs("button",{onClick:st,className:"bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 shadow-sm transition-colors flex items-center",children:[e.jsx(xe,{className:"inline-block ml-2 rtl:ml-0 rtl:mr-2"}),"إضافة مستند يدويًا"]})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 items-center bg-gray-50 p-4 rounded-lg border",children:[e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx(It,{className:"text-gray-500"}),e.jsx("span",{className:"text-sm font-semibold text-gray-700 whitespace-nowrap",children:"تصفية حسب البلد:"}),e.jsxs("select",{value:C,onChange:et,className:"bg-white border border-gray-300 rounded-md py-2 px-3 text-sm focus:ring-green-500 focus:border-green-500 w-full sm:w-48",children:[e.jsx("option",{value:"all",children:"كل الدول (All)"}),e.jsx("option",{value:"global",children:"عالمي (Global)"}),Xe.en.map(t=>e.jsxs("option",{value:t.code,children:[t.name," (",t.code.toUpperCase(),")"]},t.code))]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto bg-white px-3 py-2 rounded-md border",children:[e.jsx("input",{type:"checkbox",id:"short-desc-filter",checked:T,onChange:t=>M(t.target.checked),className:"h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500"}),e.jsx("label",{htmlFor:"short-desc-filter",className:"text-sm font-semibold text-gray-700 cursor-pointer select-none",children:"المستندات التي تحتوي وصف قصير فقط"})]}),e.jsx("div",{className:"w-full relative",children:e.jsx("input",{type:"text",placeholder:"ابحث بالاسم، المعرف، أو الوصف...",value:J,onChange:t=>ye(t.target.value),className:"w-full p-2 pl-10 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"})})]})]}),K.size>0&&e.jsxs("div",{className:"sticky top-0 z-10 bg-blue-50 border border-blue-200 p-3 mb-4 rounded-lg flex justify-between items-center shadow-sm animate-fadeIn",children:[e.jsxs("span",{className:"font-bold text-blue-800",children:["تم تحديد ",K.size," مستند"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:yt,className:"flex items-center gap-2 bg-white border border-blue-300 text-blue-700 px-3 py-1 rounded hover:bg-blue-100",children:[e.jsx(Ot,{})," نسخ JSON"]}),e.jsx("button",{onClick:()=>ue(new Set),className:"text-gray-500 hover:text-gray-700 px-2",children:"إلغاء التحديد"})]})]}),e.jsx("div",{className:"bg-white p-2 rounded-lg border shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-right",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 w-10",children:e.jsx("input",{type:"checkbox",onChange:ft,checked:b.length>0&&K.size===b.length,className:"w-4 h-4 rounded text-green-600 focus:ring-green-500"})}),e.jsx("th",{className:"p-3 font-semibold text-sm text-gray-600",children:"اسم المستند"}),e.jsx("th",{className:"p-3 font-semibold text-sm text-gray-600",children:"البلد"}),e.jsx("th",{className:"p-3 font-semibold text-sm text-gray-600",children:"ID / Group ID"}),e.jsx("th",{className:"p-3 font-semibold text-sm text-gray-600",children:"الوصف"}),e.jsx("th",{className:"p-3 font-semibold text-sm text-gray-600",children:"إجراءات"})]})}),e.jsx("tbody",{children:b.map(t=>{const s=t.description?t.description.replace(/<[^>]*>?/gm,""):"",n=s.split(/\s+/).filter(g=>g!=="").length,a=!s||s.trim().length===0,c=n<100;return e.jsxs("tr",{className:`border-b hover:bg-gray-50 ${K.has(t.id)?"bg-blue-50":""}`,children:[e.jsx("td",{className:"p-3",children:e.jsx("input",{type:"checkbox",checked:K.has(t.id),onChange:()=>bt(t.id),className:"w-4 h-4 rounded text-green-600 focus:ring-green-500"})}),e.jsx("td",{className:"p-3 text-gray-800 font-semibold",children:t.name}),e.jsx("td",{className:"p-3",children:e.jsx("span",{className:`px-2 py-1 rounded text-xs font-bold ${t.countryCode==="dz"?"bg-green-100 text-green-800":t.countryCode==="global"?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-800"}`,children:t.countryCode?t.countryCode.toUpperCase():"ALL"})}),e.jsxs("td",{className:"p-3 text-gray-500 font-mono text-xs",children:[t.id,e.jsx("br",{}),t.groupId!==t.id&&`(${t.groupId})`]}),e.jsx("td",{className:"p-3 text-gray-600 text-sm",children:a||c?e.jsxs("button",{onClick:()=>at(t),disabled:Je===t.id,className:"text-purple-600 hover:text-purple-800 flex items-center gap-1 bg-purple-50 px-2 py-1 rounded-md text-xs font-bold border border-purple-200",title:"توليد وصف تلقائي بالذكاء الاصطناعي (الوصف الحالي قصير أو مفقود)",children:[Je===t.id?e.jsx(Q,{className:"animate-spin"}):e.jsx(ie,{}),e.jsx("span",{children:"توليد وصف"})]}):e.jsx("div",{className:"prose prose-sm max-w-none line-clamp-2",dangerouslySetInnerHTML:{__html:t.description},title:t.description.replace(/<[^>]*>?/gm,"")})}),e.jsxs("td",{className:"p-3 space-x-4 space-x-reverse whitespace-nowrap",children:[t.slug&&e.jsx("a",{href:`/${t.countryCode||"dz"}/doc/${t.slug}/`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline text-sm font-semibold",children:"معاينة"}),e.jsx("button",{onClick:()=>lt(t),className:"text-green-600 hover:underline text-sm font-semibold",children:"تعديل"}),e.jsx("button",{onClick:()=>Ye(t),className:"text-purple-600 hover:underline text-sm font-semibold",children:"تخصيص (Split)"}),e.jsx("button",{onClick:()=>tt(t.id),className:"text-red-600 hover:underline text-sm font-semibold",children:"حذف"})]})]},t.id)})})]})})}),Ze&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-5xl h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"إضافة / تحديث مستندات (مع المعاينة والنشر)"}),e.jsx("button",{onClick:me,className:"text-gray-500 hover:text-gray-800",children:e.jsx(kt,{size:20})})]}),e.jsx("div",{className:"p-6 flex-grow overflow-y-auto",children:q?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-bold",children:"تقرير المحاكاة (Simulation Report)"}),e.jsxs("span",{className:"text-sm text-gray-500",children:[q.length," عنصر"]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-right text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 border-b",children:"الحالة"}),e.jsx("th",{className:"p-3 border-b",children:"المعرف (ID)"}),e.jsx("th",{className:"p-3 border-b",children:"الاسم"}),e.jsx("th",{className:"p-3 border-b",children:"الملفات المتأثرة"}),e.jsx("th",{className:"p-3 border-b",children:"إجراءات"})]})}),e.jsx("tbody",{children:q.map((t,s)=>e.jsxs("tr",{className:`border-b ${t.status==="New"?"bg-green-50":t.status==="Update"?"bg-yellow-50":t.status==="Skip"?"bg-gray-100 text-gray-500":t.status==="Error"?"bg-red-50":""}`,children:[e.jsxs("td",{className:"p-3 font-bold",children:[t.status==="New"&&e.jsxs("span",{className:"text-green-600 flex items-center gap-1",children:[e.jsx(Ft,{})," جديد"]}),t.status==="Update"&&e.jsxs("span",{className:"text-yellow-600 flex items-center gap-1",children:[e.jsx(Dt,{})," تحديث"]}),t.status==="Skip"&&e.jsxs("span",{className:"text-gray-500 flex items-center gap-1",children:[e.jsx(Ht,{})," تم التخطي"]}),t.status==="Error"&&e.jsxs("span",{className:"text-red-600 flex items-center gap-1",children:[e.jsx(Mt,{})," خطأ"]})]}),e.jsx("td",{className:"p-3 font-mono",children:t.id}),e.jsx("td",{className:"p-3",children:t.name}),e.jsx("td",{className:"p-3 text-xs text-gray-600 dir-ltr text-left",children:t.status!=="Skip"&&t.files.map(n=>e.jsx("div",{children:n},n))}),e.jsx("td",{className:"p-3",children:t.data.finalTemplateHtml&&e.jsxs("button",{onClick:()=>gt(t.data.finalTemplateHtml),className:"text-blue-600 hover:text-blue-800 flex items-center gap-1 text-xs font-bold bg-blue-50 px-2 py-1 rounded border border-blue-200",children:[e.jsx(Oe,{})," معاينة"]})})]},s))})]})})]}):e.jsxs("div",{className:"space-y-4 h-full flex flex-col",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-md text-sm text-blue-800",children:[e.jsx("p",{className:"font-bold",children:"تعليمات:"}),e.jsxs("ul",{className:"list-disc list-inside",children:[e.jsx("li",{children:"ألصق كود JSON لمصفوفة المستندات."}),e.jsx("li",{children:"اختر استراتيجية التعامل مع المستندات الموجودة مسبقاً (تحديث أو تجاهل)."}),e.jsx("li",{children:"سيتم تحليل البيانات ومقارنتها بقاعدة البيانات."}),e.jsxs("li",{children:["بعد التأكيد، سيتم حفظ البيانات ",e.jsx("strong",{children:"ورفع الملفات المذكورة أعلاه إلى GitHub"})," تلقائياً."]})]})]}),e.jsxs("div",{className:"bg-gray-100 p-3 rounded-md border flex gap-4 items-center mb-2",children:[e.jsx("span",{className:"font-bold text-gray-700 text-sm",children:"في حال وجود مستند بنفس ID أو Slug:"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"conflict",value:"skip",checked:Te==="skip",onChange:()=>pe("skip")}),e.jsx("span",{children:"تجاهل (Skip)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"conflict",value:"overwrite",checked:Te==="overwrite",onChange:()=>pe("overwrite")}),e.jsx("span",{children:"تحديث (Overwrite)"})]})]}),e.jsx("textarea",{value:ve,onChange:t=>Ce(t.target.value),className:"flex-grow p-4 font-mono text-sm bg-gray-900 text-green-300 rounded-md",placeholder:'[ { \\"id\\": \\"doc-id\\", \\"name\\": \\"Name\\", \\"description\\": \\"...\\" } ]',dir:"ltr"}),d&&e.jsx("p",{className:"text-red-600 font-bold",children:d})]})}),e.jsx("div",{className:"p-6 border-t bg-gray-50 flex justify-end gap-3",children:q?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>le(null),className:"bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg",children:"عودة للتعديل"}),e.jsxs("button",{onClick:xt,disabled:$,className:"bg-green-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-700 disabled:bg-gray-400 flex items-center gap-2",children:[$?e.jsx(Q,{className:"animate-spin"}):e.jsx(We,{}),e.jsx("span",{children:"تأكيد وتنفيذ النشر"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:me,className:"bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-300",children:"إلغاء"}),e.jsxs("button",{onClick:ht,disabled:Pe||!ve.trim(),className:"bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 flex items-center gap-2",children:[Pe?e.jsx(Q,{className:"animate-spin"}):e.jsx(At,{}),e.jsx("span",{children:"تحليل ومعاينة"})]})]})})]})}),v.isOpen&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-start p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl",children:e.jsxs("form",{onSubmit:jt,children:[e.jsx("div",{className:"p-6 border-b",children:e.jsx("h2",{className:"text-2xl font-bold",children:v.mode==="create"?"إضافة مستند جديد":"تعديل المستند"})}),e.jsxs("div",{className:"p-6 space-y-4 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 mb-1",children:"اسم المستند"}),e.jsx("input",{type:"text",name:"name",id:"name",value:f.name||"",onChange:se,required:!0,className:"w-full p-2 border rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"groupId",className:"block text-sm font-medium text-gray-700 mb-1",children:"معرف المجموعة (Group ID)"}),e.jsx("input",{type:"text",name:"groupId",id:"groupId",value:f.groupId||"",onChange:se,required:!0,className:"w-full p-2 border rounded-md"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"id",className:"block text-sm font-medium text-gray-700 mb-1",children:"المعرف الفريد (ID)"}),e.jsx("input",{type:"text",name:"id",id:"id",value:f.id||"",onChange:se,disabled:v.mode==="edit",className:"w-full p-2 border rounded-md bg-gray-100 disabled:cursor-not-allowed"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"slug",className:"block text-sm font-medium text-gray-700 mb-1",children:"الرابط الدائم (Slug)"}),e.jsx("input",{type:"text",name:"slug",id:"slug",value:f.slug||"",onChange:se,className:"w-full p-2 border rounded-md"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("label",{htmlFor:"description",className:"block text-sm font-medium text-gray-700",children:"الوصف"}),e.jsxs("button",{type:"button",onClick:nt,disabled:Re,className:"flex items-center gap-1 text-xs bg-purple-100 text-purple-700 font-semibold py-1 px-2 rounded-md hover:bg-purple-200 disabled:opacity-50",children:[Re?e.jsx(Q,{className:"animate-spin"}):e.jsx(ie,{}),e.jsx("span",{children:"توليد وصف بالذكاء الاصطناعي"})]})]}),e.jsx(fe,{theme:"snow",value:f.description||"",onChange:t=>G(s=>({...s,description:t}))})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"countryCode",className:"block text-sm font-medium text-gray-700 mb-1",children:"رمز البلد"}),e.jsx("input",{type:"text",name:"countryCode",id:"countryCode",value:f.countryCode||"",onChange:se,className:"w-full p-2 border rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"tags",className:"block text-sm font-medium text-gray-700 mb-1",children:"الوسوم"}),e.jsx("input",{type:"text",name:"tags",id:"tags",value:f.tags||"",onChange:se,className:"w-full p-2 border rounded-md"})]})]}),e.jsx("div",{className:"border-t pt-4",children:e.jsxs("button",{type:"button",onClick:ot,className:"flex items-center gap-2 bg-orange-100 text-orange-700 font-semibold py-2 px-4 rounded-lg hover:bg-orange-200 border border-orange-300",children:[e.jsx(Oe,{})," معاينة القالب"]})})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:Ve,className:"bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-300",children:"إلغاء"}),e.jsx("button",{type:"submit",disabled:$,className:"bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 disabled:bg-gray-400",children:$?"جاري الحفظ...":"حفظ المستند"})]})]})})}),e.jsx(Yt,{isOpen:y.isOpen,fieldId:y.fieldId,onClose:()=>ce({isOpen:!1,fieldId:""}),onSave:pt}),S.isOpen&&S.doc&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-70 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-[95%] h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-center p-4 border-b bg-gray-50 rounded-t-lg",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:["تخصيص المستند: ",S.doc.name]}),e.jsx("p",{className:"text-sm text-gray-500",children:"قم بتعديل بيانات JSON على اليسار، والقالب النهائي HTML على اليمين."})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsxs("div",{className:"flex gap-1 mr-4",children:[e.jsx("button",{onClick:()=>Qe("prev"),className:"p-2 rounded-full hover:bg-gray-200 text-gray-600 transition-colors",title:"المستند السابق",children:e.jsx(Et,{})}),e.jsx("button",{onClick:ut,className:"text-blue-600 p-2 rounded-full hover:bg-blue-100 transition-colors",title:"معاينة في نافذة جديدة",children:e.jsx(Oe,{})}),e.jsx("button",{onClick:()=>Qe("next"),className:"p-2 rounded-full hover:bg-gray-200 text-gray-600 transition-colors",title:"المستند التالي",children:e.jsx(Lt,{})})]}),e.jsx("div",{className:"relative",children:e.jsxs("select",{className:"bg-white border border-gray-300 text-gray-700 py-2 px-3 rounded leading-tight focus:outline-none focus:bg-white focus:border-gray-500",onChange:ct,defaultValue:"",children:[e.jsx("option",{value:"",disabled:!0,children:"إدراج رمز..."}),I.map(t=>e.jsxs("option",{value:t.key,children:[t.description," (",t.key,")"]},t.id))]})}),e.jsxs("button",{onClick:it,disabled:Ee,className:"flex items-center gap-2 bg-purple-100 text-purple-700 border border-purple-300 px-4 py-2 rounded hover:bg-purple-200 transition-colors",children:[Ee?e.jsx(Q,{className:"animate-spin"}):e.jsx(ie,{}),e.jsx("span",{children:"إعادة توليد ذكي"})]}),e.jsx("button",{onClick:rt,className:"bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300 transition-colors",children:"إلغاء"}),e.jsxs("button",{onClick:dt,disabled:$,className:"bg-green-600 text-white px-6 py-2 rounded hover:bg-green-700 transition-colors flex items-center gap-2",children:[$?e.jsx(Q,{className:"animate-spin"}):e.jsx(zt,{}),e.jsx("span",{children:"حفظ التعديلات"})]})]})]}),e.jsxs("div",{className:"flex-grow flex flex-col md:flex-row overflow-hidden",children:[e.jsxs("div",{className:"w-full md:w-1/2 flex flex-col border-b md:border-b-0 md:border-r border-gray-300",children:[e.jsxs("div",{className:"bg-gray-100 p-2 text-xs font-bold text-gray-600 uppercase tracking-wider flex justify-between",children:[e.jsx("span",{children:"JSON Configuration (Metadata & Fields)"}),e.jsx("span",{className:"text-red-500",children:d})]}),e.jsx("textarea",{value:te,onChange:t=>X(t.target.value),className:"flex-grow w-full p-4 font-mono text-sm bg-[#1e1e1e] text-[#d4d4d4] resize-none focus:outline-none",spellCheck:!1,dir:"ltr"})]}),e.jsxs("div",{className:"w-full md:w-1/2 flex flex-col",children:[e.jsx("div",{className:"bg-gray-100 p-2 text-xs font-bold text-gray-600 uppercase tracking-wider",children:"Final HTML Template (Right Side)"}),e.jsx("textarea",{ref:A,value:l,onChange:t=>r(t.target.value),className:"flex-grow w-full p-4 font-mono text-sm bg-white text-gray-800 resize-none focus:outline-none border-l",spellCheck:!1,dir:"ltr",placeholder:"ضع المؤشر هنا ثم اختر رمزاً من القائمة لإدراجه..."})]})]})]})})]})};export{es as default};
