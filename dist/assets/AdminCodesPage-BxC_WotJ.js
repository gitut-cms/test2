import{u as g,r as c,j as e,H as f,aU as N,E as v,G as k,bJ as x}from"./index-DgmZNK3x.js";import{f as w}from"./constants-DfStgaks.js";const q=()=>{const{codes:m,refetchAdminData:u}=g(),[l,n]=c.useState({isOpen:!1,mode:"create",code:null}),[r,d]=c.useState({key:"",description:"",questionText:""}),p=c.useMemo(()=>{const s=Object.entries(w).map(([a,o])=>({id:`const-${a}`,key:`[${a}]`,description:o,isReadOnly:!0})),t=m.map(a=>({...a,isReadOnly:!1})),i=new Set(s.map(a=>a.key)),j=t.filter(a=>!i.has(a.key));return[...s,...j].sort((a,o)=>a.key.localeCompare(o.key))},[m]),h=s=>{s?(d({key:s.key,description:s.description,questionText:s.questionText||""}),n({isOpen:!0,mode:"edit",code:s})):(d({key:"",description:"",questionText:""}),n({isOpen:!0,mode:"create",code:null}))},b=async s=>{s.preventDefault();const t={...r,key:`[${r.key.replace(/\[|\]/g,"")}]`};try{l.mode==="create"?await x.create(t):l.code&&await x.update(l.code.id,t),await u(),n({isOpen:!1,mode:"create",code:null})}catch(i){console.error(i),alert("فشل حفظ الرمز.")}},y=async s=>{window.confirm("هل أنت متأكد؟")&&(await x.delete(s),await u())};return e.jsxs("section",{className:"bg-white p-6 rounded-lg shadow-md border",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"إدارة الرموز (Placeholders)"}),e.jsxs("button",{onClick:()=>h(null),className:"bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700",children:[e.jsx(f,{})," إضافة رمز"]})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"هذه الرموز تستخدم في قوالب المستندات لاستبدال البيانات ديناميكيًا."}),e.jsx("div",{className:"max-h-96 overflow-y-auto pr-2",children:e.jsxs("table",{className:"w-full text-right text-sm",children:[e.jsx("thead",{className:"sticky top-0 bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border-b",children:"الرمز"}),e.jsx("th",{className:"p-2 border-b",children:"الوصف"}),e.jsx("th",{className:"p-2 border-b",children:"إجراءات"})]})}),e.jsx("tbody",{children:p.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"p-2 border-b font-mono text-gray-700",children:s.key}),e.jsx("td",{className:"p-2 border-b text-gray-600",children:s.description}),e.jsx("td",{className:"p-2 border-b",children:s.isReadOnly?e.jsxs("span",{className:"text-xs text-gray-400 flex items-center gap-1",children:[e.jsx(N,{}),"أساسي"]}):e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>h(s),className:"text-blue-600 hover:underline",children:e.jsx(v,{})}),e.jsx("button",{onClick:()=>y(s.id),className:"text-red-600 hover:underline",children:e.jsx(k,{})})]})})]},s.id))})]})}),l.isOpen&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-lg",children:e.jsxs("form",{onSubmit:b,children:[e.jsx("div",{className:"p-6 border-b",children:e.jsx("h2",{className:"text-2xl font-bold",children:l.mode==="create"?"إضافة رمز جديد":"تعديل الرمز"})}),e.jsxs("div",{className:"p-6 space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الرمز (بدون أقواس)"}),e.jsx("input",{type:"text",value:r.key.replace(/\[|\]/g,""),onChange:s=>d(t=>({...t,key:s.target.value})),required:!0,className:"w-full p-2 border rounded-md",dir:"ltr"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"الوصف"}),e.jsx("input",{type:"text",value:r.description,onChange:s=>d(t=>({...t,description:s.target.value})),required:!0,className:"w-full p-2 border rounded-md"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"نص السؤال المخصص (اختياري)"}),e.jsx("input",{type:"text",value:r.questionText||"",onChange:s=>d(t=>({...t,questionText:s.target.value})),className:"w-full p-2 border rounded-md"})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:()=>n({isOpen:!1,mode:"create",code:null}),className:"bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg",children:"إلغاء"}),e.jsx("button",{type:"submit",className:"bg-green-600 text-white font-bold py-2 px-4 rounded-lg",children:"حفظ"})]})]})})})]})};export{q as default};
