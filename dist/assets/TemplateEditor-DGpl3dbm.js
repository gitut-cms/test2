import{r as h,c as v,j as e,l as N,k as C,D as F,I as S,U as k,V as D,W as P,X as A}from"./index-hpjxKmld.js";import{asBlob as E}from"https://esm.sh/html-docx-js-typescript@0.1.5";import z from"https://esm.sh/file-saver@2.0.5";const I=({initialHtml:p,docName:g,onClose:y})=>{const[u,R]=h.useState(p),c=h.useRef(null),{t:a}=v();h.useEffect(()=>{const s=c.current;if(s){const t=s.contentDocument;t&&(t.open(),t.write(u),t.close(),t.body.contentEditable="true",t.body.style.margin="0",t.body.style.padding="0",t.querySelectorAll("a").forEach(n=>{n.onclick=o=>o.preventDefault()}))}},[u]);const r=(s,t)=>{var o;const n=(o=c.current)==null?void 0:o.contentDocument;n&&n.execCommand(s,!1,t)},b=s=>{var o;const t=(o=c.current)==null?void 0:o.contentDocument;if(!t)return;const n=t.getSelection();if(n&&n.rangeCount>0){const i=n.getRangeAt(0).commonAncestorContainer,m=i.nodeType===3?i.parentElement:i;if(m){const x=window.getComputedStyle(m).fontSize,f=parseInt(x)+s;r("fontSize","7");const d=t.getElementsByTagName("font");for(let l=0;l<d.length;l++)d[l].size==="7"&&(d[l].removeAttribute("size"),d[l].style.fontSize=f+"px")}}},j=async()=>{const s=c.current;if(!(!s||!s.contentDocument))try{const t=await html2canvas(s.contentDocument.body,{scale:2,useCORS:!0}),n=t.toDataURL("image/png"),{jsPDF:o}=jspdf,i=new o({orientation:"portrait",unit:"pt",format:"a4"}),m=i.internal.pageSize.getWidth(),x=t.width,f=t.height,d=x/f,l=m/d;i.addImage(n,"PNG",0,0,m,l),i.save(`${g}.pdf`)}catch(t){console.error("PDF Export failed:",t),alert("فشل تصدير PDF")}},w=async()=>{const s=c.current;if(!(!s||!s.contentDocument))try{const n=`<!DOCTYPE html><html lang="ar" dir="rtl"><head><meta charset="UTF-8"></head><body>${s.contentDocument.body.innerHTML}</body></html>`,o=await E(n);z.saveAs(o,`${g}.docx`)}catch(t){console.error("DOCX Export failed:",t),alert("فشل تصدير Word")}};return e.jsxs("div",{className:"fixed inset-0 bg-gray-900 bg-opacity-95 z-[200] flex flex-col overflow-hidden",children:[e.jsxs("header",{className:"bg-white border-b p-4 flex justify-between items-center shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:y,className:"text-gray-500 hover:text-red-600 transition-colors",children:e.jsx(N,{size:24})}),e.jsxs("h2",{className:"text-xl font-bold text-gray-800",children:[a("documentStudioPage.table.edit"),": ",g]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("button",{onClick:j,className:"flex items-center gap-2 bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors font-bold shadow-md",children:[e.jsx(C,{})," ",e.jsx("span",{children:a("adPage.downloadPdf")})]}),e.jsxs("button",{onClick:w,className:"flex items-center gap-2 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors font-bold shadow-md",children:[e.jsx(F,{})," ",e.jsx("span",{children:a("adPage.downloadWord")})]})]})]}),e.jsxs("div",{className:"flex flex-1 overflow-hidden",children:[e.jsxs("aside",{className:"w-72 bg-white border-l shadow-inner p-6 space-y-8 overflow-y-auto",children:[e.jsxs("section",{children:[e.jsx("h3",{className:"text-sm font-bold text-gray-400 uppercase tracking-wider mb-4 border-b pb-2",children:a("documentStudioPage.editor.textFormatting")}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700 mb-2",children:a("documentStudioPage.editor.fontSize")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b(2),className:"flex-1 flex items-center justify-center p-2 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors border shadow-sm",children:e.jsx(S,{})}),e.jsx("button",{onClick:()=>b(-2),className:"flex-1 flex items-center justify-center p-2 bg-gray-100 rounded-md hover:bg-gray-200 transition-colors border shadow-sm",children:e.jsx(k,{})})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700 mb-2",children:a("documentStudioPage.editor.color")}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:["#000000","#FF0000","#0000FF","#008000","#FFA500","#800080","#A52A2A","#808080"].map(s=>e.jsx("button",{onClick:()=>r("foreColor",s),className:"w-full aspect-square rounded-full border border-gray-200 shadow-sm hover:scale-110 transition-transform",style:{backgroundColor:s},"aria-label":`Color ${s}`},s))})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>r("bold"),className:"flex-1 p-2 bg-gray-100 rounded-md hover:bg-gray-200 border shadow-sm font-bold",children:"B"}),e.jsx("button",{onClick:()=>r("italic"),className:"flex-1 p-2 bg-gray-100 rounded-md hover:bg-gray-200 border shadow-sm italic",children:"I"}),e.jsx("button",{onClick:()=>r("underline"),className:"flex-1 p-2 bg-gray-100 rounded-md hover:bg-gray-200 border shadow-sm underline",children:"U"})]})]})]}),e.jsxs("section",{children:[e.jsx("h3",{className:"text-sm font-bold text-gray-400 uppercase tracking-wider mb-4 border-b pb-2",children:a("documentStudioPage.editor.alignment")}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>r("justifyRight"),className:"flex-1 flex items-center justify-center p-2 bg-gray-100 rounded-md hover:bg-gray-200 border shadow-sm",children:e.jsx(D,{})}),e.jsx("button",{onClick:()=>r("justifyCenter"),className:"flex-1 flex items-center justify-center p-2 bg-gray-100 rounded-md hover:bg-gray-200 border shadow-sm",children:e.jsx(P,{})}),e.jsx("button",{onClick:()=>r("justifyLeft"),className:"flex-1 flex items-center justify-center p-2 bg-gray-100 rounded-md hover:bg-gray-200 border shadow-sm",children:e.jsx(A,{})})]})]})]}),e.jsx("main",{className:"flex-1 bg-gray-800 p-10 overflow-auto flex justify-center",children:e.jsx("div",{className:"bg-white shadow-2xl origin-top",style:{width:"210mm",minHeight:"297mm",padding:"20mm"},children:e.jsx("iframe",{ref:c,title:"Editor Canvas",className:"w-full h-full border-none",style:{minHeight:"1000px"}})})})]})]})};export{I as T};
