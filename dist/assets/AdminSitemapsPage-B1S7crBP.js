import{u as k,r as d,j as e,F as T,bs as F,g as z,C as E,bo as D,bp as G}from"./index-DgmZNK3x.js";const M=()=>{const{cafes:C,services:$,blogPosts:v}=k(),[b,w]=d.useState(!1),[S,i]=d.useState(""),[j,f]=d.useState(""),[y,m]=d.useState(!1),h=d.useRef(null);d.useEffect(()=>{const r=l=>{h.current&&!h.current.contains(l.target)&&m(!1)};return document.addEventListener("mousedown",r),()=>document.removeEventListener("mousedown",r)},[]);const x=async r=>{w(!0),f(""),i("");try{const l="https://gitut.com",n=[],u=s=>{let a=`<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
`;return s.forEach(o=>{a+=`  <url><loc>${o}</loc></url>
`}),a+="</urlset>",a},N=r==="global"?E.en.map(s=>s.code):[r];for(const s of N){i(`Generating sitemaps for ${s}...`);const a=new Set;a.add(`${l}/${s}/services/`),$.filter(t=>t.slug&&t.countryCode===s).forEach(t=>{const U=t.serviceType==="site"?"site":"doc";a.add(`${l}/${s}/${U}/${t.slug}/`)}),a.size>0&&n.push({path:`sitemap/${s}/services.xml`,content:u(a)});const c=new Set;c.add(`${l}/${s}/find-cafe/`),C.filter(t=>t.isProfilePublished&&t.numericId&&t.countryCode===s).forEach(t=>{c.add(`${l}/${s}/profile/${t.numericId}`)}),c.size>0&&n.push({path:`sitemap/${s}/profiles.xml`,content:u(c)});const g=new Set,p=D(s),P=p==="ar"?"":`/${p}`;g.add(`${l}/blog${P}/`),v.filter(t=>t.enabled&&t.slug&&t.content&&(t.content[p]||p==="ar"&&Object.keys(t.content).length>0)).forEach(t=>{g.add(`${l}/blog${P}/${t.slug}/`)}),g.size>0&&n.push({path:`sitemap/${s}/blog.xml`,content:u(g)})}if(r==="global"){i("Generating global sitemaps...");const s=new Set;s.add(`${l}/services/`),$.filter(o=>o.slug&&(!o.countryCode||o.countryCode==="global")).forEach(o=>{const c=o.serviceType==="site"?"site":"doc";s.add(`${l}/${c}/${o.slug}/`)}),s.size>0&&n.push({path:"sitemap/services.xml",content:u(s)});const a=new Set;a.add(`${l}/blog/`),v.filter(o=>o.enabled&&o.slug).forEach(o=>{a.add(`${l}/blog/${o.slug}/`)}),a.size>0&&n.push({path:"sitemap/blog.xml",content:u(a)})}if(n.length===0){i("لا توجد بيانات لإنشاء الخرائط.");return}i(`Uploading ${n.length} sitemap files to 'files' repo...`),await G({files:n,commitMessage:`feat: Update sitemaps for ${r} (services, profiles, blog)`,repoConfig:{owner:"gitut-cms",repo:"files"}}),i(`Successfully published ${n.length} sitemap files!`)}catch(l){console.error("Sitemap publishing failed:",l);const n=l instanceof Error?l.message:"An unknown error occurred.";f(`فشل في نشر ملفات Sitemap: ${n}`)}finally{w(!1),setTimeout(()=>{i(""),f("")},8e3)}};return e.jsxs("section",{className:"bg-white p-6 rounded-lg shadow-md border",children:[e.jsx("h2",{className:"text-xl font-bold mb-4",children:"إدارة خرائط الموقع (Sitemaps)"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["تحديث خرائط الموقع يساعد محركات البحث (Google, Bing) على أرشفة الصفحات الجديدة. سيتم إنشاء ملفات ",e.jsx("code",{children:"services.xml"}),", ",e.jsx("code",{children:"profiles.xml"}),", و ",e.jsx("code",{children:"blog.xml"})," لكل بلد في المجلد ",e.jsx("code",{children:"sitemap/countryCode/"}),"."]}),e.jsxs("div",{className:"relative",ref:h,children:[e.jsxs("div",{className:"flex w-full",children:[e.jsxs("button",{onClick:()=>x("global"),disabled:b,className:"bg-blue-500 text-white font-bold p-4 rounded-r-lg hover:bg-blue-600 disabled:bg-gray-400 flex-grow flex items-center justify-center gap-2",children:[b?e.jsx(T,{className:"animate-spin"}):e.jsx(F,{}),e.jsx("span",{children:"نشر الكل (تحديث شامل)"})]}),e.jsx("button",{onClick:()=>m(!y),disabled:b,className:"bg-blue-600 text-white font-bold px-4 rounded-l-lg hover:bg-blue-700 disabled:bg-gray-500 border-r border-blue-400",children:e.jsx(z,{})})]}),y&&e.jsxs("div",{className:"absolute left-0 mt-1 w-full bg-white rounded-md shadow-lg border z-10 max-h-60 overflow-y-auto",children:[e.jsx("button",{onClick:()=>{m(!1),x("global")},className:"block w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-gray-100 font-bold border-b",children:"Global (عالمي + كل البلدان)"}),E.en.map(r=>e.jsxs("button",{onClick:()=>{m(!1),x(r.code)},className:"block w-full text-left px-4 py-3 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[e.jsx("span",{children:r.flag})," ",r.name]},r.code))]})]}),S&&e.jsx("p",{className:"text-center mt-2 text-sm text-blue-600",children:S}),j&&e.jsx("p",{className:"text-center mt-2 text-sm text-red-600",children:j})]})};export{M as default};
