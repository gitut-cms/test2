import{u as de,r as c,j as e,br as ce,C as Q,L as xe,l as ge,_ as ue,F as v,a6 as me,bs as _,aY as he,bt as h,bo as M,bm as q,bp as W,bu as be}from"./index-DgmZNK3x.js";import{d as pe}from"./geminiService-CD7J7Ty3.js";import{R as w}from"./index-ChkOn_r6.js";import{g as Y,c as K}from"./staticHtmlGenerator-DCfPfK21.js";if(w.Quill){const x=w.Quill.import("attributors/style/size");x.whitelist=["8px","9px","10px","11px","12px","14px","16px","18px","20px","22px","24px","28px","36px","48px","72px"],w.Quill.register("attributors/style/size",x,!0)}const V=x=>x.toLowerCase().trim().replace(/\s+/g,"-").replace(/[^a-z0-9\u0600-\u06FF-]/g,""),ve=()=>{const{pages:x,refetchAdminData:j,siteSettings:$,blogPosts:I}=de(),[g,C]=c.useState({isOpen:!1,mode:"create",page:null}),[n,u]=c.useState({title:"",content:"",targetCountry:"global"}),[E,A]=c.useState(!1),[U,G]=c.useState(!1),[X,m]=c.useState(""),[Z,N]=c.useState(!1),[S,z]=c.useState(""),[P,B]=c.useState(!1),[H,k]=c.useState(""),[b,T]=c.useState(null),[L,D]=c.useState(!1),[F,R]=c.useState("skip"),ee=()=>{u({title:"",content:"",targetCountry:"global"}),C({isOpen:!0,mode:"create",page:null}),m("")},te=t=>{u({title:t.title,content:t.content,targetCountry:t.targetCountry||t.lang||"global"}),C({isOpen:!0,mode:"edit",page:t}),m("")},J=()=>{C({isOpen:!1,mode:"create",page:null})},se=async()=>{var t;if(!n.title.trim()){alert("يرجى إدخال عنوان للصفحة أولاً.");return}A(!0);try{const a=n.targetCountry==="global"?"dz":n.targetCountry,s=M(a),o=((t=be.find(r=>r.code===s))==null?void 0:t.name)||"Arabic",l=`
            Act as a professional web content writer.
            Write comprehensive, detailed, and high-quality content for a static webpage titled: "${n.title}".
            
            IMPORTANT RULES:
            1. The content MUST be written in ${o} language.
            2. If a specific country is selected (Country Code: ${n.targetCountry}), ensure the content is culturally and contextually relevant to that country.
            3. **Do NOT start with a Heading (H1, H2, etc.). Start directly with a substantial introductory paragraph (<p>).**
            4. Use <h2> and <h3> tags for subsequent sections to structure the content.
            5. Use <ul> or <ol> lists where appropriate.
            6. The content MUST be concise and strictly NOT exceed 20 lines of text.
            7. Do NOT include <html>, <head>, or <body> tags, just the inner HTML for the body content.
            `;u(r=>({...r,content:""}));let d=(await pe({model:"gemini-2.5-flash",contents:l})).text||"";d=d.replace(/```html/g,"").replace(/```/g,"").trim(),u(r=>({...r,content:d}))}catch(a){console.error("AI content generation failed:",a),alert("فشل إنشاء المحتوى. يرجى التحقق من وحدة التحكم لمزيد من التفاصيل.")}finally{A(!1)}},ae=async t=>{t.preventDefault(),G(!0),m("جاري الحفظ في قاعدة البيانات...");const a=V(n.title);let s="ar";n.targetCountry!=="global"&&(s=M(n.targetCountry));const o={...n,slug:a,lang:s};try{let l;if(g.mode==="create")try{l=await h.create({...o,enabled:!0})}catch(p){if(p.message&&p.message.includes("UNIQUE constraint failed")){const O=`${a}-${Math.floor(Math.random()*1e5)}`;l=await h.create({...o,slug:O,enabled:!0})}else throw p}else if(g.page)await h.update(g.page.id,{...o,slug:a}),l={...g.page,...o,slug:a};else throw new Error("Invalid state");m("جاري إنشاء ملف HTML ورفعه إلى GitHub...");const i=$||q,d=[...x];if(g.mode==="create")d.push(l);else{const p=d.findIndex(O=>O.id===l.id);p>-1&&(d[p]=l)}const r=Y(l,n.targetCountry,i,d,I),f=l.slug,y=n.targetCountry==="global"?`dist/page/${f}/index.html`:`dist/${n.targetCountry}/page/${f}/index.html`;await W({files:[{path:y,content:K(r)}],commitMessage:`feat: Update static page ${f} (${n.targetCountry})`}),m("تم الحفظ والنشر بنجاح!"),await j(),setTimeout(()=>{J(),m("")},1500)}catch(l){console.error("Failed to save page:",l),m(""),alert(`فشل الحفظ: ${l.message||"حدث خطأ غير معروف"}`)}finally{G(!1)}},le=()=>{z(`[
  
]`),k(""),T(null),N(!0)},ne=()=>{k(""),D(!0);try{const t=JSON.parse(S);if(!Array.isArray(t))throw new Error("JSON must be an array.");const a=t.map((s,o)=>{if(!s.title||!s.content)return{status:"Error",title:"Invalid Item",slug:"",country:"",files:[],data:s,error:"Missing title or content"};const l=s.slug||V(s.title),i=s.targetCountry||"global",r=x.find(y=>y.slug===l&&(y.targetCountry||y.lang||"global")===i)?F==="overwrite"?"Update":"Skip":"New",f=i==="global"?`dist/page/${l}/index.html`:`dist/${i}/page/${l}/index.html`;return{status:r,title:s.title,slug:l,country:i,files:[f],data:{...s,slug:l,enabled:s.enabled??!0,targetCountry:i,lang:i==="global"?"ar":M(i)}}});T(a)}catch(t){k(t.message)}finally{D(!1)}},re=async()=>{if(b){B(!0);try{const t=[],a=$||q;for(const s of b){if(s.status==="Error"||s.status==="Skip")continue;let o;if(s.status==="New")o=await h.create(s.data);else{const d=x.find(r=>r.slug===s.slug&&(r.targetCountry||r.lang||"global")===s.country);await h.update(d.id,s.data),o={...d,...s.data}}const l=[...x,o],i=Y(o,s.country,a,l,I);t.push({path:s.files[0],content:K(i)})}t.length>0&&await W({files:t,commitMessage:`feat: Bulk update static pages (${t.length})`}),alert(`تمت معالجة ${t.length} صفحة بنجاح.`),N(!1),await j()}catch(t){alert(`خطأ: ${t.message}`)}finally{B(!1)}}},oe=async t=>{window.confirm("هل أنت متأكد من حذف هذه الصفحة؟")&&(await h.delete(t),await j())},ie=async t=>{const a=x.find(s=>s.id===t);a&&(await h.toggleStatus(t,a.enabled),await j())};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"إدارة الصفحات"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:le,className:"bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(ce,{}),e.jsx("span",{children:"إضافة صفحات (JSON)"})]}),e.jsx("button",{onClick:ee,className:"bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 transition-colors",children:"+ إنشاء صفحة جديدة"})]})]}),e.jsx("div",{className:"bg-white p-2 rounded-lg border shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-right",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 font-semibold text-sm text-gray-600",children:"العنوان"}),e.jsx("th",{className:"p-3 font-semibold text-sm text-gray-600",children:"البلد المستهدف"}),e.jsx("th",{className:"p-3 font-semibold text-sm text-gray-600",children:"الحالة"}),e.jsx("th",{className:"p-3 font-semibold text-sm text-gray-600",children:"إجراءات"})]})}),e.jsx("tbody",{children:x.map(t=>{var a;return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 text-gray-800 font-semibold",children:t.title}),e.jsx("td",{className:"p-3 text-gray-600 text-sm",children:t.targetCountry==="global"?"عالمي (Global)":((a=Q.en.find(s=>s.code===t.targetCountry))==null?void 0:a.name)||t.targetCountry||"عالمي"}),e.jsx("td",{className:"p-3",children:e.jsx("button",{onClick:()=>ie(t.id),className:`px-3 py-1 text-xs font-semibold rounded-full ${t.enabled?"text-green-800 bg-green-200":"text-red-800 bg-red-200"}`,children:t.enabled?"مُمَكَّن":"معطَّل"})}),e.jsxs("td",{className:"p-3 space-x-4 space-x-reverse",children:[e.jsx(xe,{to:`/${t.targetCountry==="global"?"dz":t.targetCountry}/page/${t.slug}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline text-sm font-semibold",children:"معاينة"}),e.jsx("button",{onClick:()=>te(t),className:"text-green-600 hover:underline text-sm font-semibold",children:"تعديل"}),e.jsx("button",{onClick:()=>oe(t.id),className:"text-red-600 hover:underline text-sm font-semibold",children:"حذف"})]})]},t.id)})})]})})}),Z&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-4xl h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"إضافة صفحات (JSON)"}),e.jsx("button",{onClick:()=>N(!1),className:"text-gray-500 hover:text-gray-800",children:e.jsx(ge,{size:20})})]}),e.jsx("div",{className:"p-6 flex-grow overflow-y-auto",children:b?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-bold",children:["تقرير المحاكاة (",b.length," عنصر)"]}),e.jsx("div",{className:"border rounded-lg overflow-hidden",children:e.jsxs("table",{className:"w-full text-sm text-right",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 border-b",children:"الحالة"}),e.jsx("th",{className:"p-3 border-b",children:"العنوان"}),e.jsx("th",{className:"p-3 border-b",children:"البلد"}),e.jsx("th",{className:"p-3 border-b",children:"الملفات المستهدفة"})]})}),e.jsx("tbody",{children:b.map((t,a)=>e.jsxs("tr",{className:`border-b ${t.status==="New"?"bg-green-50":t.status==="Update"?"bg-yellow-50":t.status==="Skip"?"bg-gray-100 text-gray-500":"bg-red-50"}`,children:[e.jsx("td",{className:"p-3 font-bold",children:t.status}),e.jsx("td",{className:"p-3",children:t.title}),e.jsx("td",{className:"p-3",children:t.country}),e.jsxs("td",{className:"p-3 text-xs text-gray-600 dir-ltr text-left",children:[t.files.map(s=>e.jsx("div",{children:s},s)),t.error&&e.jsx("div",{className:"text-red-600 font-bold",children:t.error})]})]},a))})]})}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-md border border-yellow-200 text-yellow-800 flex items-start gap-3",children:[e.jsx(ue,{className:"mt-1"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold",children:"تحذير:"}),e.jsx("p",{children:'عند الضغط على "تأكيد وتنفيذ"، سيتم تحديث قاعدة البيانات ورفع صفحات HTML إلى GitHub فوراً.'})]})]})]}):e.jsxs("div",{className:"space-y-4 h-full flex flex-col",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-md text-sm text-blue-800",children:[e.jsx("p",{className:"font-bold",children:"تعليمات:"}),e.jsx("ul",{className:"list-disc list-inside",children:e.jsxs("li",{children:["ألصق كود JSON لمصفوفة الصفحات. الحقول المطلوبة: ",e.jsx("code",{children:"title"}),", ",e.jsx("code",{children:"content"}),". الاختيارية: ",e.jsx("code",{children:"targetCountry"}),", ",e.jsx("code",{children:"slug"}),"."]})})]}),e.jsxs("div",{className:"bg-gray-100 p-3 rounded-md border flex gap-4 items-center mb-2",children:[e.jsx("span",{className:"font-bold text-gray-700 text-sm",children:"في حال وجود صفحة بنفس Slug:"}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"conflict",value:"skip",checked:F==="skip",onChange:()=>R("skip")}),e.jsx("span",{children:"تجاهل (Skip)"})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"radio",name:"conflict",value:"overwrite",checked:F==="overwrite",onChange:()=>R("overwrite")}),e.jsx("span",{children:"تحديث (Overwrite)"})]})]}),e.jsx("textarea",{value:S,onChange:t=>z(t.target.value),className:"flex-grow p-4 font-mono text-sm bg-gray-900 text-green-300 rounded-md",placeholder:'[ { "title": "...", "content": "..." } ]',dir:"ltr"}),H&&e.jsx("p",{className:"text-red-600 font-bold",children:H})]})}),e.jsx("div",{className:"p-6 border-t bg-gray-50 flex justify-end gap-3",children:b?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>T(null),className:"bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg",children:"عودة للتعديل"}),e.jsxs("button",{onClick:re,disabled:P,className:"bg-green-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-700 disabled:bg-gray-400 flex items-center gap-2",children:[P?e.jsx(v,{className:"animate-spin"}):e.jsx(_,{}),e.jsx("span",{children:"تأكيد وتنفيذ النشر"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>N(!1),className:"bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-300",children:"إلغاء"}),e.jsxs("button",{onClick:ne,disabled:L||!S.trim(),className:"bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 flex items-center gap-2",children:[L?e.jsx(v,{className:"animate-spin"}):e.jsx(me,{}),e.jsx("span",{children:"تحليل ومعاينة"})]})]})})]})}),g.isOpen&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-3xl",children:e.jsxs("form",{onSubmit:ae,children:[e.jsx("div",{className:"p-6 border-b",children:e.jsx("h2",{className:"text-2xl font-bold",children:g.mode==="create"?"إنشاء صفحة جديدة":"تعديل الصفحة"})}),e.jsxs("div",{className:"p-6 space-y-4 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-1",children:"عنوان الصفحة"}),e.jsx("div",{className:"flex gap-2 items-center",children:e.jsx("input",{type:"text",id:"title",value:n.title,onChange:t=>u(a=>({...a,title:t.target.value})),required:!0,className:"block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500"})})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"targetCountry",className:"block text-sm font-medium text-gray-700 mb-1",children:"البلد المستهدف"}),e.jsxs("select",{id:"targetCountry",value:n.targetCountry,onChange:t=>u(a=>({...a,targetCountry:t.target.value})),className:"block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500",children:[e.jsx("option",{value:"global",children:"عالمي (Global)"}),Q.en.map(t=>e.jsxs("option",{value:t.code,children:[t.flag," ",t.name]},t.code))]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-700 mb-1",children:"المحتوى"}),e.jsx("div",{className:"mb-2 flex justify-end",children:e.jsxs("button",{type:"button",onClick:se,disabled:E,className:"flex items-center gap-2 px-3 py-2 bg-purple-100 text-purple-700 font-semibold rounded-md hover:bg-purple-200 disabled:opacity-50 text-sm",children:[E?e.jsx(v,{className:"animate-spin"}):e.jsx(he,{}),e.jsx("span",{children:"توليد محتوى بالذكاء الاصطناعي"})]})}),e.jsx(w,{theme:"snow",value:n.content,onChange:t=>u(a=>({...a,content:t})),modules:{toolbar:[[{size:["8px","9px","10px","11px","12px","14px","16px","18px","20px","22px","24px","28px","36px","48px","72px",!1]}],["bold","italic","underline","strike","blockquote"],[{list:"ordered"},{list:"bullet"},{indent:"-1"},{indent:"+1"}],[{direction:"rtl"},{align:[]}],["link","image","video"],["clean"]]}})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 flex justify-between items-center gap-3",children:[e.jsx("span",{className:"text-sm text-green-600 font-semibold",children:X}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{type:"button",onClick:J,className:"bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-300",children:"إلغاء"}),e.jsxs("button",{type:"submit",disabled:U,className:"bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 flex items-center gap-2",children:[U?e.jsx(v,{className:"animate-spin"}):e.jsx(_,{}),e.jsx("span",{children:"حفظ ونشر"})]})]})]})]})})})]})};export{ve as default};
