import{u as J,r,j as t,B as U,F as z,bs as q,g as K,C as S,bH as M,bp as O,bm as H}from"./index-hpjxKmld.js";import{i as L,c as N,g as u}from"./staticHtmlGenerator-D8IoKVrH.js";import{F as Z}from"./FileSaver.min-Bnm0McdU.js";const X=()=>{const{pages:d,siteSettings:b,blogPosts:m,ads:f}=J(),[h,v]=r.useState(!1),[D,p]=r.useState(""),[x,$]=r.useState(!1),[w,k]=r.useState(!1),[E,T]=r.useState(!1),[I,c]=r.useState(""),[A,G]=r.useState(!1),y=r.useRef(null);r.useEffect(()=>{const e=a=>{y.current&&!y.current.contains(a.target)&&G(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const R=async()=>{var e,a;try{const[n,o]=await Promise.all([fetch("https://datas.gitut.com/data/json/site-settings-public.json?t="+Date.now()),fetch("https://datas.gitut.com/data/json/site-seo.json?t="+Date.now())]);if(!n.ok)throw new Error("Failed to fetch public settings");const s=await n.json(),l=o.ok?await o.json():{},g={...H,...b,...s,seo:{...H.seo,...l},ads:{...H.ads,...s.ads||{},items:((e=s.ads)==null?void 0:e.items)||[]}},i=((a=s.ads)==null?void 0:a.items)||[];return{settings:g,ads:i}}catch(n){return console.warn("Could not fetch public settings for generation, falling back to context data.",n),{settings:b,ads:f}}},j=async e=>{v(!0),p(e?`بدء إنشاء الصفحات الثابتة لـ: ${e}`:"بدء إنشاء الصفحات الثابتة للكل...");try{const{settings:a,ads:n}=await R(),o=[];for(const s of d)if(s.enabled&&s.slug){const l=s.targetCountry||s.lang||"global";if(e==="global"&&l==="global"){const g=u(s,"dz",a,d,m,n),i=`dist/page/${s.slug}/index.html`;o.push({path:i,content:N(g)})}else if(e&&e!=="global"&&l===e){const g=u(s,e,a,d,m,n),i=`dist/${e}/page/${s.slug}/index.html`;o.push({path:i,content:N(g)})}}o.length===0?p("لا توجد صفحات مفعلة للنشر تتطابق مع المعايير."):(p(`رفع ${o.length} صفحة إلى GitHub...`),await O({files:o,commitMessage:`feat: Regenerate static site pages${e?` for ${e}`:""}`}),p(`تم نشر ${o.length} صفحة بنجاح!`))}catch(a){console.error(a);const n=a instanceof Error?a.message:String(a);p(`فشل: ${n}`)}finally{v(!1),setTimeout(()=>p(""),8e3)}},_=async()=>{var e,a,n,o,s;$(!0);try{const l=new M;for(const i of d)if(i.enabled&&i.slug){const P=i.targetCountry||"global";if(P==="global"){const C=u(i,"dz",b,d,m,f);(a=(e=l.folder("page"))==null?void 0:e.folder(i.slug))==null||a.file("index.html",C)}else{const C=u(i,P,b,d,m,f);(s=(o=(n=l.folder(P))==null?void 0:n.folder("page"))==null?void 0:o.folder(i.slug))==null||s.file("index.html",C)}}const g=await l.generateAsync({type:"blob"});Z.saveAs(g,"gitut-static-pages.zip")}catch(l){console.error(l)}finally{$(!1)}},F=async()=>{k(!0),c("Generating homepage files...");try{const{settings:e}=await R(),a=[],o=[null,...S.en.map(s=>s.code)];for(const s of o){const l=L(s,e,d,m),g=s?`dist/${s}/index.html`:"dist/index.html";a.push({path:g,content:N(l)})}c(`Uploading ${a.length} files to GitHub...`),await O({files:a,commitMessage:"feat: Regenerate static homepages"}),c(`Successfully published ${a.length} homepages!`)}catch(e){console.error("Homepage publishing failed:",e),c(`فشل: ${e.message}`)}finally{k(!1),setTimeout(()=>c(""),8e3)}},B=async()=>{T(!0),c("");try{const e=new M,n=[null,...S.en.map(s=>s.code)];for(const s of n){const l=L(s,b,d,m),g=s?`${s}/index.html`:"index.html";e.file(g,l)}const o=await e.generateAsync({type:"blob"});Z.saveAs(o,"gitut-homepages.zip")}catch(e){console.error("Homepage download failed:",e),c(`فشل: ${e.message}`)}finally{T(!1)}};return t.jsxs("section",{className:"bg-white p-6 rounded-lg shadow-md border",children:[t.jsx("h2",{className:"text-xl font-bold mb-4",children:"إدارة الصفحات الثابتة والصفحة الرئيسية"}),t.jsxs("div",{className:"space-y-3",children:[t.jsxs("div",{className:"flex gap-2 p-3 bg-gray-50 rounded-md items-center",children:[t.jsx("span",{className:"font-semibold text-gray-700 flex-1",children:"الصفحات الرئيسية"}),t.jsx("button",{onClick:B,disabled:w||E,title:"تنزيل ZIP",className:"bg-gray-600 text-white font-bold p-3 rounded-lg hover:bg-gray-700 disabled:bg-gray-400",children:t.jsx(U,{})}),t.jsx("button",{onClick:F,disabled:w||E,className:"bg-green-600 text-white font-bold p-3 rounded-lg hover:bg-green-700 disabled:bg-gray-400",children:w?t.jsx(z,{className:"animate-spin"}):"نشر"})]}),I&&t.jsx("p",{className:"text-blue-600 text-sm mt-1 text-center",children:I}),t.jsxs("div",{className:"flex gap-2 p-3 bg-gray-50 rounded-md items-center",children:[t.jsx("span",{className:"font-semibold text-gray-700 flex-1",children:"الصفحات الثابتة (مثل: حول الموقع)"}),t.jsx("button",{onClick:_,disabled:h||x,title:"تنزيل ZIP",className:"bg-gray-600 text-white font-bold p-3 rounded-lg hover:bg-gray-700 disabled:bg-gray-400",children:t.jsx(U,{})}),t.jsxs("div",{className:"relative",ref:y,children:[t.jsxs("div",{className:"flex",children:[t.jsxs("button",{onClick:()=>j("global"),disabled:h||x,className:"bg-green-600 text-white font-bold p-3 rounded-r-lg hover:bg-green-700 disabled:bg-gray-400 flex items-center gap-2",children:[h?t.jsx(z,{className:"animate-spin"}):t.jsx(q,{}),t.jsx("span",{children:"Global"})]}),t.jsx("button",{onClick:()=>G(!A),disabled:h||x,className:"bg-green-700 text-white font-bold p-3 rounded-l-lg hover:bg-green-800 disabled:bg-gray-500 border-r border-green-500",children:t.jsx(K,{})})]}),A&&t.jsxs("div",{className:"absolute left-0 mt-1 w-48 bg-white rounded-md shadow-lg border z-10 max-h-60 overflow-y-auto",children:[t.jsx("button",{onClick:()=>j("global"),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 font-bold border-b",children:"Global (عالمي)"}),S.en.map(e=>t.jsxs("button",{onClick:()=>j(e.code),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[t.jsx("span",{children:e.flag})," ",e.name]},e.code))]})]})]}),D&&t.jsx("p",{className:"text-blue-600 text-sm mt-1 text-center",children:D})]})]})};export{X as default};
