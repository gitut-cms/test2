import{u as O,r as m,j as o,B as U,F as L,bs as z,g as M,C as v,bG as _,bo as T,bp as Z,bm as C}from"./index-DgmZNK3x.js";import{a as $,b as F,c as H}from"./staticHtmlGenerator-DCfPfK21.js";import{F as J}from"./FileSaver.min-B2YBWmij.js";const V=()=>{const{blogPosts:g,siteSettings:x,pages:p,ads:S}=O(),[w,N]=m.useState(!1),[E,f]=m.useState(""),[j,B]=m.useState(!1),[D,k]=m.useState(!1),y=m.useRef(null);m.useEffect(()=>{const e=a=>{y.current&&!y.current.contains(a.target)&&k(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const I=async()=>{var e,a;try{const[r,l]=await Promise.all([fetch("https://datas.gitut.com/data/json/site-settings-public.json?t="+Date.now()),fetch("https://datas.gitut.com/data/json/site-seo.json?t="+Date.now())]);if(!r.ok)throw new Error("Failed to fetch public settings");const i=await r.json(),n=l.ok?await l.json():{},d={...C,...x,...i,seo:{...C.seo,...n},ads:{...C.ads,...i.ads||{},items:((e=i.ads)==null?void 0:e.items)||[]}},t=((a=i.ads)==null?void 0:a.items)||[];return{settings:d,ads:t}}catch(r){return console.warn("Could not fetch public settings, falling back to context.",r),{settings:x,ads:S}}},P=async e=>{N(!0),f(e?`بدء إنشاء صفحات المدونة لـ: ${e}`:"بدء إنشاء صفحات المدونة للكل...");try{const{settings:a,ads:r}=await I(),l=[],i=[];e?i.push(e):(i.push("global"),v.en.forEach(n=>i.push(n.code)));for(const n of i){const d=g.filter(s=>s.enabled&&s.slug&&(n==="global"?!s.countryCode||s.countryCode==="global":s.countryCode===n));if(d.length===0)continue;const t=n==="global"?"ar":T(n),u=n==="global"?"":n;for(const s of d)if(s.content&&(s.content[t]||t==="ar"&&Object.values(s.content).length>0)){const h=$(s,g,a,t,r,p,g,u),b=n==="global"?`dist/blog/${s.slug}/index.html`:`dist/${n}/blog/${s.slug}/index.html`;l.push({path:b,content:H(h)})}if(d.length>0){const s=F(d,a,t,p,g,u),h=n==="global"?"dist/blog/index.html":`dist/${n}/blog/index.html`;l.push({path:h,content:H(s)})}}l.length===0?f("لا توجد مقالات مفعلة للنشر تطابق الفلتر المحدد."):(f(`رفع ${l.length} ملفًا إلى GitHub...`),await Z({files:l,commitMessage:`feat: Regenerate static blog pages${e?` for ${e}`:""}`}),f(`تم نشر ${l.length} صفحة مدونة بنجاح!`))}catch(a){console.error(a);const r=a instanceof Error?a.message:String(a);f(`فشل: ${r}`)}finally{N(!1),setTimeout(()=>f(""),8e3)}},R=async()=>{var e,a,r;B(!0);try{const l=new _,i=l.folder("blog");if(!i)throw new Error("Could not create zip folder");const n=["global",...v.en.map(t=>t.code)];for(const t of n){const u=g.filter(c=>c.enabled&&c.slug&&(t==="global"?!c.countryCode||c.countryCode==="global":c.countryCode===t));if(u.length===0)continue;const s=t==="global"?"ar":T(t),h=t==="global"?"":t;let b=t==="global"?i:(e=l.folder(t))==null?void 0:e.folder("blog");if(!b&&t!=="global"&&(b=(a=l.folder(t))==null?void 0:a.folder("blog")),!b)continue;for(const c of u)if(c.content&&(c.content[s]||s==="ar"&&Object.values(c.content).length>0)){const G=$(c,g,x,s,S,p,g,h);(r=b.folder(c.slug))==null||r.file("index.html",G)}const A=F(u,x,s,p,g,h);b.file("index.html",A)}const d=await l.generateAsync({type:"blob"});J.saveAs(d,"gitut-blog-pages.zip")}catch(l){console.error(l)}finally{B(!1)}};return o.jsxs("section",{className:"bg-white p-6 rounded-lg shadow-md border",children:[o.jsx("h2",{className:"text-xl font-bold mb-4",children:"إدارة صفحات المدونة (Static)"}),o.jsxs("div",{className:"flex gap-2 p-3 bg-gray-50 rounded-md items-center",children:[o.jsx("span",{className:"font-semibold text-gray-700 flex-1",children:"صفحات المدونة"}),o.jsx("button",{onClick:R,disabled:w||j,title:"تنزيل ZIP",className:"bg-gray-600 text-white font-bold p-3 rounded-lg hover:bg-gray-700 disabled:bg-gray-400",children:o.jsx(U,{})}),o.jsxs("div",{className:"relative",ref:y,children:[o.jsxs("div",{className:"flex",children:[o.jsxs("button",{onClick:()=>P(),disabled:w||j,className:"bg-green-600 text-white font-bold p-3 rounded-r-lg hover:bg-green-700 disabled:bg-gray-400 flex items-center gap-2",children:[w?o.jsx(L,{className:"animate-spin"}):o.jsx(z,{}),o.jsx("span",{children:"نشر الكل"})]}),o.jsx("button",{onClick:()=>k(!D),disabled:w||j,className:"bg-green-700 text-white font-bold p-3 rounded-l-lg hover:bg-green-800 disabled:bg-gray-500 border-r border-green-500",children:o.jsx(M,{})})]}),D&&o.jsxs("div",{className:"absolute left-0 mt-1 w-48 bg-white rounded-md shadow-lg border z-10 max-h-60 overflow-y-auto",children:[o.jsx("button",{onClick:()=>P("global"),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 font-bold border-b",children:"Global (الكل)"}),v.en.map(e=>o.jsxs("button",{onClick:()=>P(e.code),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[o.jsx("span",{children:e.flag})," ",e.name]},e.code))]})]})]}),E&&o.jsx("p",{className:"text-blue-600 text-sm mt-2 text-center",children:E})]})};export{V as default};
