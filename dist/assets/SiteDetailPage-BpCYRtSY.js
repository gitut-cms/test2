import{b as F,a as B,u as P,c as R,o as k,r as u,C as M,j as e,F as O,L as U,d as C,m as z,I as q}from"./index-DgmZNK3x.js";import{B as G}from"./BlogPostCard-DY9fhmSZ.js";import{S as H}from"./SocialShareButtons-BKLyRpAE.js";import{A as _}from"./AdBanner-BHXyFlzY.js";const n=(a,d,g=!0)=>{const f=g?`meta[property='${a}']`:`meta[name='${a}']`;let i=document.querySelector(f);i||(i=document.createElement("meta"),i.setAttribute(g?"property":"name",a),document.head.appendChild(i)),i.setAttribute("content",d)},N=a=>a?a.replace(/[أإآ]/g,"ا").replace(/ة/g,"ه").toLowerCase():"",W=()=>{const{countryCode:a,slug:d}=F(),g=B(),{sites:f,blogPosts:i,siteSettings:x,loading:S}=P(),{language:c,t:I}=R(),{user:E}=k(),[t,v]=u.useState(null),[$,h]=u.useState(!0);u.useEffect(()=>{var l,s,r,o;if(t&&x){const m=((l=x.seo)==null?void 0:l[a||"dz"])||((s=x.seo)==null?void 0:s.default),p=((o=(r=M[c])==null?void 0:r.find(D=>D.code===a))==null?void 0:o.name)||a,b=`استخراج ${t.name} في ${p} ${m.titleSeparator} ${m.siteName}`,j=t.description?t.description.replace(/<[^>]*>/g,""):"",w=j?j.substring(0,160)+(j.length>160?"...":""):m.metaDescription,y="https://datas.gitut.com/data/image/gitut-og-main.png",T=c==="ar"?"ar_AR":c==="fr"?"fr_FR":"en_US";document.title=b,n("description",w,!1),n("og:title",b),n("og:description",w),n("og:image",y),n("og:image:secure_url",y),n("og:image:width","1200"),n("og:image:height","630"),n("og:url",window.location.href),n("og:type","website"),n("og:site_name",m.siteName),n("og:locale",T),n("twitter:card","summary_large_image",!1),n("twitter:url",window.location.href,!1),n("twitter:title",b,!1),n("twitter:description",w,!1),n("twitter:image",y,!1)}},[t,x,a,c]),u.useEffect(()=>{(async()=>{if(!d){h(!1);return}if(S)return;h(!0);let s=null;const r=f.find(o=>o.slug===d);if(r)s=r;else try{s=await q(d)}catch(o){console.error("Failed to fetch site by slug:",o)}s&&s.countryCode&&s.countryCode!==a?v(null):v(s),h(!1)})()},[d,f,S,a,E]);const A=u.useMemo(()=>{if(!(t!=null&&t.tags)||!i)return[];const l=t.tags.split(",").map(s=>N(s.trim())).filter(Boolean);return l.length===0?[]:i.filter(s=>{if(!s.enabled)return!1;const r=s.content[c]||Object.values(s.content)[0];if(!r)return!1;const o=N(s.title),m=N(r.replace(/<[^>]*>/g,""));return l.some(p=>o.includes(p)||m.includes(p))}).sort((s,r)=>(r.publishedAt||r.createdAt).toDate().getTime()-(s.publishedAt||s.createdAt).toDate().getTime()).slice(0,4)},[t,i,a,c]);if($)return e.jsx("div",{className:"flex justify-center items-center p-10",children:e.jsx(O,{className:"animate-spin text-4xl text-green-600"})});if(!t)return e.jsxs("div",{className:"text-center py-20",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"لم يتم العثور على الموقع"}),e.jsx(U,{to:`/${a}/services`,className:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700",children:"العودة إلى قائمة الخدمات"})]});const L=t.type==="static";return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-8 flex-grow",children:[e.jsxs("main",{className:"md:col-span-3 bg-white rounded-lg shadow-xl p-6 md:p-8 flex flex-col",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("header",{className:"mb-6 border-b pb-4",children:e.jsx("h1",{className:"text-4xl font-bold text-gray-900",children:t.name})}),e.jsx("div",{className:"prose prose-lg max-w-none text-gray-800",dangerouslySetInnerHTML:{__html:t.description||"<p>لا يوجد وصف متاح لهذا الموقع.</p>"}}),e.jsxs("div",{className:"my-6 p-4 bg-blue-50 border-l-4 border-blue-400 text-blue-800 rounded-md",role:"alert",children:[e.jsx("p",{className:"font-bold",children:"ملاحظة هامة"}),e.jsxs("p",{children:["أزرار التعبئة أو الذهاب الى هذا الموقع موجودة في ",e.jsx("strong",{children:"أسفل هذه الصفحة"}),"."]})]}),e.jsx("div",{className:"my-6",children:e.jsx(_,{placement:"SERVICE_DETAIL_MAIN_TOP"})})]}),e.jsx("div",{className:"mt-8 pt-6 border-t",children:e.jsx("div",{className:"flex flex-col sm:flex-row gap-4",children:L?e.jsxs("button",{onClick:()=>g(`/${a}/go-to-site/${t.id}`),className:"flex items-center justify-center gap-3 w-full md:w-auto bg-green-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(C,{}),e.jsx("span",{children:"زيارة الموقع"})]}):e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>g(`/${a}/find-cafe`,{state:{documentIds:[t.id]}}),className:"flex items-center justify-center gap-3 w-full md:w-auto bg-green-600 text-white font-bold py-3 px-8 rounded-lg hover:bg-green-700 transition-colors",children:[e.jsx(z,{}),e.jsx("span",{children:"تعبئة هذا المستند"})]}),e.jsxs("button",{onClick:()=>g(`/${a}/go-to-site/${t.id}`),className:"flex items-center justify-center gap-3 w-full md:w-auto bg-gray-200 text-gray-800 font-bold py-3 px-8 rounded-lg hover:bg-gray-300 transition-colors",children:[e.jsx(C,{}),e.jsx("span",{children:"زيارة الموقع"})]})]})})})]}),e.jsxs("aside",{className:"md:col-span-1 space-y-6",children:[A.length>0&&e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow-lg border",children:[e.jsx("h3",{className:"font-bold text-lg mb-3 text-gray-800",children:I("relatedPosts.title")}),e.jsx("div",{className:"space-y-4",children:A.map(l=>e.jsx(G,{post:l,lang:c},l.id))})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-lg border",children:e.jsx(_,{placement:"SITE_DETAIL_SIDEBAR"})})]})]}),e.jsx(H,{url:window.location.href,title:t.name,description:t.description||""})]})};export{W as default};
