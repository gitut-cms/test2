import{a as O,r as i,j as e,i as _,bs as c,bt as T,bm as A}from"./index-DrB1YgVl.js";import"https://esm.sh/html-docx-js-typescript@0.1.5";import"https://esm.sh/file-saver@2.0.5";const f={DASHBOARD_TOP:"أعلى لوحة تحكم المستخدم",PROFILE_SIDEBAR:"الشريط الجانبي لصفحة المقهى",PDF_INTERSTITIAL:"صفحة انتظار فتح الملف",PUBLIC_FORM_LEFT:"يسار نموذج التعبئة العام",PUBLIC_FORM_RIGHT:"يمين نموذج التعبئة العام",SERVICE_DETAIL_MAIN_TOP:"صفحة التفاصيل (تحت الملاحظة)",SERVICE_DETAIL_MAIN_BOTTOM:"صفحة تفاصيل المستند (فوق الأزرار)",SITE_DETAIL_SIDEBAR:"صفحة تفاصيل الموقع (الشريط الجانبي)",BLOG_POST_BODY_TOP:"المدونة (بعد الفقرة الأولى)",BLOG_POST_BODY_BOTTOM:"المدونة (قبل الفقرة الأخيرة)",BLOG_POST_SIDEBAR:"المدونة (الشريط الجانبي)"},I=()=>{const{ads:m}=O(),[g,u]=i.useState(m),[n,b]=i.useState({isOpen:!1,mode:"create",ad:null}),[a,l]=i.useState({title:"",content:"",imageUrl:"",link:"",placement:"DASHBOARD_TOP",enabled:!0}),[o,h]=i.useState(!1);i.useEffect(()=>{u(m)},[m]);const x=async()=>{h(!0);try{const t=await T("settings","global"),s=JSON.stringify(t);await A({files:[{path:"data/json/site-settings-public.json",content:s}],commitMessage:"feat: Auto-update ads in settings",repoConfig:{owner:"gitut-cms",repo:"files"}}),console.log("Ads successfully published to GitHub.")}catch(t){console.error("Failed to auto-publish ads to GitHub:",t),alert("تم حفظ الإعلان في قاعدة البيانات، ولكن فشل تحديث الملف العام على GitHub.")}finally{h(!1)}},y=()=>{l({title:"",content:"",imageUrl:"",link:"",placement:"DASHBOARD_TOP",enabled:!0}),b({isOpen:!0,mode:"create",ad:null})},j=t=>{l({...t}),b({isOpen:!0,mode:"edit",ad:t})},p=()=>{b({isOpen:!1,mode:"create",ad:null})},N=async t=>{t.preventDefault();try{n.mode==="create"?await c.create(a):n.ad&&await c.update(n.ad.id,a),p(),await x(),alert("تم الحفظ والنشر بنجاح!")}catch(s){console.error("Failed to save ad:",s),alert("فشل حفظ الإعلان.")}},w=async t=>{try{const s=g.find(r=>r.id===t);s&&(await c.toggleStatus(t,s.enabled),u(r=>r.map(d=>d.id===t?{...d,enabled:!d.enabled}:d)),await x())}catch(s){console.error("Failed to toggle status:",s),alert("فشل تبديل الحالة.")}},v=async t=>{if(window.confirm("هل أنت متأكد من أنك تريد حذف هذا الإعلان؟"))try{await c.delete(t),u(s=>s.filter(r=>r.id!==t)),await x()}catch(s){console.error("Failed to delete ad:",s),alert("فشل حذف الإعلان.")}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"إدارة الإعلانات"}),o&&e.jsxs("span",{className:"flex items-center gap-2 text-sm text-blue-600 bg-blue-50 px-3 py-1 rounded-full",children:[e.jsx(_,{className:"animate-spin"}),"جاري التحديث والنشر..."]})]}),e.jsx("button",{onClick:y,disabled:o,className:"bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 transition-colors disabled:bg-gray-400",children:"+ إنشاء إعلان جديد"})]}),e.jsx("div",{className:"bg-white p-2 rounded-lg border shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-right",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 font-semibold text-sm text-gray-600",children:"العنوان"}),e.jsx("th",{className:"p-3 font-semibold text-sm text-gray-600",children:"موضع الظهور"}),e.jsx("th",{className:"p-3 font-semibold text-sm text-gray-600",children:"الحالة"}),e.jsx("th",{className:"p-3 font-semibold text-sm text-gray-600",children:"إجراءات"})]})}),e.jsx("tbody",{children:g.map(t=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-3 text-gray-800 font-semibold",children:t.title}),e.jsx("td",{className:"p-3 text-gray-600",children:f[t.placement]}),e.jsx("td",{className:"p-3",children:e.jsx("button",{onClick:()=>w(t.id),disabled:o,className:`px-3 py-1 text-xs font-semibold rounded-full disabled:opacity-50 ${t.enabled?"text-green-800 bg-green-200":"text-red-800 bg-red-200"}`,children:t.enabled?"مُفعَّل":"معطَّل"})}),e.jsxs("td",{className:"p-3 space-x-4 space-x-reverse",children:[e.jsx("button",{onClick:()=>j(t),disabled:o,className:"text-green-600 hover:underline text-sm font-semibold disabled:opacity-50",children:"تعديل"}),e.jsx("button",{onClick:()=>v(t.id),disabled:o,className:"text-red-600 hover:underline text-sm font-semibold disabled:opacity-50",children:"حذف"})]})]},t.id))})]})})}),n.isOpen&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsx("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl",children:e.jsxs("form",{onSubmit:N,children:[e.jsx("div",{className:"p-6 border-b",children:e.jsx("h2",{className:"text-2xl font-bold",children:n.mode==="create"?"إنشاء إعلان جديد":"تعديل الإعلان"})}),e.jsxs("div",{className:"p-6 space-y-4 max-h-[70vh] overflow-y-auto",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium text-gray-700 mb-1",children:"عنوان الإعلان"}),e.jsx("input",{type:"text",id:"title",value:a.title,onChange:t=>l(s=>({...s,title:t.target.value})),required:!0,className:"block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-700 mb-1",children:"المحتوى"}),e.jsx("textarea",{id:"content",rows:3,value:a.content,onChange:t=>l(s=>({...s,content:t.target.value})),required:!0,className:"block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"imageUrl",className:"block text-sm font-medium text-gray-700 mb-1",children:"رابط الصورة"}),e.jsx("input",{type:"url",id:"imageUrl",value:a.imageUrl,onChange:t=>l(s=>({...s,imageUrl:t.target.value})),required:!0,placeholder:"https://picsum.photos/...",className:"block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"link",className:"block text-sm font-medium text-gray-700 mb-1",children:"الرابط (عند النقر)"}),e.jsx("input",{type:"url",id:"link",value:a.link,onChange:t=>l(s=>({...s,link:t.target.value})),required:!0,placeholder:"https://example.com",className:"block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"placement",className:"block text-sm font-medium text-gray-700 mb-1",children:"موضع الظهور"}),e.jsx("select",{id:"placement",value:a.placement,onChange:t=>l(s=>({...s,placement:t.target.value})),required:!0,className:"block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-green-500 focus:border-green-500",children:Object.entries(f).map(([t,s])=>e.jsx("option",{value:t,children:s},t))})]})]}),e.jsxs("div",{className:"px-6 py-4 bg-gray-50 flex justify-end gap-3",children:[e.jsx("button",{type:"button",onClick:p,className:"bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-300",children:"إلغاء"}),e.jsx("button",{type:"submit",className:"bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700",children:"حفظ ونشر"})]})]})})})]})};export{I as default};
