import{a as X,r as b,j as s,k as Y,i as F,bp as q,bJ as ee,bk as H,bT as se,bm as B,bt as te,bi as E}from"./index-DrB1YgVl.js";import{e as j,d as P,c as N}from"./staticHtmlGenerator-Ba5j3Tzo.js";import{F as ae}from"./FileSaver.min-BvARJSWY.js";import"https://esm.sh/html-docx-js-typescript@0.1.5";import"https://esm.sh/file-saver@2.0.5";const ge=({forcePublishAll:le})=>{const{services:G,siteSettings:U,pages:p,blogPosts:f,ads:K}=X(),[w,I]=b.useState(!1),[M,h]=b.useState(""),[T,O]=b.useState(!1),[oe,A]=b.useState(""),[R,z]=b.useState(!1),[L,v]=b.useState(""),[J,Z]=b.useState(!1),C=b.useRef(null);b.useEffect(()=>{const e=t=>{C.current&&!C.current.contains(t.target)&&Z(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const _=async()=>{var e,t;try{const[l,i]=await Promise.all([fetch("https://datas.gitut.com/data/json/site-settings-public.json?t="+Date.now()),fetch("https://datas.gitut.com/data/json/site-seo.json?t="+Date.now())]);if(!l.ok)throw new Error("Failed to fetch public settings");const c=await l.json(),d=i.ok?await i.json():{},a={...E,...U,...c,seo:{...E.seo,...d},ads:{...E.ads,...c.ads||{},items:((e=c.ads)==null?void 0:e.items)||[]}},o=((t=c.ads)==null?void 0:t.items)||[];return{settings:a,ads:o}}catch(l){return console.warn("Could not fetch public settings, falling back to context.",l),{settings:U,ads:K}}},y=async e=>{I(!0),h("بدء إنشاء صفحات الخدمات...");try{const{settings:t,ads:l}=await _(),i=[],c=G.filter(a=>a.serviceType!=="site");if(!e||e==="global"){h("Generating Global Services...");const a=c.filter(o=>o.slug&&(!o.countryCode||o.countryCode==="global"));if(a.length>0){const o=j(a,"global",t,p,f,l);i.push({path:"dist/services/index.html",content:N(o)});for(const n of a){const u=P(n,c,t,p,f,l,"global"),S=n.serviceType==="site"?"site":"doc";i.push({path:`dist/${S}/${n.slug}/index.html`,content:N(u)})}}}const d=e&&e!=="global"?[e]:H.en.map(a=>a.code);for(const a of d){const o=c.filter(n=>n.slug&&n.countryCode===a);if(o.length>0){h(`Generating Services for ${a.toUpperCase()}...`);const n=j(o,a,t,p,f,l);i.push({path:`dist/${a}/services/index.html`,content:N(n)});for(const u of o){const S=P(u,c,t,p,f,l,a),k=u.serviceType==="site"?"site":"doc";i.push({path:`dist/${a}/${k}/${u.slug}/index.html`,content:N(S)})}}}i.length===0?h("لا توجد خدمات قابلة للنشر (المواقع مستثناة)."):(h(`رفع ${i.length} ملفًا إلى GitHub...`),await B({files:i,commitMessage:"feat: Regenerate static service pages (Separated)"}),h(`تم نشر ${i.length} صفحة خدمة بنجاح!`))}catch(t){console.error(t);const l=t instanceof Error?t.message:String(t);h(`فشل: ${l}`)}finally{I(!1),setTimeout(()=>h(""),8e3)}},Q=async e=>{var t,l,i,c;O(!0),A("");try{const d=new se,{settings:a,ads:o}=await _(),n=G.filter(r=>r.serviceType!=="site");if(!e||e==="global"){const r=n.filter(m=>m.slug&&(!m.countryCode||m.countryCode==="global"));if(r.length>0){const m=j(r,"global",a,p,f,o);(t=d.folder("services"))==null||t.file("index.html",m);for(const g of r){const D=P(g,n,a,p,f,o,"global"),x=d.folder(g.serviceType==="site"?"site":"doc");(l=x==null?void 0:x.folder(g.slug))==null||l.file("index.html",D)}}}const u=e&&e!=="global"?[e]:H.en.map(r=>r.code);for(const r of u){const m=n.filter(g=>g.slug&&g.countryCode===r);if(m.length>0){const g=d.folder(r);if(g){const D=j(m,r,a,p,f,o);(i=g.folder("services"))==null||i.file("index.html",D);for(const x of m){const W=P(x,n,a,p,f,o,r),$=g.folder(x.serviceType==="site"?"site":"doc");(c=$==null?void 0:$.folder(x.slug))==null||c.file("index.html",W)}}}}const S=await d.generateAsync({type:"blob"}),k=e?`gitut-service-pages-${e}.zip`:"gitut-service-pages-separated.zip";ae.saveAs(S,k)}catch(d){console.error(d),A("فشل في إنشاء ملف ZIP.")}finally{O(!1)}},V=async()=>{z(!0),v("Generating template files...");try{const e=await te("templates-paginated","global",!0);if(e.length===0)v("No templates to publish.");else{const t=e.map(l=>({path:`dist/data/json/templates/${l.fileName}`,content:JSON.stringify(l.data)}));v(`Uploading ${t.length} template files...`),await B({files:t,commitMessage:"feat: Update paginated templates"}),v(`Successfully published ${t.length} template files.`)}}catch(e){console.error("Template publishing failed:",e),v(`فشل: ${e.message}`)}finally{z(!1),setTimeout(()=>v(""),8e3)}};return s.jsxs("section",{className:"bg-white p-6 rounded-lg shadow-md border",children:[s.jsx("h2",{className:"text-xl font-bold mb-4",children:"إدارة صفحات الخدمات والقوالب"}),s.jsxs("div",{className:"space-y-3",children:[s.jsxs("div",{className:"flex gap-2 p-3 bg-gray-50 rounded-md items-center",children:[s.jsx("span",{className:"font-semibold text-gray-700 flex-1",children:"صفحات الخدمات (HTML)"}),s.jsx("p",{className:"text-xs text-red-500 mx-2 font-bold",children:"ملاحظة: المواقع (Sites) لن يتم نشرها كصفحات ثابتة."}),s.jsx("button",{onClick:()=>Q(),disabled:w||T,title:"تنزيل ZIP",className:"bg-gray-600 text-white font-bold p-3 rounded-lg hover:bg-gray-700 disabled:bg-gray-400",children:s.jsx(Y,{})}),s.jsxs("div",{className:"relative",ref:C,children:[s.jsxs("div",{className:"flex",children:[s.jsxs("button",{onClick:()=>y("global"),disabled:w||T,className:"bg-green-600 text-white font-bold p-3 rounded-r-lg hover:bg-green-700 disabled:bg-gray-400 flex items-center gap-2",children:[w?s.jsx(F,{className:"animate-spin"}):s.jsx(q,{}),s.jsx("span",{children:"Global Only"})]}),s.jsx("button",{onClick:()=>Z(!J),disabled:w||T,className:"bg-green-700 text-white font-bold p-3 rounded-l-lg hover:bg-green-800 disabled:bg-gray-500 border-r border-green-500",children:s.jsx(ee,{})})]}),J&&s.jsxs("div",{className:"absolute left-0 mt-1 w-48 bg-white rounded-md shadow-lg border z-10 max-h-60 overflow-y-auto",children:[s.jsx("button",{onClick:()=>y(void 0),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 font-bold border-b",children:"All (الكل منفصل)"}),s.jsx("button",{onClick:()=>y("global"),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 border-b",children:"Global Only"}),H.en.map(e=>s.jsxs("button",{onClick:()=>y(e.code),className:"block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2",children:[s.jsx("span",{children:e.flag})," ",e.name," Only"]},e.code))]})]})]}),M&&s.jsx("p",{className:"text-blue-600 text-sm mt-1 text-center",children:M}),s.jsxs("div",{className:"flex gap-2 p-3 bg-gray-50 rounded-md items-center",children:[s.jsx("span",{className:"font-semibold text-gray-700 flex-1",children:"قوالب المستندات (JSON)"}),s.jsxs("button",{onClick:V,disabled:R,className:"bg-blue-600 text-white font-bold p-3 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 flex items-center gap-2",children:[R?s.jsx(F,{className:"animate-spin"}):s.jsx(q,{}),s.jsx("span",{children:"نشر القوالب"})]})]}),L&&s.jsx("p",{className:"text-blue-600 text-sm mt-1 text-center",children:L})]})]})};export{ge as default};
