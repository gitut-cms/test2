import{q as F,a as S,u as E,m as I,p as M,r,X as P,j as e,i as w,L,f as R,Q as W,k as A,aE as B,a4 as T}from"./index-DrB1YgVl.js";import"https://esm.sh/html-docx-js-typescript@0.1.5";import"https://esm.sh/file-saver@2.0.5";const Q=()=>{const{docId:m}=F(),{staticDocuments:u,loading:y,siteSettings:a}=S(),{user:n,updateUserCredits:k}=E(),{t}=I(),D=M(),x=r.useRef(null),[f,N]=r.useState(!1),[i,p]=r.useState(!1),[g,l]=r.useState(""),[h,v]=r.useState(""),c=r.useMemo(()=>u.find(s=>s.id===m),[u,m]),b=r.useMemo(()=>P(c==null?void 0:c.fileUrl),[c]),o=(n==null?void 0:n.credits.currency)==="USD"?a==null?void 0:a.pricing.staticDocumentDownload.usd:a==null?void 0:a.pricing.staticDocumentDownload.dzd,j=(n==null?void 0:n.credits.currency)==="USD"?"$":"دج",U=()=>{const s=x.current;s&&s.contentWindow&&(s.contentWindow.focus(),s.contentWindow.print())},V=()=>{if(c){const s=document.createElement("a");s.href=b,s.setAttribute("download",c.name),document.body.appendChild(s),s.click(),document.body.removeChild(s)}},C=async()=>{if(!n||!a||o===void 0){l(t("staticDocViewer.error.missingData"));return}l(""),p(!0);try{const s=await T(n,o);if(s.success)k(n.credits.amount-o),N(!0),v(t("staticDocViewer.success.unlocked",{cost:o,currency:j}));else{let d=s.message;(d.includes("رصيدك غير كاف")||d.includes("Insufficient balance"))&&(d=t("app.error.insufficientBalance"),setTimeout(()=>D("/app/billing"),2e3)),l(d)}}catch(s){console.error("Unlock failed:",s),l(t("app.error.message"))}finally{p(!1)}};return y?e.jsx("div",{className:"flex justify-center items-center p-10",children:e.jsx(w,{className:"animate-spin text-4xl text-green-600"})}):c?e.jsxs("div",{children:[h&&e.jsxs("div",{className:"bg-green-100 border border-green-400 text-green-800 p-3 rounded-lg mb-4 flex items-center justify-center gap-2 animate-fadeIn",children:[e.jsx(R,{}),e.jsx("span",{children:h})]}),e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:c.name}),f&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:U,className:"flex items-center gap-2 bg-blue-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-blue-700",children:[e.jsx(W,{})," ",e.jsx("span",{children:t("staticDocViewer.print")})]}),e.jsxs("button",{onClick:V,className:"flex items-center gap-2 bg-green-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-green-700",children:[e.jsx(A,{})," ",e.jsx("span",{children:t("staticDocViewer.download")})]})]})]}),e.jsx("div",{className:"border rounded-lg overflow-hidden bg-gray-200",children:f?e.jsx("iframe",{ref:x,src:b,title:c.name,className:"w-full h-[70vh] border-0 bg-white"}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-[70vh] text-center p-4",children:[e.jsx(B,{className:"text-5xl text-gray-400 mb-4"}),e.jsx("h2",{className:"text-xl font-bold text-gray-800",children:t("staticDocViewer.locked.title")}),e.jsxs("p",{className:"text-gray-600 mb-4",children:[t("staticDocViewer.locked.description")," ",e.jsxs("span",{className:"font-bold font-mono",children:[o," ",j]})," ",t("staticDocViewer.locked.balance")]}),e.jsxs("button",{onClick:C,disabled:i,className:`flex items-center gap-2 bg-green-600 text-white font-bold py-3 px-8 rounded-lg transition-colors ${i?"opacity-75 cursor-wait":"hover:bg-green-700"}`,children:[i&&e.jsx(w,{className:"animate-spin"}),i?"جاري الفتح...":t("staticDocViewer.unlockButton")]}),g&&e.jsx("p",{className:"text-red-500 mt-4 font-semibold",children:g})]})})]}):e.jsxs("div",{className:"text-center py-20",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:t("staticDocViewer.notFound.title")}),e.jsx(L,{to:"/app",className:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 transition-colors",children:t("staticDocViewer.backToDashboard")})]})};export{Q as default};
