import{a as $,r as l,j as e,bo as ee,h as te,e as se,i as M,x as ae,bp as le,bu as L,bi as ne,bv as z,bm as oe}from"./index-DrB1YgVl.js";import{R as v}from"./index-jCUXYg4f.js";import{a as re,c as U,b as ie}from"./staticHtmlGenerator-Ba5j3Tzo.js";import"https://esm.sh/html-docx-js-typescript@0.1.5";import"https://esm.sh/file-saver@2.0.5";if(v.Quill){const r=v.Quill.import("attributors/style/size");r.whitelist=["8px","9px","10px","11px","12px","14px","16px","18px","20px","22px","24px","28px","36px","48px","72px"],v.Quill.register("attributors/style/size",r,!0)}const de=r=>{let b=`<?xml version="1.0" encoding="UTF-8"?>
<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">
`;return r.forEach(y=>{b+=`  <url><loc>${y}</loc></url>
`}),b+="</urlset>",b},ce=r=>r.toLowerCase().trim().replace(/\s+/g,"-").replace(/[^a-z0-9\u0600-\u06FF-]/g,""),Re=()=>{const{blogPosts:r,addBlogPost:b,updateBlogPost:y,deleteBlogPost:ge,siteSettings:G,pages:A,blogPosts:P}=$(),[H,J]=l.useState([]),[R,I]=l.useState({isOpen:!1,mode:"create",post:null}),[ue,C]=l.useState({title:"",content:{},publishedAt:"",tags:[],countryCode:""}),[xe,he]=l.useState(!1),[pe,f]=l.useState("ar"),[me,be]=l.useState(""),[fe,je]=l.useState([]),[Se,ye]=l.useState(!1),[Ne,we]=l.useState(!1),[Te,ve]=l.useState(null),[Ae,Pe]=l.useState(""),[Ie,Ce]=l.useState(""),[ke,Be]=l.useState(!1),[Oe,Ee]=l.useState(!1),[De,Fe]=l.useState([]),[$e,Me]=l.useState(!1),[Q,j]=l.useState(!1),[N,k]=l.useState(""),[B,O]=l.useState(!1),[E,S]=l.useState(""),[Le,X]=l.useState(!1),[c,w]=l.useState(null),[D,F]=l.useState(!1);l.useEffect(()=>{const t=[...r].sort((i,s)=>{const x=i.publishedAt?i.publishedAt.toDate():i.createdAt.toDate();return(s.publishedAt?s.publishedAt.toDate():s.createdAt.toDate()).getTime()-x.getTime()});J(t)},[r]);const _=()=>{const t=new Date().toISOString().split("T")[0];C({title:"",content:{},publishedAt:t,tags:[],countryCode:""}),f("ar"),I({isOpen:!0,mode:"create",post:null})},q=t=>{const i=t.publishedAt?t.publishedAt.toDate().toISOString().split("T")[0]:"";C({title:t.title,content:t.content||{},publishedAt:i,tags:t.tags?t.tags.split(",").map(x=>x.trim()).filter(Boolean):[],countryCode:t.countryCode||""});const s=Object.keys(t.content||{});s.includes("ar")?f("ar"):s.length>0?f(s[0]):f("ar"),I({isOpen:!0,mode:"edit",post:t})},K=()=>{k(""),S(""),X(!1),w(null),j(!0)},V=()=>{S(""),F(!0);try{const t=JSON.parse(N);if(!Array.isArray(t))throw new Error("JSON must be an array.");const i=t.map((s,x)=>{if(!s.title||!s.language||!s.content)return{status:"Error",title:"Invalid Item",slug:"",lang:"",files:[],data:s,error:"Missing required fields"};const h=s.slug||ce(s.title);let d=h;const a=r.find(m=>m.slug===h),n=a?"Update":"New",g=[`dist/blog/${s.language==="ar"?"":`${s.language}/`}${d}/index.html`],o=s.publishedAt?new Date(s.publishedAt):new Date,u={title:s.title,slug:d,content:{[s.language]:s.content},tags:s.tags||"",author:s.author||"Admin",createdAt:L.firestore.Timestamp.now(),publishedAt:L.firestore.Timestamp.fromDate(o),enabled:!0,countryCode:s.countryCode||""};return a&&(u.id=a.id),{status:n,title:s.title,slug:d,lang:s.language,files:g,data:u}});w(i)}catch(t){S(t.message)}finally{F(!1)}},W=async()=>{if(c){O(!0);try{const t=G||ne,i=$().ads||[],s=[],x=new Set,h=[];for(const a of c){if(a.status==="Error")continue;x.add(a.lang);let n;if(a.status==="New")n=await z.create(a.data),b(n);else{const m=r.find(Z=>Z.id===a.data.id),Y={...(m==null?void 0:m.content)||{},...a.data.content},T={...a.data,content:Y};await z.update(a.data.id,T),y(a.data.id,T),n={...m,...T}}h.push(n);const p=[...P,...h],g=re(n,p,t,a.lang,i,A,p,a.lang==="ar"?"":a.lang),u=`dist/blog/${a.lang==="ar"?"":`${a.lang}/`}${n.slug}/index.html`;s.push({path:u,content:U(g)})}const d=[...P];h.forEach(a=>{const n=d.findIndex(p=>p.id===a.id);n>-1?d[n]=a:d.push(a)});for(const a of x){const n=d.filter(o=>o.enabled&&o.content&&o.content[a]),p=a==="ar"?"":a;if(n.length>0){const o=ie(n,t,a,A,d,p),u=`dist/blog/${a==="ar"?"":a+"/"}index.html`;s.push({path:u,content:U(o)})}const g=new Set;if(g.add(`https://gitut.com/blog/${a==="ar"?"":a+"/"}`),n.forEach(o=>{o.slug&&g.add(`https://gitut.com/blog/${a==="ar"?"":a+"/"}${o.slug}/`)}),g.size>0){const o=de(g),u=`dist/sitemap/blog-${a}.xml`;s.push({path:u,content:o})}}s.length>0&&await oe({files:s,commitMessage:`feat: Batch blog import (${c.length} posts) + updates`}),alert(`تم استيراد ونشر ${c.length} مقال بنجاح!`),j(!1)}catch(t){console.error("Bulk Import Error:",t),S(t.message)}finally{O(!1)}}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-800",children:"إدارة المدونة"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{onClick:K,className:"bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors flex items-center gap-2",children:[e.jsx(ee,{}),e.jsx("span",{children:"إضافة مقالات (JSON)"})]}),e.jsx("button",{onClick:_,className:"bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700 transition-colors",children:"+ إنشاء مقال جديد"})]})]}),e.jsx("div",{className:"bg-white p-2 rounded-lg border shadow-sm",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsx("table",{className:"w-full text-right",children:e.jsx("tbody",{children:H.map(t=>e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"p-3",children:t.title}),e.jsx("td",{className:"p-3",children:e.jsx("button",{onClick:()=>q(t),className:"text-green-600 hover:underline text-sm font-semibold",children:"تعديل"})})]},t.id))})})})}),Q&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-5xl h-[90vh] flex flex-col",children:[e.jsxs("div",{className:"p-6 border-b flex justify-between items-center",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"استيراد مقالات (تحليل ونشر)"}),e.jsx("button",{onClick:()=>j(!1),className:"text-gray-500 hover:text-gray-800",children:e.jsx(te,{size:20})})]}),e.jsx("div",{className:"p-6 flex-grow flex flex-col space-y-4 overflow-hidden",children:c?e.jsxs("div",{className:"flex-grow overflow-y-auto",children:[e.jsxs("h3",{className:"font-bold mb-3",children:["تقرير المحاكاة (",c.length," عنصر)"]}),e.jsxs("table",{className:"w-full text-sm text-right border",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-2 border",children:"الحالة"}),e.jsx("th",{className:"p-2 border",children:"العنوان"}),e.jsx("th",{className:"p-2 border",children:"اللغة"}),e.jsx("th",{className:"p-2 border",children:"الملفات المستهدفة"})]})}),e.jsx("tbody",{children:c.map((t,i)=>e.jsxs("tr",{className:`border-b ${t.status==="New"?"bg-green-50":t.status==="Error"?"bg-red-50":"bg-yellow-50"}`,children:[e.jsx("td",{className:"p-2 font-bold",children:t.status}),e.jsx("td",{className:"p-2",children:t.title}),e.jsx("td",{className:"p-2",children:t.lang}),e.jsxs("td",{className:"p-2 text-xs text-gray-600 dir-ltr text-left",children:[t.files.map(s=>e.jsx("div",{children:s},s)),t.error&&e.jsx("span",{className:"text-red-600",children:t.error})]})]},i))})]}),e.jsxs("div",{className:"bg-yellow-50 p-3 mt-4 rounded border border-yellow-200 flex items-center gap-2 text-yellow-800",children:[e.jsx(se,{}),e.jsxs("span",{className:"text-sm",children:["تنبيه: سيتم الحفظ في قاعدة البيانات ",e.jsx("strong",{children:"ورفع صفحات HTML فوراً"})," عند التأكيد."]})]})]}):e.jsxs("div",{className:"flex-grow flex flex-col",children:[e.jsxs("div",{className:"bg-blue-50 p-4 rounded-md text-sm text-blue-800 mb-4",children:[e.jsx("p",{className:"font-bold",children:"تعليمات:"}),e.jsxs("ul",{className:"list-disc list-inside",children:[e.jsxs("li",{children:["ألصق مصفوفة JSON. الحقول المطلوبة: ",e.jsx("code",{children:"title"}),", ",e.jsx("code",{children:"language"}),", ",e.jsx("code",{children:"content"})," (HTML)."]}),e.jsx("li",{children:"سيقوم النظام بتحليل البيانات وعرض تقرير بالملفات التي سيتم إنشاؤها."})]})]}),e.jsx("textarea",{className:"flex-grow p-4 border rounded-md font-mono text-sm bg-gray-900 text-green-100 focus:ring-2 focus:ring-blue-500",placeholder:'[ { "title": "Example", "language": "en", "content": "<p>...</p>" } ]',dir:"ltr",value:N,onChange:t=>k(t.target.value)}),E&&e.jsx("p",{className:"text-red-600 font-bold mt-2",children:E})]})}),e.jsx("div",{className:"p-6 border-t bg-gray-50 flex justify-end gap-3",children:c?e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>w(null),className:"bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg",children:"تراجع"}),e.jsxs("button",{onClick:W,disabled:B,className:"bg-green-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-green-700 disabled:bg-gray-400 flex items-center gap-2",children:[B?e.jsx(M,{className:"animate-spin"}):e.jsx(le,{}),e.jsx("span",{children:"تأكيد وتنفيذ النشر"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>j(!1),className:"bg-gray-200 text-gray-800 font-bold py-2 px-4 rounded-lg",children:"إلغاء"}),e.jsxs("button",{onClick:V,disabled:D||!N.trim(),className:"bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 disabled:bg-gray-400 flex items-center gap-2",children:[D?e.jsx(M,{className:"animate-spin"}):e.jsx(ae,{}),e.jsx("span",{children:"تحليل ومعاينة"})]})]})})]})}),R.isOpen&&e.jsx("div",{className:"hidden"})]})};export{Re as default};
